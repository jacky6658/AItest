<!DOCTYPE html>
<html lang="zh-TW" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>AIJobçŸ­å½±éŸ³é¡§å•æ™ºèƒ½</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- AI Points System -->
    <link rel="stylesheet" href="./public/points-addon.css">
    <script defer type="module" src="./public/src/boot/aiPoints_bootstrap.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Noto Sans TC', 'sans-serif'],
                    },
                    colors: {
                        primary: '#2563EB',
                        'primary-hover': '#1D4ED8',
                        secondary: '#16A34A',
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        /* iOS Safari å­—é«”ç¸®æ”¾èˆ‡è¼¸å…¥æ¡†è‡ªå‹•æ”¾å¤§ä¿®æ­£ */
        html { -webkit-text-size-adjust: 100%; }
        /* Safe Area è®Šæ•¸èˆ‡å·¥å…· */
        :root{
          --safe-left: env(safe-area-inset-left, 0px);
          --safe-right: env(safe-area-inset-right, 0px);
          --safe-top: env(safe-area-inset-top, 0px);
          --safe-bottom: env(safe-area-inset-bottom, 0px);
        }
        .safe-x{ padding-left: max(1rem, var(--safe-left)); padding-right: max(1rem, var(--safe-right)); }
        .safe-t{ padding-top: var(--safe-top); }
        .safe-b{ padding-bottom: var(--safe-bottom); }
        /* é–èƒŒæ™¯æ²å‹•ï¼šç™»å…¥å½ˆçª—é–‹å•Ÿæ™‚åœ¨ <html> åŠ ä¸Š modal-open */
        html.modal-open, html.modal-open body { overflow: hidden; }
        @media (max-width: 480px) {
          input, textarea, select { font-size: 16px !important; }
        }
        .btn-chip {
            padding: 6px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 9999px;
            background: #fff;
            color: #374151;
            cursor: pointer;
            transition: all 0.15s;
            font-size: 13px;
            font-weight: 500;
        }
        .btn-chip:hover {
            border-color: #3b82f6;
            color: #3b82f6;
            background: #f8fafc;
        }
        .dark .btn-chip {
            background: #374151;
            color: #d1d5db;
            border-color: #4b5563;
        }
        .dark .btn-chip:hover {
            border-color: #3b82f6;
            color: #3b82f6;
            background: #1f2937;
        }
        /* åª’é«”å…ƒç´ é˜²æ­¢æ©«å‘æº¢å‡ºï¼ˆiOS Safari å‹å¥½ï¼‰ */
        img, video, canvas, svg { max-width: 100%; height: auto; }
    </style>
</head>
<body class="font-sans bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-150">
    <!-- Toast å®¹å™¨ -->
    <div id="toast-container" class="fixed inset-0 z-50 flex flex-col items-center justify-center gap-3 pointer-events-none"></div>

    <!-- é ‚éƒ¨å°è¦½åˆ— -->
    <nav class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-40 safe-x safe-t">
        <div class="max-w-7xl mx-auto w-full">
            <div class="flex justify-between items-center h-16 relative">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="#!home" class="focus:outline-none" data-page="home">
                        <h1 class="font-bold text-primary dark:text-white text-lg sm:text-xl md:text-2xl leading-tight">AIJobçŸ­å½±éŸ³é¡§å•æ™ºèƒ½</h1>
                    </a>
                </div>
                
                <!-- å°è¦½é€£çµ -->
                <div class="hidden md:flex space-x-8" id="nav-links">
                    <a href="#!home" class="nav-link text-gray-700 dark:text-gray-300 hover:text-primary transition-colors duration-150" data-page="home">é¦–é </a>
                    <a href="#!positioning" class="nav-link text-gray-700 dark:text-gray-300 hover:text-primary transition-colors duration-150" data-page="positioning">AIçŸ­å½±éŸ³å®šä½é¡§å•</a>
                    <a href="#!ideation" class="nav-link text-gray-700 dark:text-gray-300 hover:text-primary transition-colors duration-150" data-page="ideation">AIé¸é¡Œå°åŠ©æ‰‹</a>
                    <a href="#!script" class="nav-link text-gray-700 dark:text-gray-300 hover:text-primary transition-colors duration-150" data-page="script">AIè…³æœ¬ç”Ÿæˆå¤§å¸«</a>
                    <a href="#!guide" class="nav-link text-gray-700 dark:text-gray-300 hover:text-primary transition-colors duration-150" data-page="guide">èªªæ˜/æŒ‡å—</a>
                </div>

                <!-- å³å´æŒ‰éˆ•ç¾¤ -->
                <div class="flex items-center space-x-2 md:space-x-4">
                    <!-- æ‰‹æ©Ÿé¸å–® -->
                    <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary" aria-label="é–‹å•Ÿé¸å–®">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                    </button>
                    <!-- æš—è‰²æ¨¡å¼åˆ‡æ› -->
                    <button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-gray-800" aria-label="åˆ‡æ›æš—è‰²æ¨¡å¼">
                        <svg id="theme-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path id="sun-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                            <path id="moon-icon" class="hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>
                    
                    <!-- Credits é¡¯ç¤ºï¼ˆç™»å…¥å¾Œæ‰é¡¯ç¤ºï¼‰ -->
                    <div id="nav-credits-wrap" class="hidden items-center text-sm text-gray-500 dark:text-gray-400">
                        <span>Credits: <span id="nav-credits">0</span></span>
                    </div>
                    
                    <!-- ç™»å…¥æŒ‰éˆ•ï¼ˆæœ€å³å´ï¼‰ -->
                    <div class="relative">
                        <button id="login-btn" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                            ç™»å…¥
                        </button>
                        <!-- ç™»å…¥å¾Œçš„ä¸‹æ‹‰é¸å–® -->
                        <div id="user-dropdown" class="absolute right-0 top-full mt-2 w-64 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg hidden z-50">
                            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center text-white font-semibold">
                                        <span id="user-avatar">G</span>
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-semibold text-gray-900 dark:text-white" id="user-name">Google ç”¨æˆ¶</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400" id="user-email">user@gmail.com</div>
                                    </div>
                                    <button class="text-gray-400 hover:text-gray-600">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="p-2">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">å…è²»</span>
                                    <button class="bg-black text-white text-xs px-3 py-1 rounded hover:bg-gray-800 transition-colors" onclick="showPurchaseModal()">å‡ç´š</button>
                                </div>
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                        </svg>
                                        <span class="text-sm text-gray-600 dark:text-gray-400">é»æ•¸</span>
                                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="flex items-center space-x-1">
                                        <span class="text-sm font-semibold">300</span>
                                        <svg class="w-3 h-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 rounded">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                        </svg>
                                        <span>çŸ¥è­˜</span>
                                    </a>
                                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 rounded">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                        <span>å¸³æˆ¶</span>
                                    </a>
                                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 rounded">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                        <span>è¨­å®š</span>
                                    </a>
                                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 rounded">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                        </svg>
                                        <span>é¦–é </span>
                                        <svg class="w-3 h-3 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                        </svg>
                                    </a>
                                    <a href="#" class="flex items-center space-x-3 px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 rounded">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span>ç²å–å¹«åŠ©</span>
                                        <svg class="w-3 h-3 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                        </svg>
                                    </a>
                                </div>
                                <div class="border-t border-gray-200 dark:border-gray-700 mt-2 pt-2">
                                    <button id="logout-btn" class="flex items-center space-x-3 px-3 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-gray-700 rounded w-full">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                        </svg>
                                        <span>ç™»å‡º</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- æ‰‹æ©Ÿä¸‹æ‹‰é¸å–® -->
            <div id="mobile-menu" class="md:hidden hidden border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
                <div class="px-4 py-3 space-y-2">
                    <a href="#!home" class="block nav-link text-gray-700 dark:text-gray-300 hover:text-primary transition-colors duration-150" data-page="home">é¦–é </a>
                    <a href="#!positioning" class="block nav-link text-gray-700 dark:text-gray-300 hover:text-primary transition-colors duration-150" data-page="positioning">AIçŸ­å½±éŸ³å®šä½é¡§å•</a>
                    <a href="#!ideation" class="block nav-link text-gray-700 dark:text-gray-300 hover:text-primary transition-colors duration-150" data-page="ideation">AIé¸é¡Œå°åŠ©æ‰‹</a>
                    <a href="#!script" class="block nav-link text-gray-700 dark:text-gray-300 hover:text-primary transition-colors duration-150" data-page="script">AIè…³æœ¬ç”Ÿæˆå¤§å¸«</a>
                    <a href="#!guide" class="block nav-link text-gray-700 dark:text-gray-300 hover:text-primary transition-colors duration-150" data-page="guide">èªªæ˜/æŒ‡å—</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- å¸³è™Ÿå´é‚ŠæŠ½å±œï¼ˆç™»å…¥å¾Œï¼‰ -->
    <div id="drawer-overlay" class="fixed inset-0 bg-black/40 hidden z-40"></div>
    <aside id="account-drawer" class="fixed right-0 top-0 h-full w-80 bg-white dark:bg-gray-800 border-l border-gray-200 dark:border-gray-700 transform translate-x-full transition-transform duration-200 z-50">
        <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div id="acc-avatar" class="w-10 h-10 rounded-full bg-orange-500 text-white flex items-center justify-center font-semibold">A</div>
                <div>
                    <div id="acc-name" class="font-semibold text-gray-900 dark:text-white">ä½¿ç”¨è€…</div>
                    <div id="acc-email" class="text-sm text-gray-500 dark:text-gray-400">user@email.com</div>
                </div>
            </div>
            <button id="drawer-close" class="p-2 rounded hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100" aria-label="é—œé–‰">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>
        <div class="p-4 space-y-4">
            <!-- æ–¹æ¡ˆç‹€æ…‹å€å¡Š -->
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-3">
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">æ–¹æ¡ˆç‹€æ…‹</span>
                    <span id="acc-plan" class="text-xs px-2 py-1 rounded bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300">å…è²»</span>
                </div>
                <button id="acc-upgrade" class="w-full px-3 py-2 text-xs bg-black text-white rounded hover:bg-gray-800 transition-colors" onclick="showPurchaseModal()">
                    å‡ç´šæ–¹æ¡ˆ
                </button>
            </div>

            <!-- é»æ•¸è³‡è¨Šå€å¡Š -->
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                        </svg>
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">é»æ•¸é¤˜é¡</span>
                    </div>
                    <span id="acc-credits" class="text-lg font-bold text-primary">300</span>
                </div>
                
                <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                    <span>å…è²»é»æ•¸</span>
                    <span id="acc-free-credits">0</span>
                </div>
                
                <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                    <span>æ¯æ—¥åˆ·æ–°ç©åˆ†</span>
                    <span>æ¯å¤© 00:00 åˆ·æ–°ç‚º 300</span>
                </div>
            </div>

            <!-- ä½¿ç”¨çµ±è¨ˆå€å¡Š -->
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-3">
                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">æœ¬æœˆä½¿ç”¨çµ±è¨ˆ</h4>
                <div class="space-y-2">
                    <div class="flex items-center justify-between text-xs">
                        <span class="text-gray-500 dark:text-gray-400">å®šä½é¡§å•</span>
                        <span id="acc-positioning-count" class="font-medium">0 æ¬¡</span>
                    </div>
                    <div class="flex items-center justify-between text-xs">
                        <span class="text-gray-500 dark:text-gray-400">é¸é¡ŒåŠ©æ‰‹</span>
                        <span id="acc-topics-count" class="font-medium">0 æ¬¡</span>
                    </div>
                    <div class="flex items-center justify-between text-xs">
                        <span class="text-gray-500 dark:text-gray-400">è…³æœ¬ç”Ÿæˆ</span>
                        <span id="acc-script-count" class="font-medium">0 æ¬¡</span>
                    </div>
                </div>
            </div>
            <nav class="pt-2 space-y-1 text-gray-700 dark:text-gray-300">
                <a href="#" class="flex items-center justify-between px-3 py-2 rounded hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100">
                    <span>çŸ¥è­˜</span>
                </a>
                <a href="#" class="flex items-center justify-between px-3 py-2 rounded hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100">
                    <span>å¸³æˆ¶</span>
                </a>
                <a href="#" class="flex items-center justify-between px-3 py-2 rounded hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100">
                    <span>è¨­å®š</span>
                </a>
                <a href="#!home" class="flex items-center justify-between px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700">
                    <span>é¦–é </span>
                </a>
                <a href="#" class="flex items-center justify-between px-3 py-2 rounded hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100">
                    <span>ç²å–å¹«åŠ©</span>
                </a>
            </nav>
        </div>
        <div class="mt-auto p-4 border-t border-gray-200 dark:border-gray-700">
            <button id="drawer-logout-btn" class="w-full flex items-center justify-center gap-2 px-4 py-2 rounded bg-red-50 text-red-600 hover:bg-red-100 dark:bg-gray-700 dark:text-red-400">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
                ç™»å‡º
            </button>
        </div>
    </aside>


    <!-- è³¼è²·å½ˆçª— -->
    <div id="purchase-modal" class="fixed inset-0 bg-black bg-opacity-50 z-[100] hidden items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full max-h-[80vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">é¸æ“‡è¨‚é–±æ–¹æ¡ˆ</h3>
                    <button onclick="closePurchaseModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div id="purchase-plans" class="space-y-4">
                    <!-- æ–¹æ¡ˆé¸é …å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
                
                <div class="mt-6 text-center">
                    <button onclick="closePurchaseModal()" class="px-6 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                        å–æ¶ˆ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Email ç™»å…¥/è¨»å†Š å…¨ç•«é¢é ï¼ˆæ–°ï¼‰ -->
    <div id="email-auth-page" class="fixed inset-0 hidden z-[100]">
        <div id="email-auth-overlay" class="absolute inset-0 bg-gray-900/60"></div>
        <div class="absolute inset-0 flex items-center justify-center p-3 sm:p-4">
            <div class="w-full max-w-2xl bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-y-auto max-h-[80vh]">
                <div class="flex items-center justify-between px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center gap-3">
                        <h3 class="text-lg font-semibold">Email ç™»å…¥ / è¨»å†Š</h3>
                        <span class="text-xs px-2 py-1 rounded bg-primary text-white">Beta</span>
                    </div>
                    <button id="email-auth-close" class="p-2 rounded hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100" aria-label="é—œé–‰">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2">
                    <!-- å·¦ï¼šç™»å…¥ -->
                    <div class="p-4 sm:p-6 border-b md:border-b-0 md:border-r border-gray-200 dark:border-gray-700">
                        <div class="mb-4">
                            <h4 class="font-semibold mb-1">å·²æœ‰å¸³è™Ÿï¼Ÿç™»å…¥</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">è¼¸å…¥ Email æˆ– å¸³è™Ÿ èˆ‡å¯†ç¢¼ç™»å…¥ã€‚</p>
                        </div>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm mb-1">Email æˆ– å¸³è™Ÿ</label>
                                <input id="login-identifier" type="text" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700" placeholder="you@example.com æˆ– yourname"/>
                            </div>
                            <div>
                                <label class="block text-sm mb-1">å¯†ç¢¼</label>
                                <div class="flex items-center gap-2">
                                    <input id="login-password" type="password" class="flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700" placeholder="********"/>
                                    <button id="toggle-login-pw" type="button" class="px-2 py-2 rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-50 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100" aria-label="é¡¯ç¤º/éš±è—å¯†ç¢¼">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8Z"/><circle cx="12" cy="12" r="3"/></svg>
                                    </button>
                                </div>
                            </div>
                            <div class="pt-2 flex flex-wrap items-center justify-end gap-2">
                                <button id="btn-email-login" class="px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary-hover w-full sm:w-auto">ç™»å…¥</button>
                            </div>
                            <div class="flex items-center gap-3 pt-3">
                                <div class="h-px bg-gray-200 dark:bg-gray-700 flex-1"></div>
                                <span class="text-xs text-gray-500">æˆ–</span>
                                <div class="h-px bg-gray-200 dark:bg-gray-700 flex-1"></div>
                            </div>
                            <button id="btn-google-login" class="mt-2 w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-50 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 flex items-center justify-center gap-2">
                                <span>ä½¿ç”¨ Google ç™»å…¥</span>
                            </button>
                        </div>
                    </div>
                    <!-- å³ï¼šè¨»å†Š -->
                    <div class="p-4 sm:p-6">
                        <div class="mb-4">
                            <h4 class="font-semibold mb-1">æ²’æœ‰å¸³è™Ÿï¼Ÿè¨»å†Š</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">å»ºç«‹å¸³è™Ÿéœ€å¡«å¯«é›»è©±ã€Emailã€å¸³è™Ÿèˆ‡å¯†ç¢¼ã€‚</p>
                        </div>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm mb-1">é›»è©±</label>
                                <input id="signup-phone" type="tel" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700" placeholder="09xx-xxx-xxx"/>
                            </div>
                            <div>
                                <label class="block text-sm mb-1">Email</label>
                                <input id="signup-email" type="email" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700" placeholder="you@example.com"/>
                            </div>
                            <div>
                                <label class="block text-sm mb-1">å¸³è™Ÿ</label>
                                <input id="signup-username" type="text" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700" placeholder="yourname"/>
                            </div>
                            <div>
                                <label class="block text-sm mb-1">å¯†ç¢¼</label>
                                <div class="flex items-center gap-2">
                                    <input id="signup-password" type="password" class="flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700" placeholder="********"/>
                                    <button id="toggle-signup-pw" type="button" class="px-2 py-2 rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-50 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100" aria-label="é¡¯ç¤º/éš±è—å¯†ç¢¼">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8Z"/><circle cx="12" cy="12" r="3"/></svg>
                                    </button>
                                </div>
                            </div>
                            <div class="pt-2 flex flex-wrap items-center justify-end gap-2">
                                <button id="btn-email-signup" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-50 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 w-full sm:w-auto">å»ºç«‹å¸³è™Ÿ</button>
                            </div>
                            <div class="flex items-center gap-3 pt-3">
                                <div class="h-px bg-gray-200 dark:bg-gray-700 flex-1"></div>
                                <span class="text-xs text-gray-500">æˆ–</span>
                                <div class="h-px bg-gray-200 dark:bg-gray-700 flex-1"></div>
                            </div>
                            <button id="btn-google-signup" class="mt-2 w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center justify-center gap-2">
                                <span>ä½¿ç”¨ Google è¨»å†Š</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
    <main class="min-h-screen bg-gray-50 dark:bg-gray-900">
        <!-- é¦–é  -->
        <div id="page-home" class="page hidden">
            <!-- Hero å€ -->
            <section class="bg-gradient-to-br from-primary to-primary-hover text-white py-20">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                    <h2 class="text-4xl md:text-6xl font-bold mb-6">å…§å®¹å‰µä½œï¼Œå¾æ­¤ç°¡å–®</h2>
                    <p class="text-xl md:text-2xl mb-8 opacity-90">ä¸‰æ¬¾å°ˆæ¥­å·¥å…·ï¼ŒåŠ©æ‚¨æ‰“é€ å„ªè³ªå…§å®¹</p>
                </div>
            </section>

            <!-- å·¥å…·å¡ç‰‡å€ -->
            <section class="py-16">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="grid md:grid-cols-3 gap-8">
                        <!-- å®šä½åŠ©æ‰‹å¡ç‰‡ -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 hover:shadow-xl transition-all duration-150 active:scale-95">
                            <div class="text-4xl mb-4">ğŸ¯</div>
                            <h3 class="text-2xl font-bold mb-4">AIçŸ­å½±éŸ³å®šä½é¡§å•</h3>
                            <p class="text-gray-600 dark:text-gray-400 mb-6">é€éå¼•å°å¼å•ç­”ï¼Œå¹«æ‚¨æ‰¾åˆ°æœ€é©åˆçš„å“ç‰Œå®šä½èˆ‡èªæ°£é¢¨æ ¼</p>
                            <a href="#!positioning" class="block w-full bg-primary text-white text-center py-3 px-6 rounded-lg hover:bg-primary-hover transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                                é–‹å§‹ä½¿ç”¨
                            </a>
                        </div>

                        <!-- é¸é¡ŒåŠ©æ‰‹å¡ç‰‡ -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 hover:shadow-xl transition-all duration-150 active:scale-95">
                            <div class="text-4xl mb-4">ğŸ’¡</div>
                            <h3 class="text-2xl font-bold mb-4">AIé¸é¡Œå°åŠ©æ‰‹</h3>
                            <p class="text-gray-600 dark:text-gray-400 mb-6">è¼¸å…¥ä¸»é¡Œé—œéµå­—ï¼Œè‡ªå‹•ç”¢ç”Ÿå¤šå€‹å¸ç›çš„å…§å®¹è§’åº¦èˆ‡åˆ‡å…¥é»</p>
                            <a href="#!ideation" class="block w-full bg-primary text-white text-center py-3 px-6 rounded-lg hover:bg-primary-hover transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                                é–‹å§‹ä½¿ç”¨
                            </a>
                        </div>

                        <!-- è…³æœ¬ç”Ÿæˆå™¨å¡ç‰‡ -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 hover:shadow-xl transition-all duration-150 active:scale-95">
                            <div class="text-4xl mb-4">ğŸ“</div>
                            <h3 class="text-2xl font-bold mb-4">AIè…³æœ¬ç”Ÿæˆå¤§å¸«</h3>
                            <p class="text-gray-600 dark:text-gray-400 mb-6">å¤šç¨®æ¨¡æ¿èˆ‡æ™‚é•·é¸æ“‡ï¼Œå¿«é€Ÿç”Ÿæˆå°ˆæ¥­çš„å…§å®¹è…³æœ¬</p>
                            <a href="#!script" class="block w-full bg-primary text-white text-center py-3 px-6 rounded-lg hover:bg-primary-hover transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-gray-800">
                                é–‹å§‹ä½¿ç”¨
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- è¨‚é–±æ–¹æ¡ˆå€å¡Š -->
            <section class="py-16 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="text-center mb-16">
                        <h2 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-6">
                            é¸æ“‡é©åˆæ‚¨çš„æ–¹æ¡ˆ
                        </h2>
                        <p class="text-xl text-gray-600 dark:text-gray-300 mb-8">
                            è§£é–æ›´å¤šAIåŠŸèƒ½ï¼Œæå‡å‰µä½œæ•ˆç‡
                        </p>
                        <div class="w-24 h-1 bg-primary mx-auto rounded-full"></div>
                    </div>

                    <!-- é»æ•¸åŒ…æ–¹æ¡ˆ -->
                    <div class="mb-16">
                        <h3 class="text-2xl font-bold text-center text-gray-900 dark:text-white mb-8">
                            ğŸ’ é»æ•¸åŒ…æ–¹æ¡ˆ
                        </h3>
                        <div class="grid md:grid-cols-3 gap-8" id="subscription-plans">
                            <!-- æ–¹æ¡ˆå¡ç‰‡å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                        </div>
                    </div>

                    <!-- è¨‚é–±æ–¹æ¡ˆ -->
                    <div class="mb-16">
                        <h3 class="text-2xl font-bold text-center text-gray-900 dark:text-white mb-8">
                            ğŸš€ è¨‚é–±æ–¹æ¡ˆ
                        </h3>
                        <div class="grid md:grid-cols-3 gap-8" id="subscription-plans-advanced">
                            <!-- é€²éšæ–¹æ¡ˆå¡ç‰‡å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                        </div>
                    </div>

                    <!-- ä¸»è¦è³¼è²·æŒ‰éˆ• -->
                    <div class="text-center">
                        <button id="purchase-btn" class="bg-gradient-to-r from-primary to-primary-hover text-white text-xl px-12 py-4 rounded-2xl hover:from-primary-hover hover:to-primary transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-primary focus:ring-opacity-50 shadow-2xl hover:shadow-primary/25 transform hover:-translate-y-1" onclick="showPurchaseModal()">
                            <span class="flex items-center justify-center gap-3">
                                ğŸ’³ ç«‹å³è³¼è²·é»æ•¸
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                                </svg>
                            </span>
                        </button>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-4">
                            å®‰å…¨æ”¯ä»˜ â€¢ å³æ™‚åˆ°å¸³ â€¢ 24/7 å®¢æœæ”¯æ´
                        </p>
                    </div>
                </div>
            </section>
            
            <!-- å®¢è£½åŒ–æ™ºèƒ½é«” CTA -->
            <section class="pt-0 pb-8">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8">
                        <h3 class="text-2xl font-bold mb-2">æƒ³è¦å®¢è£½åŒ–æ‚¨çš„çŸ­å½±éŸ³ AI æ™ºèƒ½é«”å—ï¼Ÿ</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">éœ€è¦å°ˆå±¬åŠŸèƒ½ã€å“ç‰Œèªæ°£ã€æ•´åˆå¾Œç«¯æˆ–æµç¨‹è‡ªå‹•åŒ–ï¼Ÿæˆ‘å€‘å¯å”åŠ©å¾è¦åŠƒåˆ°ä¸Šç·šã€‚</p>
                        <a class="inline-block bg-primary text-white py-2 px-4 rounded-lg hover:bg-primary-hover" target="_blank" href="https://AIJobschool.short.gy/E49kA8">èˆ‡æˆ‘å€‘è¯ç¹«ï¼ˆLINE å®˜æ–¹ï¼‰</a>
                    </div>
                </div>
            </section>
        </div>

        <!-- å®šä½åŠ©æ‰‹é é¢ -->
        <div id="page-positioning" class="page hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="grid lg:grid-cols-12 gap-8">
                    <!-- å·¦å´è¡¨å–® -->
                    <div id="positioning-left" class="space-y-6 lg:col-span-4">
                        <!-- åŠŸèƒ½æ¨™é¡Œ -->
                        <div class="text-center mb-4">
                            <h2 id="positioning-title" class="text-2xl font-bold text-gray-900 dark:text-white">ğŸ¯ AIçŸ­å½±éŸ³å®šä½é¡§å•</h2>
                            <p id="positioning-description" class="text-sm text-gray-600 dark:text-gray-400 mt-1">ç›´æ¥èˆ‡AIå°è©±ï¼Œæè¿°ä½ çš„æ¥­å‹™èˆ‡å—çœ¾ï¼Œæˆ‘æœƒä¸€æ­¥æ­¥å¼•å°ä½ å®Œæˆå®šä½åˆ†æ</p>
                        </div>
                        <!-- Tabs: AI å°è©± / ä¸€éµç”Ÿæˆ -->
                        <div id="positioning-tabs" class="flex flex-wrap md:flex-nowrap gap-2 mb-3 overflow-x-auto whitespace-nowrap">
                            <button id="tab-positioning-chat" class="shrink-0 px-3 py-1.5 rounded-lg bg-primary text-white hover:bg-primary-hover">AI å°è©±</button>
                            <button id="tab-positioning-oneclick" class="shrink-0 px-3 py-1.5 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700">ä¸€éµç”Ÿæˆ</button>
                        </div>
                        <form id="positioning-form" class="space-y-6">
                            <!-- ç”¢æ¥­ -->
                            <div>
                                <label for="industry" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ç”¢æ¥­é¡å‹ *</label>
                                <input type="text" id="industry" name="industry" required
                                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white transition-all duration-150"
                                    placeholder="ä¾‹å¦‚ï¼šç§‘æŠ€ã€æ•™è‚²ã€é¤é£²ã€é‡‘è...">
                            </div>

                            <!-- ç›®æ¨™å—çœ¾ -->
                            <div>
                                <label for="audience" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ç›®æ¨™å—çœ¾ *</label>
                                <input type="text" id="audience" name="audience" required
                                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white transition-all duration-150"
                                    placeholder="ä¾‹å¦‚ï¼š25-35æ­²ä¸Šç­æ—ã€å­¸ç”Ÿå®¶é•·ã€å°ä¼æ¥­ä¸»...">
                            </div>

                            <!-- ä¸»è¦ç—›é» -->
                            <div>
                                <label for="pains" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ä¸»è¦ç—›é» *</label>
                                <textarea id="pains" name="pains" rows="4" required
                                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white transition-all duration-150"
                                    placeholder="æè¿°æ‚¨çš„ç›®æ¨™å—çœ¾é¢è‡¨çš„ä¸»è¦å•é¡Œæˆ–æŒ‘æˆ°..."></textarea>
                            </div>

                            <!-- å“ç‰Œèªæ°£ -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">å“ç‰Œèªæ°£ *</label>
                                <div class="grid grid-cols-2 gap-3" role="radiogroup" aria-label="å“ç‰Œèªæ°£é¸æ“‡">
                                    <label class="flex items-center p-3 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150">
                                        <input type="radio" name="tone" value="professional" class="sr-only" required>
                                        <div class="tone-option w-full text-center py-2">å°ˆæ¥­</div>
                                    </label>
                                    <label class="flex items-center p-3 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150">
                                        <input type="radio" name="tone" value="friendly" class="sr-only" required>
                                        <div class="tone-option w-full text-center py-2">è¦ªåˆ‡</div>
                                    </label>
                                    <label class="flex items-center p-3 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150">
                                        <input type="radio" name="tone" value="humorous" class="sr-only" required>
                                        <div class="tone-option w-full text-center py-2">å¹½é»˜</div>
                                    </label>
                                    <label class="flex items-center p-3 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150">
                                        <input type="radio" name="tone" value="authoritative" class="sr-only" required>
                                        <div class="tone-option w-full text-center py-2">æ¬Šå¨</div>
                                    </label>
                                </div>
                            </div>

                            <!-- ç«¶å“åˆ†æ -->
                            <div>
                                <label for="competitors" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ç«¶å“åˆ†æï¼ˆé¸å¡«ï¼‰</label>
                                <input type="text" id="competitors" name="competitors"
                                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white transition-all duration-150"
                                    placeholder="åˆ—å‡ºä¸»è¦ç«¶çˆ­å°æ‰‹...">
                            </div>

                            <button type="submit" id="positioning-submit"
                                class="w-full bg-primary text-white py-3 px-6 rounded-lg hover:bg-primary-hover transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed">
                                <span class="submit-text">ç”Ÿæˆå®šä½æ‘˜è¦</span>
                                <span class="loading-text hidden">
                                    <svg class="loading-spinner w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    ç”Ÿæˆä¸­...
                                </span>
                            </button>
                        </form>
                    </div>

                    <!-- å³å´çµæœ -->
                    <div class="lg:col-span-8">
                        <!-- å®šä½ é¡§å•èŠå¤©å®¤ï¼ˆå¼·åŒ–ç‰ˆï¼‰ -->
                        <div class="mb-6">
                            <div id="positioning-chat-card" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden flex flex-col min-h-[500px] md:min-h-[600px] mx-auto max-w-4xl">
                                <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-semibold">ğŸ¯ AIå½±éŸ³å®šä½é¡§å•</h3>
                                    <button id="chat-clear-positioning" class="text-sm px-3 py-1 rounded-md border border-gray-300 hover:bg-gray-50 dark:border-gray-600">æ¸…ç©ºå°è©±</button>
                                </div>
                                <div id="chat-positioning" class="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50 dark:bg-gray-900"></div>
                                <div class="px-4 py-3 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex flex-wrap gap-2 mb-3 text-sm">
                                        <button class="chip-p btn-chip">æ¥­å‹™é¡å‹å®šä½</button>
                                        <button class="chip-p btn-chip">ç›®æ¨™å—çœ¾åˆ†æ</button>
                                        <button class="chip-p btn-chip">å“ç‰Œå½¢è±¡å®šä½</button>
                                        <button class="chip-p btn-chip">å¹³å°ç­–ç•¥å»ºè­°</button>
                                        <button class="chip-p btn-chip">å…§å®¹ç›®æ¨™è¨­å®š</button>
                                        <button class="chip-p btn-chip">ç™¼æ–‡é »ç‡è¦åŠƒ</button>
                                    </div>
                                    <div class="flex gap-2">
                                        <textarea id="chat-input-positioning" rows="2" class="flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 resize-y" placeholder="å‘Šè¨´æˆ‘ä½ çš„æ¥­å‹™ã€ç”¢å“ã€ç›®æ¨™æˆ–å›°æƒ‘...ï¼ˆEnter é€å‡ºï¼›Shift+Enter æ›è¡Œï¼‰"></textarea>
                                        <button id="chat-send-positioning" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-hover">åˆ†æ</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="positioning-result" class="hidden">
                            <h3 class="text-xl font-bold mb-4">å®šä½æ‘˜è¦</h3>
                            <div class="space-y-4">
                                <div id="positioning-loading" class="hidden text-center py-6 text-gray-500 dark:text-gray-400">
                                    <svg class="loading-spinner w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    AI å›è¦†ä¸­...
                                </div>
                                <div id="positioning-cards" class="space-y-4"></div>
                                </div>
                                </div>
                        
                        
                        <!-- ä¸€éµç”Ÿæˆé¢æ¿ï¼ˆæ²¿ç”¨æ—¢æœ‰è¡¨å–®å€å¡Šä½œç‚ºä¸€éµç”Ÿæˆè¼¸å…¥ï¼‰-->
                        <div id="positioning-oneclick-panel" class="hidden">
                            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 min-h-[380px] md:min-h-[500px] flex items-center justify-center text-center">
                                <div>
                                <div class="text-6xl mb-4">ğŸ¯</div>
                                <h2 class="text-2xl sm:text-3xl font-bold mb-3">æº–å‚™é–‹å§‹å®šä½åˆ†æ</h2>
                                <p class="text-gray-500 dark:text-gray-400">è¼¸å…¥å¿…è¦è³‡è¨Šå¾Œï¼Œç›´æ¥é€å‡ºå³å¯å¿«é€Ÿç”¢ç”Ÿå®šä½æ‘˜è¦ã€‚</p>
                                <div class="mt-4 space-y-2 text-primary">
                                  <button type="button" class="quick-example-btn hover:text-primary-hover">
                                    å¿«é€Ÿç¤ºä¾‹ï¼šç§‘æŠ€æ–°å‰µå…¬å¸
                                  </button><br/>
                                  <button type="button" class="quick-example-btn hover:text-primary-hover">
                                    å¿«é€Ÿç¤ºä¾‹ï¼šç·šä¸Šæ•™è‚²å¹³å°
                                  </button><br/>
                                  <button type="button" class="quick-example-btn hover:text-primary-hover">
                                    å¿«é€Ÿç¤ºä¾‹ï¼šå¥åº·é£Ÿå“å“ç‰Œ
                                  </button>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¸é¡ŒåŠ©æ‰‹é é¢ -->
        <div id="page-ideation" class="page hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="grid lg:grid-cols-12 gap-8">
                    <!-- å·¦å´è¡¨å–® -->
                    <div id="ideation-left" class="space-y-6 lg:col-span-4">
                        <!-- åŠŸèƒ½æ¨™é¡Œ -->
                        <div class="text-center mb-4">
                            <h2 id="ideation-title" class="text-2xl font-bold text-gray-900 dark:text-white">ğŸ’¡ AIé¸é¡Œå°åŠ©æ‰‹</h2>
                            <p id="ideation-description" class="text-sm text-gray-600 dark:text-gray-400 mt-1">ç›´æ¥èˆ‡AIå°è©±ï¼Œæè¿°ä½ çš„ä¸»é¡Œèˆ‡éœ€æ±‚ï¼Œæˆ‘æœƒä¸€æ­¥æ­¥å¼•å°ä½ å®Œæˆé¸é¡Œåˆ†æ</p>
                        </div>
                        <!-- Tabs: AI å°è©± / ä¸€éµç”Ÿæˆ -->
                        <div id="ideation-tabs" class="flex flex-wrap md:flex-nowrap gap-2 mb-3 overflow-x-auto whitespace-nowrap">
                            <button id="tab-ideation-chat" class="shrink-0 px-3 py-1.5 rounded-lg bg-primary text-white hover:bg-primary-hover">AI å°è©±</button>
                            <button id="tab-ideation-oneclick" class="shrink-0 px-3 py-1.5 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700">ä¸€éµç”Ÿæˆ</button>
                        </div>
                        <form id="ideation-form" class="space-y-6">
                            <!-- ä¸»é¡Œ/é—œéµå­— -->
                            <div>
                                <label for="topic" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ä¸»é¡Œ/é—œéµå­— *</label>
                                <input type="text" id="topic" name="topic" required
                                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white transition-all duration-150"
                                    placeholder="ä¾‹å¦‚ï¼šæ¸›è‚¥ã€ç†è²¡ã€è·å ´æŠ€èƒ½ã€è¦ªå­æ•™è‚²...">
                            </div>

                            <!-- ç”¢å‡ºæ¢æ•¸ -->
                            <div>
                                <label for="count" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">æ¬²ç”¢å‡ºæ¢æ•¸ *</label>
                                <select id="count" name="count" required
                                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white transition-all duration-150">
                                    <option value="">è«‹é¸æ“‡</option>
                                    <option value="1">1 æ¢</option>
                                    <option value="2">2 æ¢</option>
                                    <option value="3">3 æ¢</option>
                                    <option value="4">4 æ¢</option>
                                    <option value="5">5 æ¢</option>
                                    <option value="6">6 æ¢</option>
                                    <option value="7">7 æ¢</option>
                                    <option value="8">8 æ¢</option>
                                    <option value="9">9 æ¢</option>
                                    <option value="10">10 æ¢</option>
                                </select>
                            </div>

                            <!-- é¿å…é‡è¤‡ -->
                            <div class="flex items-center">
                                <input type="checkbox" id="dedupe" name="dedupe" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 dark:border-gray-600 rounded">
                                <label for="dedupe" class="ml-2 text-sm text-gray-700 dark:text-gray-300">é¿å…é‡è¤‡è§’åº¦</label>
                            </div>

                            <button type="submit" id="ideation-submit"
                                class="w-full bg-primary text-white py-3 px-6 rounded-lg hover:bg-primary-hover transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed">
                                <span class="submit-text">ç”¢ç”Ÿé¸é¡Œ</span>
                                <span class="loading-text hidden">
                                    <svg class="loading-spinner w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    ç”¢ç”Ÿä¸­...
                                </span>
                            </button>
                        </form>
                    </div>

                    <!-- å³å´çµæœ -->
                    <div class="lg:col-span-8">
                        <!-- é¸é¡Œ èŠå¤©å®¤ï¼ˆå¼·åŒ–ç‰ˆï¼‰ -->
                        <div class="mb-6">
                            <div id="ideation-chat-card" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden min-h-[500px] md:min-h-[500px] flex flex-col mx-auto max-w-4xl">
                                <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-semibold">ğŸ’¡ AIé¸é¡Œå°åŠ©æ‰‹</h3>
                                    <button id="chat-clear-ideation" class="text-sm px-3 py-1 rounded-md border border-gray-300 hover:bg-gray-50 dark:border-gray-600">æ¸…ç©ºå°è©±</button>
                                </div>
                                <div id="chat-ideation" class="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50 dark:bg-gray-900"></div>
                                <div class="px-4 py-3 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex flex-wrap gap-2 mb-3 text-sm">
                                        <button class="chip-i btn-chip">ç†±é–€è¶¨å‹¢</button>
                                        <button class="chip-i btn-chip">æ•™è‚²åˆ†äº«</button>
                                        <button class="chip-i btn-chip">å€‹äººæ•…äº‹</button>
                                        <button class="chip-i btn-chip">ç”¢å“ä»‹ç´¹</button>
                                    </div>
                                    <div class="flex gap-2">
                                        <textarea id="chat-input-ideation" rows="2" class="flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 resize-y" placeholder="å‘Šè¨´æˆ‘ä½ æƒ³è¦ä»€éº¼é¡å‹çš„é¸é¡Œéˆæ„Ÿ...ï¼ˆEnter é€å‡ºï¼›Shift+Enter æ›è¡Œï¼‰"></textarea>
                                        <button id="chat-send-ideation" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-hover">ç²å–éˆæ„Ÿ</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="ideation-result" class="hidden">
                            <h3 class="text-xl font-bold mb-4">é¸é¡Œå»ºè­°</h3>
                            <div class="space-y-4">
                                <div id="ideation-loading" class="hidden text-center py-6 text-gray-500 dark:text-gray-400">
                                    <svg class="loading-spinner w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    AI å›è¦†ä¸­...
                                </div>
                                <div id="ideation-cards" class="space-y-4"></div>
                            </div>
                        </div>
                        
                        <div id="ideation-empty" class="hidden">
                            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 min-h-[380px] md:min-h-[500px] flex items-center justify-center text-center">
                                <div>
                            <div class="text-6xl mb-4">ğŸ’¡</div>
                                <h2 class="text-2xl sm:text-3xl font-bold mb-3">æº–å‚™ç”¢ç”Ÿå‰µæ„é¸é¡Œ</h2>
                                <p class="text-gray-500 dark:text-gray-400">è¼¸å…¥ä¸»é¡Œé—œéµå­—ï¼Œæˆ‘å€‘å°‡ç‚ºæ‚¨ç”¢ç”Ÿå¤šå€‹å¸ç›çš„è§’åº¦</p>
                                <div class="mt-4 space-y-2 text-primary">
                                  <button type="button" class="quick-example-btn hover:text-primary-hover">
                                    å¿«é€Ÿç¤ºä¾‹ï¼šæ¸›è‚¥æ–¹æ³•
                                  </button><br/>
                                  <button type="button" class="quick-example-btn hover:text-primary-hover">
                                    å¿«é€Ÿç¤ºä¾‹ï¼šæŠ•è³‡ç†è²¡
                                  </button><br/>
                                  <button type="button" class="quick-example-btn hover:text-primary-hover">
                                    å¿«é€Ÿç¤ºä¾‹ï¼šè·å ´æŠ€èƒ½
                                </button>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è…³æœ¬ç”Ÿæˆå™¨é é¢ -->
        <div id="page-script" class="page hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="grid lg:grid-cols-12 gap-8">
                    <!-- å·¦å´æ§åˆ¶å€ -->
                    <div class="space-y-8 lg:col-span-4">
                        <div>
                            <h2 class="text-3xl font-bold mb-2">AIè…³æœ¬ç”Ÿæˆå¤§å¸«</h2>
                            <p class="text-gray-600 dark:text-gray-400">ç›´æ¥èˆ‡AIå°è©±ï¼Œæè¿°ä½ çš„è…³æœ¬éœ€æ±‚èˆ‡é¢¨æ ¼ï¼Œæˆ‘æœƒä¸€æ­¥æ­¥å¼•å°ä½ å®Œæˆè…³æœ¬å‰µä½œ</p>
                        </div>
                    </div>

                    <!-- å³å´é è¦½å€ -->
                    <div class="lg:col-span-8">
                        <!-- åˆ‡æ›ï¼šAI å°è©± / ä¸€éµç”Ÿæˆ -->
                        <div id="script-tabs" class="relative z-10 flex flex-wrap md:flex-nowrap gap-2 mb-3 overflow-x-auto whitespace-nowrap">
                            <button id="tab-script-chat" onclick="window.switchScriptTab && window.switchScriptTab('chat')" class="pointer-events-auto shrink-0 px-3 py-1.5 rounded-lg bg-primary text-white hover:bg-primary-hover">AI å°è©±</button>
                            <button id="tab-script-oneclick" onclick="window.switchScriptTab && window.switchScriptTab('one')" class="pointer-events-auto shrink-0 px-3 py-1.5 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700">ä¸€éµç”Ÿæˆ</button>
                        </div>
                        <!-- è…³æœ¬ èŠå¤©å®¤ï¼ˆå¼·åŒ–ç‰ˆï¼‰ -->
                        <div id="script-chat-panel" class="mb-6">
                            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden mx-auto max-w-4xl">
                                <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="text-lg font-semibold">ğŸ“ AIè…³æœ¬ç”Ÿæˆå¤§å¸«</h3>
                                    <button id="chat-clear-script" class="text-sm px-3 py-1 rounded-md border border-gray-300 hover:bg-gray-50 dark:border-gray-600">æ¸…ç©ºå°è©±</button>
                                </div>
                                <div id="chat-script" class="h-96 sm:h-96 overflow-y-auto p-4 space-y-3 bg-gray-50 dark:bg-gray-900"></div>
                                <div class="px-4 py-3 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex flex-wrap gap-2 mb-3 text-sm">
                                        <button class="chip-s btn-chip">å¦‚ä½•å¯«å‡ºå¸å¼•äººçš„é–‹é ­ï¼Ÿ</button>
                                        <button class="chip-s btn-chip">è…³æœ¬çµæ§‹æ€éº¼å®‰æ’ï¼Ÿ</button>
                                        <button class="chip-s btn-chip">å¦‚ä½•å¢åŠ è§€çœ¾äº’å‹•ï¼Ÿ</button>
                                        <button class="chip-s btn-chip">çµå°¾æ€éº¼è¨­è¨ˆï¼Ÿ</button>
                                        <button class="chip-s btn-chip">å¦‚ä½•é¸æ“‡åˆé©çš„æ™‚é•·ï¼Ÿ</button>
                                        <button class="chip-s btn-chip">å¦‚ä½•è®“è…³æœ¬æ›´æœ‰å‰µæ„ï¼Ÿ</button>
                                    </div>
                                    <div class="flex gap-2">
                                        <textarea id="chat-input-script" rows="2" class="flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 resize-y" placeholder="è¼¸å…¥ä¸»é¡Œ/ç›®æ¨™/å—çœ¾/å¹³å°/æ™‚é•·/èªæ°£â€¦ï¼ˆEnter é€å‡ºï¼›Shift+Enter æ›è¡Œï¼‰"></textarea>
                                        <button id="chat-send-script" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-hover">é€å‡º</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- ä¸€éµç”Ÿæˆ é¢æ¿ -->
                        <div id="script-oneclick-panel" class="hidden mb-6">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- å·¦å´è¨­å®š -->
                                <div class="space-y-6">
                                    <!-- æ¨¡å¼é¸æ“‡å¡ç‰‡ -->
                                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                                        <h3 class="text-lg font-semibold mb-4">æ¨¡å¼é¸æ“‡</h3>
                                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                            <label class="mode-option flex items-center justify-center p-4 rounded-lg border border-gray-300 dark:border-gray-600 cursor-pointer transition-all duration-200 has-[:checked]:border-primary has-[:checked]:bg-primary has-[:checked]:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
                                                <input type="radio" name="script_mode" value="educational" class="hidden" checked>
                                                <span class="text-center">æ•™è‚²å‹</span>
                                            </label>
                                            <label class="mode-option flex items-center justify-center p-4 rounded-lg border border-gray-300 dark:border-gray-600 cursor-pointer transition-all duration-200 has-[:checked]:border-primary has-[:checked]:bg-primary has-[:checked]:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
                                                <input type="radio" name="script_mode" value="entertainment" class="hidden">
                                                <span class="text-center">å¨›æ¨‚å‹</span>
                                            </label>
                                            <label class="mode-option flex items-center justify-center p-4 rounded-lg border border-gray-300 dark:border-gray-600 cursor-pointer transition-all duration-200 has-[:checked]:border-primary has-[:checked]:bg-primary has-[:checked]:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
                                                <input type="radio" name="script_mode" value="promotional" class="hidden">
                                                <span class="text-center">æ¨å»£å‹</span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- æ¨¡æ¿é¸æ“‡å¡ç‰‡ -->
                                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                                        <h3 class="text-lg font-semibold mb-4">æ¨¡æ¿é¸æ“‡</h3>
                                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                            <label class="template-card flex flex-col items-center p-4 rounded-lg border border-gray-300 dark:border-gray-600 cursor-pointer transition-all duration-200 has-[:checked]:border-primary has-[:checked]:bg-primary has-[:checked]:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
                                                <input type="radio" name="script_template" value="A" class="hidden" checked>
                                                <span class="text-xl mb-2">A</span>
                                                <span class="text-sm">ä¸‰æ®µå¼</span>
                                            </label>
                                            <label class="template-card flex flex-col items-center p-4 rounded-lg border border-gray-300 dark:border-gray-600 cursor-pointer transition-all duration-200 has-[:checked]:border-primary has-[:checked]:bg-primary has-[:checked]:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
                                                <input type="radio" name="script_template" value="B" class="hidden">
                                                <span class="text-xl mb-2">B</span>
                                                <span class="text-sm">å•é¡Œè§£æ±º</span>
                                            </label>
                                            <label class="template-card flex flex-col items-center p-4 rounded-lg border border-gray-300 dark:border-gray-600 cursor-pointer transition-all duration-200 has-[:checked]:border-primary has-[:checked]:bg-primary has-[:checked]:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
                                                <input type="radio" name="script_template" value="C" class="hidden">
                                                <span class="text-xl mb-2">C</span>
                                                <span class="text-sm">æ•…äº‹æ•˜è¿°</span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- æ™‚é•·é¸æ“‡å¡ç‰‡ -->
                                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                                        <h3 class="text-lg font-semibold mb-4">æ™‚é•·é¸æ“‡</h3>
                                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                            <label class="duration-option flex items-center justify-center p-4 rounded-lg border border-gray-300 dark:border-gray-600 cursor-pointer transition-all duration-200 has-[:checked]:border-primary has-[:checked]:bg-primary has-[:checked]:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
                                                <input type="radio" name="script_duration" value="30" class="hidden" checked>
                                                <span class="text-center">30ç§’</span>
                                            </label>
                                            <label class="duration-option flex items-center justify-center p-4 rounded-lg border border-gray-300 dark:border-gray-600 cursor-pointer transition-all duration-200 has-[:checked]:border-primary has-[:checked]:bg-primary has-[:checked]:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
                                                <input type="radio" name="script_duration" value="60" class="hidden">
                                                <span class="text-center">60ç§’</span>
                                            </label>
                                            <label class="duration-option flex items-center justify-center p-4 rounded-lg border border-gray-300 dark:border-gray-600 cursor-pointer transition-all duration-200 has-[:checked]:border-primary has-[:checked]:bg-primary has-[:checked]:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
                                                <input type="radio" name="script_duration" value="90" class="hidden">
                                                <span class="text-center">90ç§’</span>
                                            </label>
                                        </div>
                                        
                                        <!-- å¥—ç”¨è¨­å®šæŒ‰éˆ• -->
                                        <div class="mt-6">
                                            <button id="apply-settings-generate" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-6 rounded-lg transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                                                <span class="apply-text">å¥—ç”¨è¨­å®šä¸¦ç”Ÿæˆè…³æœ¬</span>
                                                <span class="apply-loading hidden">
                                                    <svg class="loading-spinner w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                                    </svg>
                                                    ç”Ÿæˆä¸­...
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å³å´ä¸»é¡Œè¼¸å…¥èˆ‡çµæœ -->
                                <div>
                                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 min-h-[380px] md:min-h-[500px] flex flex-col">
                                        <h3 class="text-lg font-semibold mb-4">è¼¸å…¥ä¸»é¡Œ</h3>
                                        <textarea id="script-topic-input" class="flex-1 p-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-primary focus:border-primary resize-none" placeholder="è«‹è¼¸å…¥æ‚¨çš„è…³æœ¬ä¸»é¡Œï¼Œä¾‹å¦‚ï¼šå¦‚ä½•è£½ä½œçˆ†æ¬¾çŸ­å½±éŸ³"></textarea>
                                        
                                        <div class="mt-4 flex justify-end">
                                            <button id="oneclick-generate" class="bg-primary text-white py-3 px-6 rounded-lg hover:bg-primary-hover transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                                                <span class="submit-text">ç”Ÿæˆè…³æœ¬</span>
                                                <span class="loading-text hidden">
                                                    <svg class="loading-spinner w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                                    </svg>
                                                    ç”Ÿæˆä¸­...
                                                </span>
                                            </button>
                                        </div>
                                        
                                        <!-- çµæœé¡¯ç¤ºå€åŸŸ -->
                                        <div id="script-result" class="hidden mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                                            <h4 class="font-semibold text-gray-900 dark:text-white mb-2">ç”Ÿæˆçµæœ</h4>
                                            <div id="script-content" class="text-gray-600 dark:text-gray-400 whitespace-pre-line"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- èªªæ˜/æŒ‡å—é é¢ -->
        <div id="page-guide" class="page hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                    <h3 class="text-2xl font-bold mb-2">ğŸ¯ AIçŸ­å½±éŸ³å®šä½é¡§å•</h3>
                    <h4 class="font-semibold mb-2">åŠŸèƒ½èªªæ˜</h4>
                    <p class="text-gray-600 dark:text-gray-400">â€¢ <strong>å¸³è™Ÿå®šä½åˆ†æ</strong>ï¼šå¹«åŠ©é‡æ¸…ä½ çš„æ¥­å‹™é¡å‹ã€ç›®æ¨™å—çœ¾ã€å“ç‰Œå½¢è±¡<br/>â€¢ <strong>å¹³å°ç­–ç•¥å»ºè­°</strong>ï¼šæ ¹æ“šä½ çš„å®šä½æ¨è–¦æœ€é©åˆçš„å¹³å°<br/>â€¢ <strong>å…§å®¹æ–¹å‘è¦åŠƒ</strong>ï¼šå»ºç«‹å®Œæ•´çš„å…§å®¹ç­–ç•¥åŸºç¤<br/>â€¢ <strong>å®šä½æª”æ¡ˆç®¡ç†</strong>ï¼šè‡ªå‹•è¨˜éŒ„å’Œæ›´æ–°ä½ çš„å®šä½è³‡è¨Š</p>
                    <h4 class="font-semibold mt-4 mb-2">ä½¿ç”¨æ–¹å¼</h4>
                    <p class="text-gray-600 dark:text-gray-400">1ï¸âƒ£ é»æ“Šã€Œå¿«é€Ÿå•é¡Œã€é–‹å§‹å®šä½åˆ†æ<br/>2ï¸âƒ£ å›ç­”AIçš„å•é¡Œï¼Œå»ºç«‹ä½ çš„å®šä½æª”æ¡ˆ<br/>3ï¸âƒ£ ä½¿ç”¨ã€ŒğŸš€ ä¸€éµç”Ÿæˆå®šä½ã€å¿«é€Ÿå»ºç«‹å®Œæ•´å®šä½<br/>4ï¸âƒ£ å®šä½æª”æ¡ˆæœƒè‡ªå‹•å„²å­˜ä¸¦åŒæ­¥åˆ°å…¶ä»–åŠŸèƒ½</p>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                    <h3 class="text-2xl font-bold mb-2">ğŸ’¡ AIé¸é¡Œå°åŠ©æ‰‹</h3>
                    <h4 class="font-semibold mb-2">åŠŸèƒ½èªªæ˜</h4>
                    <p class="text-gray-600 dark:text-gray-400">â€¢ <strong>å€‹æ€§åŒ–é¸é¡Œ</strong>ï¼šåŸºæ–¼ä½ çš„å®šä½æª”æ¡ˆç”Ÿæˆç›¸é—œé¸é¡Œ<br/>â€¢ <strong>ç†±é»çµåˆ</strong>ï¼šçµåˆç•¶å‰ç†±é–€è©±é¡Œèˆ‡ä½ çš„å“ç‰Œç‰¹è‰²<br/>â€¢ <strong>å­£ç¯€æ€§å…§å®¹</strong>ï¼šè€ƒæ…®æ™‚ç¯€èˆ‡ç¯€æ—¥æä¾›é©æ™‚å»ºè­°<br/>â€¢ <strong>é¸é¡Œé¡å‹ç¯©é¸</strong>ï¼šç†±é–€è¶¨å‹¢ã€æ•™è‚²åˆ†äº«ã€å€‹äººæ•…äº‹ã€ç”¢å“ä»‹ç´¹</p>
                    <h4 class="font-semibold mt-4 mb-2">ä½¿ç”¨æ–¹å¼</h4>
                    <p class="text-gray-600 dark:text-gray-400">1ï¸âƒ£ å…ˆå®Œæˆå®šä½åˆ†æï¼Œå»ºç«‹ä½ çš„å®šä½æª”æ¡ˆ<br/>2ï¸âƒ£ é¸æ“‡é¸é¡Œé¡å‹ï¼ˆç†±é–€è¶¨å‹¢ã€æ•™è‚²åˆ†äº«ç­‰ï¼‰<br/>3ï¸âƒ£ é»æ“Šã€Œç²å–éˆæ„Ÿã€ç²å¾—å€‹æ€§åŒ–é¸é¡Œå»ºè­°<br/>4ï¸âƒ£ æŸ¥çœ‹ã€Œä»Šæ—¥é¸é¡Œå»ºè­°ã€å’Œã€Œæ­·å²è¨˜éŒ„ã€</p>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                    <h3 class="text-2xl font-bold mb-2">ğŸ“ AIè…³æœ¬ç”Ÿæˆå¤§å¸«</h3>
                    <h4 class="font-semibold mb-2">åŠŸèƒ½èªªæ˜</h4>
                    <p class="text-gray-600 dark:text-gray-400">â€¢ <strong>ä¸€éµç”Ÿæˆè…³æœ¬</strong>ï¼šæ ¹æ“šä¸»é¡Œå¿«é€Ÿç”Ÿæˆå®Œæ•´è…³æœ¬<br/>â€¢ <strong>å¼•å°æ¨¡å¼</strong>ï¼šé¸æ“‡çµæ§‹æ¨¡æ¿å’Œæ™‚é•·ï¼ŒAIé€æ­¥å¼•å°<br/>â€¢ <strong>è‡ªç”±æ¨¡å¼</strong>ï¼šè‡ªç”±è¨è«–éœ€æ±‚ï¼ŒAIæä¾›å‰µæ„å»ºè­°<br/>â€¢ <strong>å¤šç¨®æ¨¡æ¿</strong>ï¼šæ”¯æ´ A-F å…­ç¨®è…³æœ¬çµæ§‹æ¨¡æ¿<br/>â€¢ <strong>æ™‚é•·éˆæ´»</strong>ï¼šæ”¯æ´ 30 ç§’èˆ‡ 60 ç§’è…³æœ¬</p>
                    <h4 class="font-semibold mt-4 mb-2">ä½¿ç”¨æ–¹å¼</h4>
                    <p class="text-gray-600 dark:text-gray-400">1ï¸âƒ£ ä¸€éµç”Ÿæˆï¼šå¥—ç”¨è¨­å®šå¾Œè¼¸å…¥ä¸»é¡Œå³å¯<br/>2ï¸âƒ£ å¼•å°æ¨¡å¼ï¼šé¸æ“‡çµæ§‹æ¨¡æ¿èˆ‡æ™‚é•·ï¼Œè¼¸å…¥ä¸»é¡Œé–‹å§‹<br/>3ï¸âƒ£ è‡ªç”±æ¨¡å¼ï¼šç›´æ¥è¼¸å…¥éœ€æ±‚ï¼Œèˆ‡ AI è‡ªç”±è¨è«–<br/>4ï¸âƒ£ æŸ¥çœ‹ã€Œè…³æœ¬åˆ†æ®µ/æ™‚é–“è»¸ã€</p>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                    <h3 class="text-2xl font-bold mb-2">ğŸ’¾ è³‡æ–™å„²å­˜èˆ‡ç®¡ç†</h3>
                    <p class="text-gray-600 dark:text-gray-400">â€¢ <strong>å®šä½æª”æ¡ˆ</strong>ï¼šè‡ªå‹•å„²å­˜åœ¨è³‡æ–™åº«ä¸­<br/>â€¢ <strong>é¸é¡Œå»ºè­°</strong>ï¼šå„²å­˜åœ¨ã€Œä»Šæ—¥é¸é¡Œå»ºè­°ã€èˆ‡ã€Œæ­·å²è¨˜éŒ„ã€<br/>â€¢ <strong>è…³æœ¬ç­†è¨˜</strong>ï¼šå„²å­˜åœ¨ã€Œè…³æœ¬åˆ†æ®µ/æ™‚é–“è»¸ã€</p>
                    <p class="text-gray-600 dark:text-gray-400 mt-2">æ‰€æœ‰è³‡æ–™æœƒè‡ªå‹•åŒæ­¥åˆ°å…¶ä»–åŠŸèƒ½ï¼Œè®“ AI èƒ½å¤ æ ¹æ“šä½ çš„æ­·å²è¨˜éŒ„æä¾›æ›´ç²¾æº–çš„å»ºè­°ã€‚</p>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                    <h3 class="text-2xl font-bold mb-2">ğŸš€ ä½¿ç”¨å»ºè­°</h3>
                    <p class="text-gray-600 dark:text-gray-400">1. å…ˆä½¿ç”¨å®šä½æ™ºèƒ½é«”å»ºç«‹åŸºæœ¬å®šä½<br/>2. å†ä½¿ç”¨é¸é¡Œæ™ºèƒ½é«”ç²å–å€‹æ€§åŒ–å»ºè­°<br/>3. æœ€å¾Œä½¿ç”¨è…³æœ¬ç”Ÿæˆå¤§å¸«å‰µä½œå…·é«”å…§å®¹</p>
                </div>
            </div>
        </div>
    </main>

    <!-- å…¨ç«™é å°¾ï¼šå¤–éƒ¨é€£çµ + ç‰ˆæ¬Š -->
    <footer class="border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 mt-8 safe-x safe-b">
        <div class="max-w-7xl mx-auto w-full py-6">
            <div class="flex flex-wrap gap-3 mb-4">
                <a class="px-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-50 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 text-gray-700 dark:text-gray-300" target="_blank" href="https://AIJobschool.short.gy/kBmUAL">AIJob YouTube</a>
                <a class="px-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-50 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 text-gray-700 dark:text-gray-300" target="_blank" href="https://AIJobschool.short.gy/ytPY3U">AIJob å®˜æ–¹ç¶²ç«™</a>
                <a class="px-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-50 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 text-gray-700 dark:text-gray-300" target="_blank" href="https://AIJobschool.short.gy/KCYu7z">AIJob è¡ŒéŠ·è‡ªå‹•åŒ–èª²ç¨‹</a>
                <a class="px-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-50 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 text-gray-700 dark:text-gray-300" target="_blank" href="https://AIJobschool.short.gy/UUwpEG">AIJob Discordç¤¾ç¾¤è¨è«–</a>
                <a class="px-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-50 hover:text-gray-900 dark:hover:bg-gray-700 dark:hover:text-gray-100 text-gray-700 dark:text-gray-300" target="_blank" href="https://AIJobschool.short.gy/E49kA8">AIJob LINEå®˜æ–¹å¸³è™Ÿ</a>
            </div>
            <div class="text-center text-gray-500 dark:text-gray-400">Â© 2025 AIJobSchool ç‰ˆæ¬Šæ‰€æœ‰</div>
        </div>
    </footer>

    <script>
        // API Baseï¼ˆè‡ªå‹•åµæ¸¬æœ¬æ©Ÿæˆ–é›²ç«¯ï¼‰
        const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:8080' : 'https://aijobvideobackend.zeabur.app';
        // æœƒå“¡ API baseï¼ˆå¯èˆ‡ä¸» API ç›¸åŒï¼‰
        const ACCOUNT_API = API_BASE;
        // åŠŸèƒ½æ‰£é»è¨­å®šï¼ˆå¯ä¾å¯¦éš›èª¿æ•´ï¼‰
        const CREDIT_COSTS = { positioning: 5, topics: 3, script: 8 };

        // å…¨åŸŸè®Šæ•¸
        let currentPage = 'home';
        let isDarkMode = localStorage.getItem('darkMode') === 'true';

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            initRouter();
            initMobileMenu();
            initPositioning();
            initIdeation();
            initScript();
            initAuth();
            // èˆ‡å¾Œç«¯ Session å°é½Šï¼Œé¿å… localStorage æ®˜ç•™å°è‡´èª¤é¡¯ç¤ºå·²ç™»å…¥
            (async function syncSession(){
                try{
                    const me = await fetch(`${API_BASE}/me`, { credentials:'include' }).then(r=> r.ok ? r.json() : null);
                    if (me && me.id){
                        localStorage.setItem('isLoggedIn','true');
                        localStorage.setItem('user', JSON.stringify(me));
                    } else {
                        localStorage.setItem('isLoggedIn','false');
                        localStorage.removeItem('user');
                    }
                }catch(_){ /* å¿½ç•¥ç¶²è·¯éŒ¯èª¤ */ }
            })();
            initChats();
            loadStoredData();
            adjustPositioningHeights();
            window.addEventListener('resize', adjustPositioningHeights);
        });

        // ä¸»é¡Œåˆ‡æ›åŠŸèƒ½
        function initTheme() {
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');

            // è¨­å®šåˆå§‹ä¸»é¡Œ
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
                console.log('åˆå§‹åŒ–å¤œé–“æ¨¡å¼'); // èª¿è©¦ä¿¡æ¯
            } else {
                document.documentElement.classList.remove('dark');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
                console.log('åˆå§‹åŒ–æ—¥é–“æ¨¡å¼'); // èª¿è©¦ä¿¡æ¯
            }

            themeToggle.addEventListener('click', function() {
                isDarkMode = !isDarkMode;
                localStorage.setItem('darkMode', isDarkMode);
                
                console.log('åˆ‡æ›å¤œé–“æ¨¡å¼:', isDarkMode); // èª¿è©¦ä¿¡æ¯
                
                if (isDarkMode) {
                    document.documentElement.classList.add('dark');
                    sunIcon.classList.add('hidden');
                    moonIcon.classList.remove('hidden');
                    showToast('å·²åˆ‡æ›åˆ°å¤œé–“æ¨¡å¼', 'success');
                } else {
                    document.documentElement.classList.remove('dark');
                    sunIcon.classList.remove('hidden');
                    moonIcon.classList.add('hidden');
                    showToast('å·²åˆ‡æ›åˆ°æ—¥é–“æ¨¡å¼', 'success');
                }
                
                // å¼·åˆ¶é‡æ–°æ¸²æŸ“
                document.body.offsetHeight;
            });
        }

        // è·¯ç”±ç³»çµ±
        function initRouter() {
            // è™•ç†å°è¦½é€£çµé»æ“Š
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.dataset.page;
                    navigateToPage(page);
                });
            });

            // è™•ç†é¦–é å¡ç‰‡é»æ“Š
            document.querySelectorAll('a[href^="#!"]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('href').replace('#!', '');
                    navigateToPage(page);
                });
            });

            // ç›£è½ç€è¦½å™¨å‰é€²/å¾Œé€€
            window.addEventListener('hashchange', function() {
                const hash = window.location.hash.replace('#!', '') || 'home';
                navigateToPage(hash);
            });

            // åˆå§‹åŒ–é é¢
            const hash = window.location.hash.replace('#!', '') || 'home';
            navigateToPage(hash);
        }

        function navigateToPage(page) {
            // éš±è—æ‰€æœ‰é é¢
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            
            // é¡¯ç¤ºç›®æ¨™é é¢
            const targetPage = document.getElementById(`page-${page}`);
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('fade-in');
                currentPage = page;
                
                // æ›´æ–° URL
                window.location.hash = `#!${page}`;
                
                // æ›´æ–°å°è¦½ç‹€æ…‹
                updateNavigation(page);
            }
        }

        function updateNavigation(activePage) {
            document.querySelectorAll('.nav-link').forEach(link => {
                if (link.dataset.page === activePage) {
                    link.classList.add('text-primary', 'font-semibold');
                    link.classList.remove('text-gray-700', 'dark:text-gray-300');
                } else {
                    link.classList.remove('text-primary', 'font-semibold');
                    link.classList.add('text-gray-700', 'dark:text-gray-300');
                }
            });
        }

        function initMobileMenu() {
            const btn = document.getElementById('mobile-menu-btn');
            const menu = document.getElementById('mobile-menu');
            if (!btn || !menu) return;
    btn.addEventListener('click', () => menu.classList.toggle('hidden'));
    // é»æ“Šå°è¦½é€£çµè‡ªå‹•æ”¶åˆ
    menu.querySelectorAll('a').forEach(a => a.addEventListener('click', () => menu.classList.add('hidden')));
    // é»æ“Šå¤–éƒ¨æ”¶åˆ
    document.addEventListener('click', (e) => {
        const within = menu.contains(e.target) || btn.contains(e.target);
        if (!within) menu.classList.add('hidden');
    });
            // é»å“ç‰Œè¿”å›é¦–é 
            const brand = document.querySelector('nav a[data-page="home"]');
            if (brand) brand.addEventListener('click', (e)=>{ e.preventDefault(); navigateToPage('home'); });
        }

        // å¿«é€Ÿç¤ºä¾‹å¡«å…¥åŠŸèƒ½
        function fillPositioningExample(type) {
            const examples = {
                'tech': {
                    industry: 'ç§‘æŠ€æ–°å‰µ',
                    audience: '25-35æ­²ç§‘æŠ€å¾æ¥­è€…ã€æŠ•è³‡äººã€å‰µæ¥­è€…',
                    painPoints: 'æŠ€è¡“é–€æª»é«˜ã€å¸‚å ´ç«¶çˆ­æ¿€çƒˆã€è³‡é‡‘éœ€æ±‚å¤§ã€äººæ‰æ‹›å‹Ÿå›°é›£ã€ç”¢å“å¸‚å ´å¥‘åˆåº¦ä¸ç¢ºå®š'
                },
                'education': {
                    industry: 'ç·šä¸Šæ•™è‚²',
                    audience: '25-40æ­²ä¸Šç­æ—ã€å­¸ç”Ÿå®¶é•·ã€çµ‚èº«å­¸ç¿’è€…',
                    painPoints: 'æ™‚é–“æœ‰é™ã€å­¸ç¿’æ•ˆæœä¸ç¢ºå®šã€èª²ç¨‹å“è³ªåƒå·®ä¸é½Šã€ç¼ºä¹äº’å‹•æ€§ã€å­¸ç¿’å‹•æ©Ÿä¸è¶³'
                },
                'health': {
                    industry: 'å¥åº·é£Ÿå“',
                    audience: '30-50æ­²æ³¨é‡å¥åº·çš„æ¶ˆè²»è€…ã€å¥èº«æ„›å¥½è€…ã€æ…¢æ€§ç—…æ‚£è€…',
                    painPoints: 'ç”¢å“çœŸå½é›£è¾¨ã€æ•ˆæœä¸æ˜é¡¯ã€åƒ¹æ ¼æ˜‚è²´ã€ç¼ºä¹å°ˆæ¥­æŒ‡å°ã€å‰¯ä½œç”¨æ“”æ†‚'
                }
            };
            
            const example = examples[type];
            if (!example) return;
            
            // å¡«å…¥è¡¨å–®æ¬„ä½
            const industryInput = document.querySelector('input[name="industry"]');
            const audienceInput = document.querySelector('input[name="audience"]');
            const painPointsInput = document.querySelector('textarea[name="pains"]');
            
            if (industryInput) industryInput.value = example.industry;
            if (audienceInput) audienceInput.value = example.audience;
            if (painPointsInput) painPointsInput.value = example.painPoints;
            
            // é¡¯ç¤ºæˆåŠŸæç¤º
            showToast('å·²å¡«å…¥ç¤ºä¾‹è³‡æ–™', 'success');
        }

        // ç°¡æ˜“ç™»å…¥ç³»çµ±ï¼ˆåƒè€ƒ login.htmlï¼‰
        function initAuth() {
            const loginBtn = document.getElementById('login-btn');
            const dropdown = document.getElementById('user-dropdown');
            const logoutBtn = document.getElementById('logout-btn');
            const drawer = document.getElementById('account-drawer');
            const overlay = document.getElementById('drawer-overlay');
            const drawerClose = document.getElementById('drawer-close');
            const drawerLogout = document.getElementById('drawer-logout-btn');
            const emailOpen = document.getElementById('email-login-open');
            const emailModal = document.getElementById('email-modal');
            const emailClose = document.getElementById('email-modal-close');
            const emailCancel = document.getElementById('email-modal-cancel');
            const emailSubmit = document.getElementById('email-login-submit');
            const emailInput = document.getElementById('email-login-input');
            const emailOverlay = document.getElementById('email-modal-overlay');
            const emailPage = document.getElementById('email-auth-page');
            const emailPageClose = document.getElementById('email-auth-close');
            const emailPageOverlay = document.getElementById('email-auth-overlay');
            const btnEmailLogin = document.getElementById('btn-email-login');
            const btnEmailSignup = document.getElementById('btn-email-signup');
            if (!loginBtn) return;

            function closeEmailPage(){
                if (emailPage) emailPage.classList.add('hidden');
                document.documentElement.classList.remove('modal-open');
            }

            function refreshUserUI() {
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                const userRaw = localStorage.getItem('user');
                const creditsWrap = document.getElementById('nav-credits-wrap');
                
                if (isLoggedIn && userRaw) {
                    const u = JSON.parse(userRaw);
                    loginBtn.textContent = u.name || 'Google ç”¨æˆ¶';
                    loginBtn.classList.add('bg-orange-100', 'text-orange-800', 'border-orange-200');
                    loginBtn.classList.remove('bg-gray-100', 'text-gray-700');
                    // é¡¯ç¤º Credits å€å¡Š
                    if (creditsWrap) creditsWrap.classList.remove('hidden');
                    
                    // æ›´æ–°ä¸‹æ‹‰é¸å–®å…§å®¹
                    document.getElementById('user-name').textContent = u.name || 'Google ç”¨æˆ¶';
                    document.getElementById('user-email').textContent = u.email || 'user@gmail.com';
                    document.getElementById('user-avatar').textContent = u.name ? u.name.charAt(0).toUpperCase() : 'G';
                    // æ›´æ–°æŠ½å±œå…§å®¹
                    document.getElementById('acc-name').textContent = u.name || 'Google ç”¨æˆ¶';
                    document.getElementById('acc-email').textContent = u.email || 'user@gmail.com';
                    document.getElementById('acc-avatar').textContent = u.name ? u.name.charAt(0).toUpperCase() : 'G';
                    // åŒæ­¥å¾Œç«¯é»æ•¸/æ–¹æ¡ˆ
                    fetchAccountSummary(u).catch(()=>{});
                    // è‹¥æœ¬åœ°å·²æœ‰é»æ•¸ï¼Œå…ˆè¡Œé¡¯ç¤ºï¼ˆå¾Œç«¯å›ä¾†æœƒè¦†è“‹ï¼‰
                    if (typeof u.credits === 'number') {
                        const navC = document.getElementById('nav-credits'); if (navC) navC.textContent = u.credits;
                        const accC = document.getElementById('acc-credits'); if (accC) accC.textContent = u.credits;
                    }
                } else {
                    loginBtn.textContent = 'ç™»å…¥';
                    loginBtn.classList.remove('bg-orange-100', 'text-orange-800', 'border-orange-200');
                    loginBtn.classList.add('bg-gray-100', 'text-gray-700');
                    // æœªç™»å…¥éš±è— Credits å€å¡Š
                    if (creditsWrap) creditsWrap.classList.add('hidden');
                    // é¡¯ç¤º Email ç™»å…¥æŒ‰éˆ•ï¼ˆæœªç™»å…¥æ™‚ï¼‰
                    if (emailOpen) emailOpen.classList.remove('hidden');
                }
            }

            loginBtn.addEventListener('click', () => {
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                if (!isLoggedIn) {
                    // é¡¯ç¤º Email å…¨ç•«é¢é ï¼ˆä½¿ç”¨è€…å¯æ”¹é»å³ä¸Šè§’ Google ç™»å…¥ï¼‰
                    if (emailPage) {
                        emailPage.classList.remove('hidden');
                        document.documentElement.classList.add('modal-open');
                    }
                } else {
                    // é–‹å•Ÿå¸³è™ŸæŠ½å±œ
                    drawer.classList.remove('translate-x-full');
                    overlay.classList.remove('hidden');
                }
            });

            // Email ç™»å…¥ Modal æ§åˆ¶ï¼ˆèˆŠï¼Œæš«ä¿ç•™ï¼‰
            function openEmailModal(){ if (emailModal) emailModal.classList.remove('hidden'); emailInput?.focus(); }
            function closeEmailModal(){ if (emailModal) emailModal.classList.add('hidden'); emailInput.value=''; }
            emailOpen?.addEventListener('click', openEmailModal);
            emailClose?.addEventListener('click', closeEmailModal);
            emailCancel?.addEventListener('click', closeEmailModal);
            emailOverlay?.addEventListener('click', closeEmailModal);

            emailSubmit?.addEventListener('click', async () => {
                const email = (emailInput?.value || '').trim();
                if (!email) { showToast('è«‹è¼¸å…¥ Email', 'error'); return; }
                try{
                    const res = await fetch(`${API_BASE}/auth/email/start`, {
                        method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email })
                    });
                    if (!res.ok) throw new Error('send failed');
                    showToast('å·²å¯„å‡ºç™»å…¥é€£çµï¼Œè«‹è‡³ä¿¡ç®±æŸ¥æ”¶', 'success');
                    closeEmailModal();
                }catch(e){
                    showToast('å¯„é€å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
                }
            });

            // Email å…¨ç•«é¢é ï¼šé—œé–‰
            emailPageClose?.addEventListener('click', closeEmailPage);
            emailPageOverlay?.addEventListener('click', closeEmailPage);
            document.addEventListener('keydown', (e)=>{
                if (e.key === 'Escape' && emailPage && !emailPage.classList.contains('hidden')) {
                    closeEmailPage();
                }
            });

            // Email ç™»å…¥ï¼šPOST /auth/login
            btnEmailLogin?.addEventListener('click', async ()=>{
                const identifier = (document.getElementById('login-identifier')?.value||'').trim();
                const password = (document.getElementById('login-password')?.value||'').trim();
                if (!identifier || !password){ showToast('è«‹è¼¸å…¥å¸³è™Ÿèˆ‡å¯†ç¢¼', 'error'); return; }
                try{
                    const res = await fetch(`${API_BASE}/auth/login`, { method:'POST', credentials:'include', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ identifier, password }) });
                    if (!res.ok) throw new Error('login failed');
                    const me = await fetch(`${API_BASE}/me`, { credentials:'include' }).then(r=>r.ok?r.json():null);
                    if (me){ localStorage.setItem('isLoggedIn','true'); localStorage.setItem('user', JSON.stringify(me)); closeEmailPage(); showToast('ç™»å…¥æˆåŠŸ', 'success'); location.reload(); }
                }catch(e){ showToast('ç™»å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥å¸³å¯†æˆ–ç¨å¾Œå†è©¦', 'error'); }
            });

            // Email è¨»å†Šï¼šPOST /auth/signup
            btnEmailSignup?.addEventListener('click', async ()=>{
                const phone = (document.getElementById('signup-phone')?.value||'').trim();
                const email = (document.getElementById('signup-email')?.value||'').trim();
                const username = (document.getElementById('signup-username')?.value||'').trim();
                const password = (document.getElementById('signup-password')?.value||'').trim();
                if (!phone || !email || !username || !password){ showToast('è«‹å®Œæ•´å¡«å¯«é›»è©±/Email/å¸³è™Ÿ/å¯†ç¢¼', 'error'); return; }
                try{
                    const res = await fetch(`${API_BASE}/auth/signup`, { method:'POST', credentials:'include', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ phone, email, username, password }) });
                    if (!res.ok) throw new Error('signup failed');
                    showToast('å¸³è™Ÿå»ºç«‹æˆåŠŸï¼Œè«‹ä»¥å¸³å¯†ç™»å…¥', 'success');
                }catch(e){ showToast('å»ºç«‹å¸³è™Ÿå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error'); }
            });

            // Google ç™»å…¥/è¨»å†Šï¼ˆçš†å°å‘åŒä¸€ OAuth èµ·å§‹ç«¯é»ï¼Œå¾Œç«¯è™•ç†ä¸å­˜åœ¨å¸³è™Ÿæ™‚è‡ªå‹•å»ºå¸³ï¼‰
            async function startGoogle(nextUrl){
                // å…ˆæ¸…é™¤ç¾æœ‰ sessionï¼Œé¿å…å› ç‚ºå·²ç™»å…¥è€Œè¢«èª¤èªç‚ºæˆåŠŸ
                try{ await fetch(`${API_BASE}/logout`, {method:'POST', credentials:'include'}); }catch(_){ }
                const url = `${API_BASE}/auth/google/start?next=${encodeURIComponent(nextUrl||location.href)}`;
                const features = 'width=520,height=640,menubar=no,toolbar=no,location=no,status=no,resizable=yes,scrollbars=yes';
                const popup = window.open(url, 'google_auth', features);
                // è¼•é‡è¼ªè©¢ï¼šç­‰å¾…å¾Œç«¯è¨­å®šå¥½ session cookie å¾Œï¼Œè‡ªå‹•é—œé–‰è¦–çª—ä¸¦åˆ·æ–°çˆ¶é 
                const timer = setInterval(async ()=>{
                    try{
                        const me = await fetch(`${API_BASE}/me`, { credentials:'include' }).then(r=> r.ok ? r.json() : null);
                        if (me && me.id){
                            localStorage.setItem('isLoggedIn','true');
                            localStorage.setItem('user', JSON.stringify(me));
                            clearInterval(timer);
                            try{ popup && popup.close(); }catch(_){ }
                            location.reload();
                        }
                    }catch(_){ /* å¿½ç•¥æš«æ™‚éŒ¯èª¤ */ }
                }, 1000);
                showToast('è«‹åœ¨å½ˆçª—å®Œæˆ Google ç™»å…¥', 'info');
            }
            document.getElementById('btn-google-login')?.addEventListener('click', ()=> startGoogle(location.href));
            document.getElementById('btn-google-signup')?.addEventListener('click', ()=> startGoogle(location.href));

            // é¡¯ç¤º/éš±è—å¯†ç¢¼
            function bindToggle(btnId, inputId){
                const btn = document.getElementById(btnId);
                const inp = document.getElementById(inputId);
                if (!btn || !inp) return;
                btn.addEventListener('click', ()=>{
                    inp.type = (inp.type === 'password') ? 'text' : 'password';
                });
            }
            bindToggle('toggle-login-pw','login-password');
            bindToggle('toggle-signup-pw','signup-password');

            // ç™»å‡ºåŠŸèƒ½
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    localStorage.removeItem('user');
                    localStorage.setItem('isLoggedIn', 'false');
                    showToast('å·²ç™»å‡º', 'success');
                    refreshUserUI();
                    dropdown.classList.add('hidden');
                });
            }

            if (drawerLogout) {
                drawerLogout.addEventListener('click', () => {
                    localStorage.removeItem('user');
                    localStorage.setItem('isLoggedIn', 'false');
                    showToast('å·²ç™»å‡º', 'success');
                    refreshUserUI();
                    drawer.classList.add('translate-x-full');
                    overlay.classList.add('hidden');
                });
            }

            // é»æ“Šå¤–éƒ¨é—œé–‰ä¸‹æ‹‰é¸å–®
            document.addEventListener('click', (e) => {
                if (!loginBtn.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });

            // æŠ½å±œé—œé–‰æ§åˆ¶
            if (drawerClose) drawerClose.addEventListener('click', () => { drawer.classList.add('translate-x-full'); overlay.classList.add('hidden'); });
            if (overlay) overlay.addEventListener('click', () => { drawer.classList.add('translate-x-full'); overlay.classList.add('hidden'); });

            refreshUserUI();
        }

        // å¾å¾Œç«¯è®€å–ä½¿ç”¨è€…é»æ•¸èˆ‡æ–¹æ¡ˆ
        async function fetchAccountSummary(user){
            if (!user || !user.id) return;
            try {
                const res = await fetch(`${ACCOUNT_API}/account/summary?user_id=${encodeURIComponent(user.id)}`, { credentials: 'include' });
                const data = await res.json();
                if (!data || data.error) return;
                const credits = typeof data.credits === 'number' ? data.credits : (data.credits?.balance ?? undefined);
                const plan = data.plan || data.subscription || 'å…è²»';
                if (credits !== undefined) {
                    const navC = document.getElementById('nav-credits');
                    if (navC) navC.textContent = credits;
                    const accC = document.getElementById('acc-credits');
                    if (accC) accC.textContent = credits;
                    // ä¹ŸåŒæ­¥åˆ° localStorage æ–¹ä¾¿æ¨¡æ“¬æ‰£é»
                    const userRaw = localStorage.getItem('user');
                    if (userRaw) {
                        const u = JSON.parse(userRaw); u.credits = credits; localStorage.setItem('user', JSON.stringify(u));
                    }
                }
                const accPlan = document.getElementById('acc-plan');
                if (accPlan) accPlan.textContent = plan;
                
                // æ›´æ–°ä½¿ç”¨çµ±è¨ˆ
                updateUsageStats(data.usage_stats || {});
            } catch(e) { /* å¿½ç•¥éŒ¯èª¤ï¼Œä¿æŒåŸæ¨£ */ }
        }
        
        // æ›´æ–°ä½¿ç”¨çµ±è¨ˆé¡¯ç¤º
        function updateUsageStats(stats) {
            const positioningCount = document.getElementById('acc-positioning-count');
            const topicsCount = document.getElementById('acc-topics-count');
            const scriptCount = document.getElementById('acc-script-count');
            
            if (positioningCount) positioningCount.textContent = `${stats.positioning || 0} æ¬¡`;
            if (topicsCount) topicsCount.textContent = `${stats.topics || 0} æ¬¡`;
            if (scriptCount) scriptCount.textContent = `${stats.script || 0} æ¬¡`;
        }

        // æ‰£é»ï¼ˆå‰ç«¯æ¨¡æ“¬ï¼‰
        function tryConsumeCredits(agent){
            const userRaw = localStorage.getItem('user');
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            if (!isLoggedIn || !userRaw) return true; // æœªç™»å…¥å°±ä¸æ‰£ï¼Œç›´æ¥é€šé
            const u = JSON.parse(userRaw);
            const cost = CREDIT_COSTS[agent] || 0;
            if ((u.credits ?? 0) < cost) {
                showToast(`é»æ•¸ä¸è¶³ï¼Œç„¡æ³•åŸ·è¡Œï¼ˆéœ€è¦ ${cost} é»ï¼‰`, 'error');
                return false;
            }
            u.credits = (u.credits ?? 0) - cost;
            localStorage.setItem('user', JSON.stringify(u));
            const navC = document.getElementById('nav-credits'); if (navC) navC.textContent = u.credits;
            const accC = document.getElementById('acc-credits'); if (accC) accC.textContent = u.credits;
            showToast(`å·²æ‰£é» ${cost}ï¼Œå‰©é¤˜ ${u.credits}`, 'success');
            return true;
        }

        // æ¸¬è©¦è¼”åŠ©ï¼šåœ¨ç€è¦½å™¨ Console å¯å‘¼å«ä¸‹åˆ—æ–¹æ³•æ¨¡æ“¬
        window.setCredits = function(n){
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const userRaw = localStorage.getItem('user');
            if (!isLoggedIn || !userRaw) { showToast('è«‹å…ˆç™»å…¥å†è¨­å®šé»æ•¸', 'error'); return; }
            const u = JSON.parse(userRaw); u.credits = Number(n)||0; localStorage.setItem('user', JSON.stringify(u));
            const navC = document.getElementById('nav-credits'); if (navC) navC.textContent = u.credits;
            const accC = document.getElementById('acc-credits'); if (accC) accC.textContent = u.credits;
            showToast(`å·²è¨­å®šé»æ•¸ç‚º ${u.credits}`, 'success');
        };
        window.getCredits = function(){
            const userRaw = localStorage.getItem('user');
            const u = userRaw ? JSON.parse(userRaw) : null;
            return u?.credits ?? null;
        };
        window.mockConsume = function(agent){
            if (!tryConsumeCredits(agent||'topics')) return false; return window.getCredits();
        };

        // å…±ç”¨èŠå¤©é‚è¼¯ï¼ˆå‰ç«¯æ¨¡æ“¬ï¼‰
        function initChats() {
            async function callBackend(agent, content) {
                try {
                    const user = JSON.parse(localStorage.getItem('user') || '{}');
                    const userId = user.id || 'web';
                    const res = await fetch(`${API_BASE}/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            user_id: userId,
                            agent_type: agent,
                            messages: [{ role: 'user', content }]
                        })
                    });
                    const data = await res.json();
                    const msg = data.assistant_message || 'ï¼ˆå¾Œç«¯å·²å›è¦†ï¼Œä½†ç„¡å…§å®¹ï¼‰';
                    // å°‡ AI å›è¦†åŒæ­¥åˆ°å°æ‡‰çµæœå€å¡Šï¼ˆæ®µè½åˆ†æ˜ï¼‰
                    try {
                        if (agent === 'script') {
                            const preview = document.getElementById('script-preview');
                            if (preview) {
                                document.getElementById('script-empty').classList.add('hidden');
                                document.getElementById('script-result').classList.remove('hidden');
                                const ctn = document.getElementById('script-content');
                                if (ctn) ctn.textContent = msg; // whitespace-pre-line å·²åœ¨æ¨£å¼
                                preview.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            }
                        } else if (agent === 'positioning') {
                            const area = document.getElementById('positioning-result');
                            if (area) {
                                area.classList.remove('hidden');
                                // è§£æå›è¦†ä¸­çš„ä¸‰å€‹å€å¡Šï¼ˆå“ç‰Œå®šä½ / èªæ°£å®ˆå‰‡ / åŸ·è¡Œå»ºè­°ï¼‰
                                let summary = msg;
                                let toneTxt = '';
                                let execTxt = '';
                                const toneIdx = msg.indexOf('èªæ°£å®ˆå‰‡');
                                const execIdx = msg.indexOf('åŸ·è¡Œå»ºè­°');
                                if (toneIdx !== -1) {
                                    summary = msg.slice(0, toneIdx).trim();
                                    if (execIdx !== -1) {
                                        toneTxt = msg.slice(toneIdx).replace(/^èªæ°£å®ˆå‰‡\s*[:ï¼š]?\s*/,'');
                                        toneTxt = toneTxt.slice(0, Math.max(0, toneTxt.indexOf('åŸ·è¡Œå»ºè­°'))).trim();
                                    } else {
                                        toneTxt = msg.slice(toneIdx).replace(/^èªæ°£å®ˆå‰‡\s*[:ï¼š]?\s*/,'').trim();
                                    }
                                }
                                if (execIdx !== -1) {
                                    execTxt = msg.slice(execIdx).replace(/^åŸ·è¡Œå»ºè­°\s*[:ï¼š]?\s*/,'').trim();
                                }

                                // è‹¥ä»ç„¡åŸ·è¡Œå»ºè­°ï¼Œæä¾›å‰ç«¯ fallbackï¼ˆé¿å…ç©ºç™½ï¼‰
                                if (!execTxt) {
                                    const industry = (document.getElementById('industry')?.value || '').trim();
                                    const audience = (document.getElementById('audience')?.value || '').trim();
                                    const pains = (document.getElementById('pains')?.value || '').trim();
                                    const lines = [
                                        `å…§å®¹ç¯€å¥ï¼šæ¯é€± 3-4 æ”¯çŸ­ç‰‡ï¼›é–‹é ­ 2~3 ç§’ç ´é¡Œï¼Œçµå°¾åŠ  CTAã€‚`,
                                        `ä¸»é¡Œå®‰æ’ï¼šä»¥ã€Œ${pains || 'ç”¨æˆ¶ç—›é»'}ã€ç‚ºæ ¸å¿ƒï¼Œçµåˆ ${industry || 'ä½ çš„ç”¢æ¥­'} æ¡ˆä¾‹èˆ‡å¯¦ä½œç¤ºç¯„ã€‚`,
                                        `å¹³å°ç­–ç•¥ï¼šå„ªå…ˆç¶“ç‡Ÿ ${audience || 'ç›®æ¨™å—çœ¾'} å¸¸ç”¨çš„å¹³å°ï¼Œå›ºå®šæ¬„ä½ï¼ˆæ•™å­¸/æ¡ˆä¾‹/QAï¼‰è¼ªæ’­ã€‚`
                                    ];
                                    execTxt = lines.join('\n');
                                }

                                // å»é™¤é‡è¤‡è¡Œï¼ˆä¾‹å¦‚é‡è¤‡çš„ã€Œç™¼æ–‡é »ç‡ã€ï¼‰
                                const dedup = [];
                                const seen = new Set();
                                execTxt.split(/\r?\n/).forEach(l => {
                                    const t = l.trim();
                                    if (!t) return;
                                    const key = t.replace(/^[ğŸ“Œâ€¢\-\d\s]+/, '').replace(/ï¼š|:/, ':');
                                    if (!seen.has(key)) { seen.add(key); dedup.push(t); }
                                });
                                execTxt = dedup.join('\n');

                                const s = document.getElementById('positioning-summary');
                                if (s) s.textContent = summary || msg;
                                const t = document.getElementById('tone-guidelines');
                                if (t && toneTxt) t.textContent = toneTxt;
                                const e = document.getElementById('execution-suggestions');
                                if (e) e.textContent = execTxt;
                                document.getElementById('positioning-loading')?.classList.add('hidden');
                            }
                        } else if (agent === 'topics') {
                            const area = document.getElementById('ideation-result');
                            const cards = document.getElementById('ideation-cards');
                            if (area && cards) {
                                area.classList.remove('hidden');
                                const card = document.createElement('div');
                                card.className = 'bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-2';
                                card.innerHTML = `<div class="font-semibold text-gray-900 dark:text-white mb-1">AI ç”Ÿæˆå»ºè­°</div><div class="text-sm text-gray-600 dark:text-gray-400 whitespace-pre-line">${msg}</div>`;
                                cards.prepend(card);
                                area.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            }
                        }
                    } catch (_) {}
                    return msg;
                } catch (e) {
                    return 'ï¼ˆå¾Œç«¯ä¸å¯ç”¨ï¼Œé€™æ˜¯å‰ç«¯ç¤ºç¯„å›è¦†ï¼‰';
                }
            }

            function bindChat(sendId, inputId, boxId, agent) {
                const send = document.getElementById(sendId);
                const input = document.getElementById(inputId);
                const box = document.getElementById(boxId);
                if (!send || !input || !box) return;
                
                function formatAIResponse(text) {
                    // å°‡AIå›è¦†æ ¼å¼åŒ–ç‚ºæ®µè½åˆ†æ˜ï¼Œä½¿ç”¨emojiåšæ®µè½åˆ†é…
                    let formatted = text;
                    
                    // å¸¸è¦‹çš„æ®µè½åˆ†éš”ç¬¦è™Ÿ
                    const separators = [
                        { pattern: /\n\n/g, emoji: 'ğŸ“' },
                        { pattern: /\n/g, emoji: 'ğŸ’¡' },
                        { pattern: /ã€‚/g, emoji: 'âœ¨' },
                        { pattern: /ï¼/g, emoji: 'ğŸ¯' },
                        { pattern: /ï¼Ÿ/g, emoji: 'ğŸ¤”' }
                    ];
                    
                    // å…ˆè™•ç†é›™æ›è¡Œï¼ˆæ®µè½åˆ†éš”ï¼‰
                    formatted = formatted.replace(/\n\n+/g, '\n\nğŸ“ ');
                    
                    // è™•ç†å–®æ›è¡Œ
                    formatted = formatted.replace(/\n(?!\n)/g, '\nğŸ’¡ ');
                    
                    // è™•ç†å¥è™Ÿå¾Œçš„æ®µè½
                    formatted = formatted.replace(/ã€‚([^ã€‚ï¼ï¼Ÿ\n])/g, 'ã€‚\nâœ¨ $1');
                    
                    // è™•ç†é©šå˜†è™Ÿå¾Œçš„æ®µè½
                    formatted = formatted.replace(/ï¼([^ã€‚ï¼ï¼Ÿ\n])/g, 'ï¼\nğŸ¯ $1');
                    
                    // è™•ç†å•è™Ÿå¾Œçš„æ®µè½
                    formatted = formatted.replace(/ï¼Ÿ([^ã€‚ï¼ï¼Ÿ\n])/g, 'ï¼Ÿ\nğŸ¤” $1');
                    
                    // ç¢ºä¿æ¯å€‹æ®µè½éƒ½æœ‰é©ç•¶çš„é–“è·
                    formatted = formatted.replace(/([ğŸ“ğŸ’¡âœ¨ğŸ¯ğŸ¤”]) /g, '$1 ');
                    
                    return formatted;
                }
                
                function append(role, text) {
                    const item = document.createElement('div');
                    item.className = role === 'user' ? 'text-right mb-3' : 'text-left mb-3';
                    const bubble = document.createElement('div');
                    bubble.className = `inline-block px-4 py-3 rounded-lg max-w-[85%] ${role==='user'?'bg-blue-50 text-blue-900':'bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600'} shadow-sm`;
                    
                    if (role === 'ai') {
                        // AIå›è¦†ä½¿ç”¨æ ¼å¼åŒ–çš„å…§å®¹
                        const formattedText = formatAIResponse(text);
                        bubble.innerHTML = `<div class="whitespace-pre-line text-sm leading-relaxed">${formattedText}</div>`;
                    } else {
                        // ç”¨æˆ¶è¨Šæ¯ä¿æŒåŸæ¨£
                        bubble.textContent = text;
                    }
                    
                    item.appendChild(bubble);
                    box.appendChild(item);
                    box.scrollTop = box.scrollHeight;
                }
                
                function appendPending() {
                    const item = document.createElement('div');
                    item.className = 'text-left mb-3';
                    const bubble = document.createElement('div');
                    bubble.className = 'inline-block px-4 py-3 rounded-lg max-w-[85%] bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 shadow-sm flex items-center gap-2';
                    bubble.innerHTML = `<svg class="loading-spinner w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v2m0 12v2m8-8h-2M6 12H4m13.657 6.343l-1.414-1.414M7.757 7.757L6.343 6.343m12.728 0l-1.414 1.414M7.757 16.243l-1.414 1.414"></path></svg><span class="text-sm">AI å›è¦†ä¸­...</span>`;
                    item.appendChild(bubble);
                    box.appendChild(item);
                    box.scrollTop = box.scrollHeight;
                    return item;
                }
                
                send.addEventListener('click', () => {
                    const v = input.value.trim();
                    if (!v) return;
                    // æ‰£é»ï¼ˆè‹¥ä¸è¶³å‰‡é˜»æ“‹ï¼‰
                    if (!tryConsumeCredits(agent)) return;
                    append('user', v);
                    input.value = '';
                    const pending = appendPending();
                    callBackend(agent, v)
                        .then(msg => {
                            if (pending && pending.parentNode) pending.parentNode.removeChild(pending);
                            append('ai', msg);
                        })
                        .catch(() => {
                            if (pending && pending.parentNode) pending.parentNode.removeChild(pending);
                            append('ai', 'æŠ±æ­‰ï¼Œç›®å‰ç³»çµ±è¼ƒç¹å¿™ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
                        });
                });
                // Enter é€å‡ºï¼ˆShift+Enter ä¸é€å‡ºï¼‰
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        const v = input.value.trim();
                        if (v) {
                            send.click();
                        }
                    }
                });
            }
            bindChat('chat-send-positioning','chat-input-positioning','chat-positioning','positioning');
            bindChat('chat-send-ideation','chat-input-ideation','chat-ideation','topics');
            bindChat('chat-send-script','chat-input-script','chat-script','script');

            // æ¸…ç©ºå°è©±åŠŸèƒ½
            const clearBtns = [
                {btn: 'chat-clear-positioning', box: 'chat-positioning'},
                {btn: 'chat-clear-ideation', box: 'chat-ideation'},
                {btn: 'chat-clear-script', box: 'chat-script'}
            ];
            clearBtns.forEach(({btn, box}) => {
                const clearBtn = document.getElementById(btn);
                const chatBox = document.getElementById(box);
                if (clearBtn && chatBox) {
                    clearBtn.addEventListener('click', () => chatBox.innerHTML = '');
                }
            });

            // å¿«é€ŸæŒ‰éˆ•åŠŸèƒ½
            document.querySelectorAll('.chip-p').forEach(btn => {
                btn.addEventListener('click', () => {
                    const input = document.getElementById('chat-input-positioning');
                    const send = document.getElementById('chat-send-positioning');
                    const box = document.getElementById('chat-positioning');
                    if (input && send && box) {
                        // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œå…ˆé¡¯ç¤ºæ­¡è¿è¨Šæ¯
                        if (box.children.length === 0) {
                            const welcomeMsg = `ğŸ¯ æ­¡è¿ä½¿ç”¨AIçŸ­å½±éŸ³å®šä½é¡§å•ï¼

ğŸ“ æˆ‘æ˜¯æ‚¨çš„å°ˆæ¥­å®šä½é¡§å•ï¼Œå¯ä»¥å¹«åŠ©æ‚¨ï¼š
ğŸ’¡ åˆ†ææ¥­å‹™é¡å‹èˆ‡ç›®æ¨™å—çœ¾
âœ¨ å»ºç«‹å“ç‰Œå®šä½èˆ‡å…§å®¹ç­–ç•¥
ğŸ¯ è¦åŠƒå¹³å°ç¶“ç‡Ÿæ–¹å‘

ğŸ¤” è«‹å‘Šè¨´æˆ‘æ‚¨çš„æ¥­å‹™ã€ç”¢å“æˆ–æƒ³æ³•ï¼Œæˆ‘æœƒé€æ­¥å¼•å°æ‚¨å»ºç«‹å®Œæ•´çš„å®šä½æª”æ¡ˆï¼`;
                            
                            const item = document.createElement('div');
                            item.className = 'text-left mb-3';
                            const bubble = document.createElement('div');
                            bubble.className = 'inline-block px-4 py-3 rounded-lg max-w-[85%] bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 shadow-sm';
                            const safe = document.createElement('div');
                            safe.className = 'whitespace-pre-line text-sm leading-relaxed';
                            safe.textContent = welcomeMsg;
                            bubble.appendChild(safe);
                            item.appendChild(bubble);
                            box.appendChild(item);
                        }
                        
                        input.value = btn.textContent;
                        send.click();
                    }
                });
            });

            document.querySelectorAll('.chip-i').forEach(btn => {
                btn.addEventListener('click', () => {
                    const input = document.getElementById('chat-input-ideation');
                    const send = document.getElementById('chat-send-ideation');
                    const box = document.getElementById('chat-ideation');
                    if (input && send && box) {
                        // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œå…ˆé¡¯ç¤ºæ­¡è¿è¨Šæ¯
                        if (box.children.length === 0) {
                            const welcomeMsg = `ğŸ’¡ æ­¡è¿ä½¿ç”¨AIé¸é¡Œå°åŠ©æ‰‹ï¼

ğŸ“ æˆ‘å¯ä»¥ç‚ºæ‚¨æä¾›ï¼š
âœ¨ å€‹æ€§åŒ–é¸é¡Œå»ºè­°
ğŸ¯ ç†±é»çµåˆå‰µæ„
ğŸ’¡ å­£ç¯€æ€§å…§å®¹è¦åŠƒ
ğŸ¤” å¤šç¨®é¸é¡Œé¡å‹ç¯©é¸

ğŸ“ è«‹å‘Šè¨´æˆ‘æ‚¨æƒ³è¦ä»€éº¼é¡å‹çš„é¸é¡Œéˆæ„Ÿï¼Œæˆ‘æœƒç‚ºæ‚¨é‡èº«æ‰“é€ ï¼`;
                            
                            const item = document.createElement('div');
                            item.className = 'text-left mb-3';
                            const bubble = document.createElement('div');
                            bubble.className = 'inline-block px-4 py-3 rounded-lg max-w-[85%] bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 shadow-sm';
                            const safe2 = document.createElement('div');
                            safe2.className = 'whitespace-pre-line text-sm leading-relaxed';
                            safe2.textContent = welcomeMsg;
                            bubble.appendChild(safe2);
                            item.appendChild(bubble);
                            box.appendChild(item);
                        }
                        
                        input.value = btn.textContent;
                        send.click();
                    }
                });
            });

            document.querySelectorAll('.chip-s').forEach(btn => {
                btn.addEventListener('click', () => {
                    const input = document.getElementById('chat-input-script');
                    const send = document.getElementById('chat-send-script');
                    const box = document.getElementById('chat-script');
                    if (input && send && box) {
                        // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œå…ˆé¡¯ç¤ºæ­¡è¿è¨Šæ¯
                        if (box.children.length === 0) {
                            const welcomeMsg = `ğŸ“ æ­¡è¿ä½¿ç”¨AIè…³æœ¬ç”Ÿæˆå¤§å¸«ï¼

ğŸ¯ æˆ‘å¯ä»¥ç‚ºæ‚¨æä¾›ï¼š
âœ¨ ä¸€éµç”Ÿæˆå®Œæ•´è…³æœ¬
ğŸ’¡ å¼•å°æ¨¡å¼é€æ­¥å‰µä½œ
ğŸ“ è‡ªç”±æ¨¡å¼å‰µæ„è¨è«–
ğŸ¯ å¤šç¨®æ¨¡æ¿çµæ§‹é¸æ“‡
ğŸ¤” 30ç§’èˆ‡60ç§’æ™‚é•·æ”¯æ´

ğŸ“ è«‹å‘Šè¨´æˆ‘æ‚¨çš„ä¸»é¡Œã€ç›®æ¨™ã€å—çœ¾æˆ–å¹³å°ï¼Œæˆ‘æœƒç‚ºæ‚¨é‡èº«æ‰“é€ å°ˆæ¥­è…³æœ¬ï¼`;
                            
                            const item = document.createElement('div');
                            item.className = 'text-left mb-3';
                            const bubble = document.createElement('div');
                            bubble.className = 'inline-block px-4 py-3 rounded-lg max-w-[85%] bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 shadow-sm';
                            const safe3 = document.createElement('div');
                            safe3.className = 'whitespace-pre-line text-sm leading-relaxed';
                            safe3.textContent = welcomeMsg;
                            bubble.appendChild(safe3);
                            item.appendChild(bubble);
                            box.appendChild(item);
                        }
                        
                        input.value = btn.textContent;
                        send.click();
                    }
                });
            });
            // é€²å…¥é é¢æ™‚åœ¨å³å´èŠå¤©æ¡†çµ¦é–‹å ´ä»‹ç´¹ï¼ˆåªé¡¯ç¤ºä¸€æ¬¡ï¼‰
            const ibox = document.getElementById('chat-ideation');
            if (ibox && !ibox.dataset.intro){
                const intro = 'å—¨ï¼æˆ‘æ˜¯ AI é¸é¡Œå°åŠ©æ‰‹ã€‚\næˆ‘æœƒæ ¹æ“šä½ çš„å®šä½èˆ‡éœ€æ±‚ï¼Œæä¾›å¤šå…ƒçš„å…§å®¹è§’åº¦èˆ‡åˆ‡å…¥é»ã€‚\nè«‹åœ¨å·¦å´è¼¸å…¥ä¸»é¡Œå’Œæ¢æ•¸ï¼Œæˆ–ç›´æ¥åœ¨ä¸‹æ–¹è·Ÿæˆ‘èªªä½ æƒ³è¨è«–çš„æ–¹å‘ï¼ˆä¾‹å¦‚ç†±é–€è¶¨å‹¢ã€æ•™è‚²åˆ†äº«â€¦ï¼‰ï¼Œæˆ‘æœƒå³æ™‚å›è¦†å»ºè­°ã€‚';
                const wrap = document.createElement('div');
                wrap.className = 'text-left mb-3';
                wrap.innerHTML = `<div class=\"inline-block px-3 py-2 rounded-lg bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 shadow-sm whitespace-pre-line\">${intro}</div>`;
                ibox.appendChild(wrap); ibox.dataset.intro = '1';
            }
        }


        // Toast é€šçŸ¥ç³»çµ±
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-600';
            toast.className = `${bgColor} text-white px-6 py-3 rounded-lg shadow-2xl fade-in pointer-events-auto`;
            toast.textContent = message;
            toastContainer.appendChild(toast);
            setTimeout(() => { toast.remove(); }, 2200);
        }

        // å®šä½åŠ©æ‰‹åŠŸèƒ½
        function initPositioning() {
            const form = document.getElementById('positioning-form');
            const submitBtn = document.getElementById('positioning-submit');
            const submitText = submitBtn.querySelector('.submit-text');
            const loadingText = submitBtn.querySelector('.loading-text');

            // èªæ°£é¸é …é»æ“Šè™•ç†
            document.querySelectorAll('input[name="tone"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    updateToneSelection();
                });
            });

            // è¡¨å–®æäº¤
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // é©—è­‰å¿…å¡«æ¬„ä½ï¼ˆtone ä»¥ checked é©—è­‰ï¼‰
                const requiredFields = ['industry', 'audience', 'pains'];
                let isValid = true;
                
                requiredFields.forEach(field => {
                    const input = form.querySelector(`[name="${field}"]`);
                    if (!input || !input.value.trim()) {
                        isValid = false;
                        if (input) {
                        input.classList.add('border-red-500');
                        setTimeout(() => input.classList.remove('border-red-500'), 3000);
                        }
                    }
                });
                // toneï¼ˆradio groupï¼‰éœ€è‡³å°‘é¸å–ä¸€å€‹
                const toneChecked = form.querySelector('input[name="tone"]:checked');
                if (!toneChecked) {
                    isValid = false;
                    try {
                        document.querySelectorAll('.tone-option').forEach(opt => {
                            const wrap = opt.parentElement;
                            if (wrap) {
                                wrap.classList.add('border-red-500');
                                setTimeout(() => wrap.classList.remove('border-red-500'), 3000);
                            }
                        });
                    } catch(_) {}
                }

                if (!isValid) {
                    showToast('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½', 'error');
                    return;
                }

                // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                submitBtn.disabled = true;
                submitText.classList.add('hidden');
                loadingText.classList.remove('hidden');

                try {
                    document.getElementById('positioning-result').classList.remove('hidden');
                    document.getElementById('positioning-loading').classList.remove('hidden');
                    await generatePositioningResult();
                } catch (err) {
                    console.warn('å®šä½åˆ†æå¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°é è¨­ï¼š', err);
                    try { generatePositioningResultLocal(); } catch(_) {}
                } finally {
                    document.getElementById('positioning-loading').classList.add('hidden');
                    submitBtn.disabled = false;
                    submitText.classList.remove('hidden');
                    loadingText.classList.add('hidden');
                }
            });

            // å¿«é€Ÿç¤ºä¾‹æŒ‰éˆ•
            document.querySelectorAll('.quick-example-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const examples = {
                        'ç§‘æŠ€æ–°å‰µå…¬å¸': {
                            industry: 'ç§‘æŠ€æ–°å‰µ',
                            audience: '25-35æ­²ç§‘æŠ€å·¥ä½œè€…',
                            pains: 'å·¥ä½œå£“åŠ›å¤§ã€æ™‚é–“ç®¡ç†å›°é›£ã€ç¼ºä¹å·¥ä½œç”Ÿæ´»å¹³è¡¡',
                            tone: 'professional'
                        },
                        'ç·šä¸Šæ•™è‚²å¹³å°': {
                            industry: 'ç·šä¸Šæ•™è‚²',
                            audience: 'åœ¨è·é€²ä¿®è€…',
                            pains: 'å­¸ç¿’æ™‚é–“æœ‰é™ã€ç¼ºä¹ç³»çµ±æ€§å­¸ç¿’æ–¹æ³•ã€é›£ä»¥å …æŒ',
                            tone: 'friendly'
                        },
                        'å¥åº·é£Ÿå“å“ç‰Œ': {
                            industry: 'å¥åº·é£Ÿå“',
                            audience: 'æ³¨é‡å¥åº·çš„æ¶ˆè²»è€…',
                            pains: 'å¸‚é¢ç”¢å“è‰¯è ä¸é½Šã€ç¼ºä¹å°ˆæ¥­æŒ‡å°ã€æ•ˆæœä¸æ˜é¡¯',
                            tone: 'authoritative'
                        }
                    };
                    
                    const exampleText = this.textContent.replace('å¿«é€Ÿç¤ºä¾‹ï¼š', '').trim();
                    const data = examples[exampleText];
                    
                    if (data) {
                        document.getElementById('industry').value = data.industry;
                        document.getElementById('audience').value = data.audience;
                        document.getElementById('pains').value = data.pains;
                        document.querySelector(`input[name="tone"][value="${data.tone}"]`).checked = true;
                        updateToneSelection();
                        showToast('å·²å¡«å…¥å¿«é€Ÿç¤ºä¾‹è³‡æ–™', 'success');
                    }
                });
            });

            // é€²å…¥é é¢æ™‚åœ¨å³å´èŠå¤©æ¡†çµ¦é–‹å ´ä»‹ç´¹ï¼ˆåªé¡¯ç¤ºä¸€æ¬¡ï¼‰
            const box = document.getElementById('chat-positioning');
            if (box && !box.dataset.intro) {
                const intro = 'å—¨ï¼æˆ‘æ˜¯ä½ çš„ AI å½±éŸ³å®šä½é¡§å•ã€‚\næˆ‘æœƒæ ¹æ“šä½ åœ¨å·¦å´å¡«å¯«çš„è³‡è¨ŠçµåˆçŸ¥è­˜åº«ï¼Œå¹«ä½ æ•´ç†å“ç‰Œå®šä½ã€èªæ°£å®ˆå‰‡èˆ‡åŸ·è¡Œå»ºè­°ã€‚\nå¡«å®Œè¡¨å–®æŒ‰ã€Œç”Ÿæˆå®šä½æ‘˜è¦ã€ï¼Œæˆ–åœ¨ä¸‹æ–¹ç›´æ¥è·Ÿæˆ‘èŠå¤©æè¿°ä½ çš„æ¥­å‹™èˆ‡å—çœ¾ï¼Œæˆ‘ä¹Ÿèƒ½ä¸€æ­¥æ­¥å¼•å°ä½ å®Œæˆå®šä½ã€‚';
                const wrap = document.createElement('div');
                wrap.className = 'text-left mb-3';
                wrap.innerHTML = `<div class="inline-block px-3 py-2 rounded-lg bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 shadow-sm whitespace-pre-line">${intro}</div>`;
                box.appendChild(wrap); box.dataset.intro = '1';
            }

            const tabChat = document.getElementById('tab-positioning-chat');
            const tabOne = document.getElementById('tab-positioning-oneclick');
            const leftForm = document.getElementById('positioning-form');
            const onePanel = document.getElementById('positioning-oneclick-panel');
            const resultPanel = document.getElementById('positioning-result');
            const title = document.getElementById('positioning-title');
            const description = document.getElementById('positioning-description');
            if (tabChat && tabOne && leftForm && onePanel){
                tabChat.addEventListener('click', ()=>{
                    console.log('åˆ‡æ›åˆ° AI å°è©±æ¨¡å¼');
                    tabChat.classList.add('bg-primary','text-white');
                    tabOne.classList.remove('bg-primary','text-white');
                    tabOne.classList.add('border','border-gray-300','dark:border-gray-600');
                    tabChat.classList.remove('border');
                    // æ›´æ–°æ¨™é¡Œå’Œèªªæ˜é¡è‰²
                    if (title) title.className = 'text-2xl font-bold text-gray-900 dark:text-white';
                    if (description) description.textContent = 'ç›´æ¥èˆ‡AIå°è©±ï¼Œæè¿°ä½ çš„æ¥­å‹™èˆ‡å—çœ¾ï¼Œæˆ‘æœƒä¸€æ­¥æ­¥å¼•å°ä½ å®Œæˆå®šä½åˆ†æ';
                    // éš±è—å·¦å´ä¸€éµç”Ÿæˆè¨­å®šæ¨¡æ¿ï¼ˆåªéš±è—è¡¨å–®ï¼Œä¿ç•™æ¨™ç±¤ï¼‰
                    leftForm.classList.add('hidden');
                    onePanel.classList.add('hidden');
                    // é¡¯ç¤ºèŠå¤©å°è©±æ¡†
                    const chatCard = document.getElementById('positioning-chat-card');
                    if (chatCard) chatCard.classList.remove('hidden');
                    if (resultPanel) resultPanel.classList.add('hidden');
                    // èª¿æ•´èŠå¤©å°è©±æ¡†é«˜åº¦
                    setTimeout(adjustPositioningHeights, 100);
                });
                tabOne.addEventListener('click', ()=>{
                    console.log('åˆ‡æ›åˆ°ä¸€éµç”Ÿæˆæ¨¡å¼');
                    tabOne.classList.add('bg-primary','text-white');
                    tabChat.classList.remove('bg-primary','text-white');
                    tabChat.classList.add('border','border-gray-300','dark:border-gray-600');
                    tabOne.classList.remove('border');
                    // æ›´æ–°æ¨™é¡Œå’Œèªªæ˜é¡è‰²
                    if (title) title.className = 'text-2xl font-bold text-gray-900 dark:text-white';
                    if (description) description.textContent = 'å¡«å¯«å¿…è¦è³‡è¨Šå¾Œï¼Œç›´æ¥é€å‡ºå³å¯å¿«é€Ÿç”¢ç”Ÿå®šä½æ‘˜è¦';
                    // é¡¯ç¤ºå·¦å´ä¸€éµç”Ÿæˆè¨­å®šæ¨¡æ¿
                    leftForm.classList.remove('hidden');
                    onePanel.classList.remove('hidden');
                    // éš±è—èŠå¤©å°è©±æ¡†
                    const chatCard = document.getElementById('positioning-chat-card');
                    if (chatCard) chatCard.classList.add('hidden');
                    // é¡¯ç¤ºçµæœé¢æ¿ï¼ˆä¸€éµç”Ÿæˆæ¨¡å¼ä¸‹é¡¯ç¤ºçµæœï¼‰
                    if (resultPanel) resultPanel.classList.remove('hidden');
                    // èª¿æ•´èŠå¤©å°è©±æ¡†é«˜åº¦
                    setTimeout(adjustPositioningHeights, 100);
                });
                // é è¨­ï¼šAI å°è©± â†’ éš±è—å·¦å´æ¨¡æ¿
                console.log('åˆå§‹åŒ–ï¼šè¨­å®šç‚º AI å°è©±æ¨¡å¼');
                leftForm.classList.add('hidden');
                onePanel.classList.add('hidden');
                if (resultPanel) resultPanel.classList.add('hidden');
            } else {
                console.log('å®šä½é é¢å…ƒç´ æœªæ‰¾åˆ°:', {tabChat, tabOne, leftForm, onePanel});
            }
        }

        // è®“å³å´èŠå¤©å°è©±æ¡†é«˜åº¦èˆ‡å·¦å´è¡¨å–®åŒé«˜ï¼ˆæ¡Œé¢ç«¯ï¼‰
        function adjustPositioningHeights() {
            try {
                const left = document.getElementById('positioning-left');
                const chatCard = document.getElementById('positioning-chat-card');
                if (!left || !chatCard) return;
                if (window.innerWidth >= 1024) { // lg æ–·é»
                    // å¦‚æœå·¦å´è¡¨å–®è¢«éš±è—ï¼Œä½¿ç”¨é è¨­æœ€å°é«˜åº¦
                    if (left.classList.contains('hidden')) {
                        chatCard.style.height = '600px';
                        chatCard.style.minHeight = '600px';
                    } else {
                    // ä¿ç•™æœ€å°é«˜åº¦ï¼Œé¿å…é«˜åº¦è¢«å£“åˆ° 0 å°è‡´æ•´å¼µå¡ç‰‡æ¶ˆå¤±
                    const target = Math.max(left.offsetHeight, 600);
                    chatCard.style.height = target + 'px';
                        chatCard.style.minHeight = '600px';
                    }
                } else {
                    chatCard.style.height = '';
                    chatCard.style.minHeight = '500px';
                }
            } catch (e) {
                // å¿½ç•¥
            }
        }

        function updateToneSelection() {
            document.querySelectorAll('.tone-option').forEach(option => {
                const radio = option.parentElement.querySelector('input[type="radio"]');
                if (radio.checked) {
                    option.parentElement.classList.add('border-primary', 'bg-primary', 'text-white');
                    option.parentElement.classList.remove('border-gray-300', 'dark:border-gray-600');
                } else {
                    option.parentElement.classList.remove('border-primary', 'bg-primary', 'text-white');
                    option.parentElement.classList.add('border-gray-300', 'dark:border-gray-600');
                }
            });
        }

        async function generatePositioningResult() {
            const form = document.getElementById('positioning-form');
            const formData = new FormData(form);
            
            const industry = formData.get('industry');
            const audience = formData.get('audience');
            const pains = formData.get('pains');
            const tone = formData.get('tone');
            const competitors = formData.get('competitors');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const userId = user.id || 'web';

            // å¾Œç«¯ï¼šçŸ¥è­˜åº« + AI
            try {
                const res = await fetch(`${API_BASE}/agent/positioning/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: userId,
                        user_input: `ç”¢æ¥­ï¼š${industry}\nç›®æ¨™å—çœ¾ï¼š${audience}\nç—›é»ï¼š${pains}\nèªæ°£ï¼š${tone}\nç«¶å“ï¼š${competitors || ''}`
                    })
                });
                const data = await res.json();
                if (data && !data.error) {
                    const ps = data.positioning_summary || data.summary || '';
                    const tg = data.tone_guidelines || data.tone || '';
                    let es = data.execution_suggestions || data.action_plan || data.recommendations || data.next_steps || '';
                    // å¾Œå‚™ï¼šå˜—è©¦å¾ç´”æ–‡å­—å›è¦†ä¸­æ“·å–ã€ŒåŸ·è¡Œå»ºè­°ã€æ®µè½
                    if (!es && typeof data.assistant_message === 'string') {
                        const m = data.assistant_message.match(/åŸ·è¡Œå»ºè­°[\s\S]*?$/);
                        es = m ? m[0].replace(/^åŸ·è¡Œå»ºè­°\s*[:ï¼š]?\s*/,'') : '';
                    }
                    // å†å¾Œå‚™ï¼šçµ¦å‡ºåŸºæœ¬å»ºè­°æ¨¡æ¿
                    if (!es) {
                        es = [
                            `å…§å®¹ç¯€å¥ï¼šæ¯é€± 3-4 æ”¯çŸ­ç‰‡ï¼›é–‹é ­ 2~3 ç§’ç ´é¡Œï¼Œçµå°¾åŠ  CTAã€‚`,
                            `ä¸»é¡Œå®‰æ’ï¼šä»¥ã€Œ${pains}ã€ç‚ºæ ¸å¿ƒç—›é»ï¼Œçµåˆ ${industry} æ¡ˆä¾‹èˆ‡å¯¦ä½œç¤ºç¯„ã€‚`,
                            `å¹³å°ç­–ç•¥ï¼š${audience} æ´»èºçš„å¹³å°å„ªå…ˆï¼›å›ºå®šæ¬„ä½ï¼ˆæ•™å­¸/æ¡ˆä¾‹/QAï¼‰è¼ªæ’­ã€‚`
                        ].join('\n');
                    }
                    // å‰µå»ºçµæœå¡ç‰‡
                    const cards = document.getElementById('positioning-cards');
                    if (cards) {
                        cards.innerHTML = `
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-2">
                                <div class="font-semibold text-gray-900 dark:text-white mb-1">å“ç‰Œå®šä½</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400 whitespace-pre-line">${ps}</div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-2">
                                <div class="font-semibold text-gray-900 dark:text-white mb-1">èªæ°£å®ˆå‰‡</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400 whitespace-pre-line">${tg}</div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-2">
                                <div class="font-semibold text-gray-900 dark:text-white mb-1">åŸ·è¡Œå»ºè­°</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400 whitespace-pre-line">${es}</div>
                            </div>
                        `;
                    }
                    document.getElementById('positioning-result').classList.remove('hidden');
                    showToast('å®šä½åˆ†æå®Œæˆï¼è«‹æŸ¥çœ‹å³å´çµæœ', 'success');
                    setTimeout(() => {
                        document.getElementById('positioning-result').scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 300);
                    return; // æˆåŠŸ
                }
                throw new Error('API å›å‚³éŒ¯èª¤');
            } catch (e) {
                throw e; // è®“å¤–å±¤ fallback
            }
        }

        // æœ¬åœ°é è¨­ï¼ˆé›¢ç·š fallbackï¼‰
        function generatePositioningResultLocal() {
            const form = document.getElementById('positioning-form');
            const formData = new FormData(form);
            const industry = formData.get('industry');
            const audience = formData.get('audience');
            const pains = formData.get('pains');
            const tone = formData.get('tone');
            
            // ç”Ÿæˆå‡è³‡æ–™çµæœï¼ˆèˆŠç‰ˆï¼‰
            const positioningSummary = `åŸºæ–¼æ‚¨çš„ç”¢æ¥­ã€Œ${industry}ã€å’Œç›®æ¨™å—çœ¾ã€Œ${audience}ã€ï¼Œå»ºè­°å®šä½ç‚ºå°ˆæ¥­çš„è§£æ±ºæ–¹æ¡ˆæä¾›è€…ã€‚é‡å°å—çœ¾é¢è‡¨çš„ã€Œ${pains}ã€å•é¡Œï¼Œæä¾›å…·æœ‰å·®ç•°åŒ–çš„åƒ¹å€¼ä¸»å¼µã€‚`;
            
            const toneGuidelines = {
                professional: 'ä½¿ç”¨å°ˆæ¥­è¡“èªï¼Œä¿æŒå®¢è§€ç†æ€§ï¼Œå¼·èª¿æ•¸æ“šå’Œäº‹å¯¦ï¼Œé¿å…éæ–¼æƒ…ç·’åŒ–çš„è¡¨é”ã€‚',
                friendly: 'æ¡ç”¨è¦ªåˆ‡å‹å–„çš„èªèª¿ï¼Œä½¿ç”¨ã€Œæˆ‘å€‘ã€ã€ã€Œæ‚¨ã€ç­‰è¦ªè¿‘ç”¨è©ï¼Œé©ç•¶ä½¿ç”¨å•å€™èªå’Œé¼“å‹µæ€§èªè¨€ã€‚',
                humorous: 'é©åº¦ä½¿ç”¨å¹½é»˜å…ƒç´ ï¼Œä½†ä¿æŒå°ˆæ¥­æ€§ï¼Œé¿å…éåº¦ç©ç¬‘ï¼Œç¢ºä¿å…§å®¹æœ‰åƒ¹å€¼ä¸”æ˜“æ–¼ç†è§£ã€‚',
                authoritative: 'å±•ç¾å°ˆæ¥­æ¬Šå¨ï¼Œä½¿ç”¨ç¢ºå®šçš„èªæ°£ï¼Œå¼•ç”¨å°ˆæ¥­æ•¸æ“šå’Œæ¡ˆä¾‹ï¼Œå»ºç«‹å¯ä¿¡åº¦å’Œå½±éŸ¿åŠ›ã€‚'
            };

            const executionSuggestions = `å»ºè­°æ¡ç”¨æµé‡å‹èˆ‡è½‰æ›å‹å…§å®¹ 7:3 é…æ¯”ï¼Œæ¯é€±ç™¼å¸ƒ 3-5 æ¬¡ï¼Œå°ˆæ³¨æ–¼ Instagram Reels å¹³å°ã€‚é–‹å ´ä½¿ç”¨å•å¥å¼é‰¤å­ï¼Œ2-3ç§’æ›ç•«é¢ï¼Œä¿æŒç¯€å¥ç·Šæ¹Šã€‚`;

            // é¡¯ç¤ºçµæœ
            const cards = document.getElementById('positioning-cards');
            if (cards) {
                cards.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-2">
                        <div class="font-semibold text-gray-900 dark:text-white mb-1">å“ç‰Œå®šä½</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400 whitespace-pre-line">${positioningSummary}</div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-2">
                        <div class="font-semibold text-gray-900 dark:text-white mb-1">èªæ°£å®ˆå‰‡</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400 whitespace-pre-line">${toneGuidelines[tone]}</div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-2">
                        <div class="font-semibold text-gray-900 dark:text-white mb-1">åŸ·è¡Œå»ºè­°</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400 whitespace-pre-line">${executionSuggestions}</div>
                    </div>
                `;
            }
            
            document.getElementById('positioning-result').classList.remove('hidden');
            window.dispatchEvent(new CustomEvent('analyzePositioning', { detail: { industry, audience, pains, tone } }));
            showToast('å®šä½åˆ†æå®Œæˆï¼ï¼ˆé›¢ç·šé è¨­ï¼‰', 'success');
            setTimeout(() => {
                document.getElementById('positioning-result').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 300);
        }

        // é¸é¡ŒåŠ©æ‰‹åŠŸèƒ½
        function initIdeation() {
            const form = document.getElementById('ideation-form');
            const submitBtn = document.getElementById('ideation-submit');
            const submitText = submitBtn.querySelector('.submit-text');
            const loadingText = submitBtn.querySelector('.loading-text');

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const topic = form.querySelector('[name="topic"]').value.trim();
                const count = parseInt(form.querySelector('[name="count"]').value);
                const dedupe = form.querySelector('[name="dedupe"]').checked;

                if (!topic || !count) {
                    showToast('è«‹å¡«å¯«ä¸»é¡Œå’Œé¸æ“‡ç”¢å‡ºæ¢æ•¸', 'error');
                    return;
                }

                // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                submitBtn.disabled = true;
                submitText.classList.add('hidden');
                loadingText.classList.remove('hidden');
                try{
                    document.getElementById('ideation-result').classList.remove('hidden');
                    document.getElementById('ideation-loading').classList.remove('hidden');
                    await generateIdeasFromAI(topic, count, dedupe);
                }catch(err){
                    console.warn('é¸é¡Œç”Ÿæˆå¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°ç¤ºä¾‹ï¼š', err);
                    generateIdeas(topic, count, dedupe);
                }finally{
                    document.getElementById('ideation-loading').classList.add('hidden');
                    submitBtn.disabled = false;
                    submitText.classList.remove('hidden');
                    loadingText.classList.add('hidden');
                }
            });

            // å¿«é€Ÿç¤ºä¾‹æŒ‰éˆ•
            document.querySelectorAll('#ideation-empty .quick-example-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const examples = {
                        'æ¸›è‚¥æ–¹æ³•': 'æ¸›è‚¥æ–¹æ³•',
                        'æŠ•è³‡ç†è²¡': 'æŠ•è³‡ç†è²¡',
                        'è·å ´æŠ€èƒ½': 'è·å ´æŠ€èƒ½'
                    };
                    
                    const exampleText = this.textContent.replace('å¿«é€Ÿç¤ºä¾‹ï¼š', '').trim();
                    const topic = examples[exampleText];
                    
                    if (topic) {
                        document.getElementById('topic').value = topic;
                        document.getElementById('count').value = '5';
                        showToast('å·²å¡«å…¥å¿«é€Ÿç¤ºä¾‹è³‡æ–™', 'success');
                    }
                });
            });

            // è…³æœ¬ç”Ÿæˆå¤§å¸«å¿«é€Ÿç¤ºä¾‹æŒ‰éˆ•ï¼ˆå·²ç§»é™¤ï¼Œå› ç‚ºç¾åœ¨æœ‰å°ˆé–€çš„ä¸»é¡Œè¼¸å…¥æ¡†ï¼‰
            // è®“å³å´é«˜åº¦èˆ‡å·¦å´ç­‰é«˜ï¼ˆæ¡Œé¢ç«¯ï¼‰
            function adjustIdeationHeights(){
                try{
                    const left = document.getElementById('ideation-left');
                    const chat = document.getElementById('ideation-chat-card');
                    if(!left||!chat) return;
                    if (window.innerWidth >= 1024){
                        // å¦‚æœå·¦å´è¡¨å–®è¢«éš±è—ï¼Œä½¿ç”¨é è¨­é«˜åº¦
                        if (left.classList.contains('hidden')) {
                            chat.style.height = '600px';
                        } else {
                        chat.style.height = Math.max(left.offsetHeight, 500) + 'px';
                        }
                    } else {
                        chat.style.height = '';
                    }
                }catch(e){}
            }
            adjustIdeationHeights();
            window.addEventListener('resize', adjustIdeationHeights);

            const tabChat = document.getElementById('tab-ideation-chat');
            const tabOne = document.getElementById('tab-ideation-oneclick');
            const leftForm = document.getElementById('ideation-form');
            const resultPanel = document.getElementById('ideation-result');
            const emptyPanel = document.getElementById('ideation-empty');
            const title = document.getElementById('ideation-title');
            const description = document.getElementById('ideation-description');
            if (tabChat && tabOne && leftForm && emptyPanel){
                tabChat.addEventListener('click', ()=>{
                    console.log('åˆ‡æ›åˆ° AI å°è©±æ¨¡å¼ï¼ˆé¸é¡Œï¼‰');
                    tabChat.classList.add('bg-primary','text-white');
                    tabOne.classList.remove('bg-primary','text-white');
                    tabOne.classList.add('border','border-gray-300','dark:border-gray-600');
                    tabChat.classList.remove('border');
                    // æ›´æ–°æ¨™é¡Œå’Œèªªæ˜é¡è‰²
                    if (title) title.className = 'text-2xl font-bold text-gray-900 dark:text-white';
                    if (description) description.textContent = 'ç›´æ¥èˆ‡AIå°è©±ï¼Œæè¿°ä½ çš„ä¸»é¡Œèˆ‡éœ€æ±‚ï¼Œæˆ‘æœƒä¸€æ­¥æ­¥å¼•å°ä½ å®Œæˆé¸é¡Œåˆ†æ';
                    // éš±è—å·¦å´ä¸€éµç”Ÿæˆè¨­å®šæ¨¡æ¿ï¼ˆåªéš±è—è¡¨å–®ï¼Œä¿ç•™æ¨™ç±¤ï¼‰
                    leftForm.classList.add('hidden');
                    emptyPanel.classList.add('hidden');
                    // é¡¯ç¤ºèŠå¤©å°è©±æ¡†
                    const chatCard = document.getElementById('ideation-chat-card');
                    if (chatCard) chatCard.classList.remove('hidden');
                    if (resultPanel) resultPanel.classList.add('hidden');
                    if (emptyPanel) emptyPanel.classList.add('hidden');
                    // èª¿æ•´èŠå¤©å°è©±æ¡†é«˜åº¦
                    setTimeout(adjustIdeationHeights, 100);
                });
                tabOne.addEventListener('click', ()=>{
                    console.log('åˆ‡æ›åˆ°ä¸€éµç”Ÿæˆæ¨¡å¼ï¼ˆé¸é¡Œï¼‰');
                    tabOne.classList.add('bg-primary','text-white');
                    tabChat.classList.remove('bg-primary','text-white');
                    tabChat.classList.add('border','border-gray-300','dark:border-gray-600');
                    tabOne.classList.remove('border');
                    // æ›´æ–°æ¨™é¡Œå’Œèªªæ˜é¡è‰²
                    if (title) title.className = 'text-2xl font-bold text-gray-900 dark:text-white';
                    if (description) description.textContent = 'å¡«å¯«å¿…è¦è³‡è¨Šå¾Œï¼Œç›´æ¥é€å‡ºå³å¯å¿«é€Ÿç”¢ç”Ÿé¸é¡Œå»ºè­°';
                    // é¡¯ç¤ºå·¦å´ä¸€éµç”Ÿæˆè¨­å®šæ¨¡æ¿
                    leftForm.classList.remove('hidden');
                    emptyPanel.classList.remove('hidden');
                    // éš±è—èŠå¤©å°è©±æ¡†
                    const chatCard = document.getElementById('ideation-chat-card');
                    if (chatCard) chatCard.classList.add('hidden');
                    // é¡¯ç¤ºçµæœé¢æ¿ï¼ˆä¸€éµç”Ÿæˆæ¨¡å¼ä¸‹é¡¯ç¤ºçµæœï¼‰
                    if (resultPanel) resultPanel.classList.remove('hidden');
                    if (emptyPanel) emptyPanel.classList.remove('hidden');
                    // èª¿æ•´èŠå¤©å°è©±æ¡†é«˜åº¦
                    setTimeout(adjustIdeationHeights, 100);
                });
                // é è¨­ï¼šAI å°è©± â†’ éš±è—å·¦å´æ¨¡æ¿
                console.log('åˆå§‹åŒ–ï¼šè¨­å®šç‚º AI å°è©±æ¨¡å¼ï¼ˆé¸é¡Œï¼‰');
                leftForm.classList.add('hidden');
                emptyPanel.classList.add('hidden');
                if (resultPanel) resultPanel.classList.add('hidden');
                if (emptyPanel) emptyPanel.classList.add('hidden');
            }
        }

        // å¾Œç«¯ï¼šçŸ¥è­˜åº« + AI ç”¢ç”Ÿé¸é¡Œ
        async function generateIdeasFromAI(topic, count, dedupe){
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const userId = user.id || 'web';
            const res = await fetch(`${API_BASE}/agent/topics/suggest`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: userId, target_date: null })
            });
            const data = await res.json();
            if (!data || data.error){ throw new Error('topics api error'); }
            const ideasText = data.suggestions || data.reasoning || '';
            const cardsContainer = document.getElementById('ideation-cards');
            cardsContainer.innerHTML = '';
            const card = document.createElement('div');
            card.className = 'bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-2';
            card.innerHTML = `<div class="font-semibold text-gray-900 dark:text-white mb-1">AI ç”Ÿæˆå»ºè­°</div><div class="text-sm text-gray-600 dark:text-gray-400 whitespace-pre-line">${ideasText}</div>`;
            cardsContainer.appendChild(card);
            document.getElementById('ideation-result').classList.remove('hidden');
            showToast('å·²ç”¢ç”Ÿ AI é¸é¡Œå»ºè­°ï¼', 'success');
            setTimeout(()=>{ document.getElementById('ideation-result').scrollIntoView({behavior:'smooth', block:'start'}); }, 300);
        }

        function generateIdeas(topic, count, dedupe) {
            const ideas = [
                { hook: 'ä½ çŸ¥é“å—ï¼Ÿ', angle: 'æ•¸æ“šçµ±è¨ˆ', keyword: 'é©šäººäº‹å¯¦', why: 'æ•¸æ“šå…·æœ‰èªªæœåŠ›ï¼Œå®¹æ˜“å¼•èµ·å…±é³´' },
                { hook: 'ç‚ºä»€éº¼æœƒé€™æ¨£ï¼Ÿ', angle: 'åŸå› åˆ†æ', keyword: 'æ·±åº¦è§£æ', why: 'æ»¿è¶³å¥½å¥‡å¿ƒï¼Œæä¾›æ·±åº¦å…§å®¹' },
                { hook: 'é€™æ¨£åšå°±å°äº†ï¼', angle: 'å¯¦ç”¨æŠ€å·§', keyword: 'æ“ä½œæŒ‡å—', why: 'ç›´æ¥è§£æ±ºå•é¡Œï¼Œå¯¦ç”¨æ€§å¼·' },
                { hook: 'åˆ¥å†çŠ¯é€™å€‹éŒ¯èª¤', angle: 'å¸¸è¦‹èª¤å€', keyword: 'é¿å‘æŒ‡å—', why: 'è­¦ç¤ºæ€§å¼·ï¼Œå®¹æ˜“å¼•èµ·æ³¨æ„' },
                { hook: 'æˆåŠŸæ¡ˆä¾‹åˆ†äº«', angle: 'çœŸå¯¦æ•…äº‹', keyword: 'ç¶“é©—åˆ†äº«', why: 'çœŸå¯¦æ€§é«˜ï¼Œå®¹æ˜“ç”¢ç”Ÿä¿¡ä»»' },
                { hook: 'å°ˆå®¶éƒ½é€™æ¨£èªª', angle: 'æ¬Šå¨è§€é»', keyword: 'å°ˆæ¥­å»ºè­°', why: 'æ¬Šå¨æ€§å¼·ï¼Œå¢åŠ å¯ä¿¡åº¦' },
                { hook: 'æœ€æ–°è¶¨å‹¢ä¾†äº†', angle: 'è¶¨å‹¢åˆ†æ', keyword: 'ç†±é»è©±é¡Œ', why: 'æ™‚æ•ˆæ€§å¼·ï¼Œå®¹æ˜“å¼•èµ·é—œæ³¨' },
                { hook: 'å°æ¯”ä¸€ä¸‹å°±çŸ¥é“', angle: 'å°æ¯”åˆ†æ', keyword: 'å„ªåŠ£æ¯”è¼ƒ', why: 'ç›´è§€æ˜“æ‡‚ï¼Œå¹«åŠ©æ±ºç­–' },
                { hook: 'å°æŠ€å·§å¤§æ•ˆæœ', angle: 'å¯¦ç”¨æŠ€å·§', keyword: 'ç°¡å–®æ–¹æ³•', why: 'æ“ä½œç°¡å–®ï¼Œæ•ˆæœæ˜é¡¯' },
                { hook: 'èƒŒå¾Œçš„ç§˜å¯†', angle: 'æ·±åº¦æŒ–æ˜', keyword: 'å…§å¹•æ­ç§˜', why: 'ç¥ç§˜æ„Ÿå¼·ï¼Œæ»¿è¶³å¥½å¥‡å¿ƒ' }
            ];

            let selectedIdeas = ideas.slice(0, count);
            if (dedupe) {
                selectedIdeas = selectedIdeas.filter((idea, index, self) => 
                    index === self.findIndex(i => i.angle !== idea.angle)
                );
            }

            const cardsContainer = document.getElementById('ideation-cards');
            cardsContainer.innerHTML = '';

            selectedIdeas.forEach((idea, index) => {
                const card = document.createElement('div');
                card.className = 'bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-2';
                card.innerHTML = `
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-500 dark:text-gray-400">#${index + 1}</span>
                        <span class="text-xs bg-primary text-white px-2 py-1 rounded">${idea.keyword}</span>
                    </div>
                    <div class="font-semibold text-gray-900 dark:text-white">${idea.hook}</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">
                        <strong>è§’åº¦ï¼š</strong>${idea.angle}
                    </div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">
                        <strong>ç‚ºä»€éº¼å¯è¡Œï¼š</strong>${idea.why}
                    </div>
                `;
                cardsContainer.appendChild(card);
            });

            document.getElementById('ideation-result').classList.remove('hidden');

            // æ´¾ç™¼äº‹ä»¶
            window.dispatchEvent(new CustomEvent('generateIdeas', {
                detail: { topic, count, dedupe }
            }));

            showToast(`å·²ç”¢ç”Ÿ ${selectedIdeas.length} å€‹é¸é¡Œå»ºè­°ï¼è«‹æŸ¥çœ‹ä¸‹æ–¹çµæœ`, 'success');
            
            // æ»¾å‹•åˆ°çµæœå€åŸŸ
            setTimeout(() => {
                document.getElementById('ideation-result').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 500);
        }

        // è…³æœ¬ç”Ÿæˆå™¨åŠŸèƒ½
        function initScript() {
            // æ¨¡å¼é¸æ“‡
            document.querySelectorAll('input[name="script_mode"]').forEach(radio => {
                radio.addEventListener('change', updateModeSelection);
            });

            // æ¨¡æ¿é¸æ“‡
            document.querySelectorAll('input[name="script_template"]').forEach(radio => {
                radio.addEventListener('change', updateTemplateSelection);
            });

            // æ™‚é•·é¸æ“‡
            document.querySelectorAll('input[name="script_duration"]').forEach(radio => {
                radio.addEventListener('change', updateDurationSelection);
            });

            // å¥—ç”¨è¨­å®šæŒ‰éˆ•ï¼ˆå³å´ä¸»é¡Œè¼¸å…¥ï¼‰
            const oneclickBtn = document.getElementById('oneclick-generate');
            if (oneclickBtn) {
                oneclickBtn.addEventListener('click', function() {
                const mode = document.querySelector('input[name="script_mode"]:checked')?.value || 'educational';
                const template = document.querySelector('input[name="script_template"]:checked')?.value || 'A';
                const duration = document.querySelector('input[name="script_duration"]:checked')?.value || '30';

                // è®€å–ä¸»é¡Œè¼¸å…¥
                const topic = document.getElementById('script-topic-input')?.value?.trim();
                if (!topic) {
                    showToast('è«‹å…ˆè¼¸å…¥è…³æœ¬ä¸»é¡Œ', 'error');
                    return;
                }

                // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                const loadingText = oneclickBtn.querySelector('.loading-text');
                const submitText = oneclickBtn.querySelector('.submit-text');
                if (loadingText) loadingText.classList.remove('hidden');
                if (submitText) submitText.classList.add('hidden');
                oneclickBtn.disabled = true;

                // é¡¯ç¤ºçµæœå€åŸŸ
                const scriptResult = document.getElementById('script-result');
                const scriptContent = document.getElementById('script-content');
                if (scriptResult) scriptResult.classList.remove('hidden');
                if (scriptContent) scriptContent.innerHTML = '<p class="text-gray-500 dark:text-gray-400">ç”Ÿæˆä¸­...</p>';

                // ç”Ÿæˆè…³æœ¬
                generateScript(topic, mode, template, duration, oneclickBtn, scriptContent);
                });
            }

            // å¥—ç”¨è¨­å®šä¸¦ç”Ÿæˆè…³æœ¬æŒ‰éˆ•ï¼ˆå·¦å´è¨­å®šå€åŸŸï¼‰
            const applySettingsBtn = document.getElementById('apply-settings-generate');
            if (applySettingsBtn) {
                applySettingsBtn.addEventListener('click', function() {
                    const mode = document.querySelector('input[name="script_mode"]:checked')?.value || 'educational';
                    const template = document.querySelector('input[name="script_template"]:checked')?.value || 'A';
                    const duration = document.querySelector('input[name="script_duration"]:checked')?.value || '30';

                    // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                    const loadingText = applySettingsBtn.querySelector('.apply-loading');
                    const applyText = applySettingsBtn.querySelector('.apply-text');
                    if (loadingText) loadingText.classList.remove('hidden');
                    if (applyText) applyText.classList.add('hidden');
                    applySettingsBtn.disabled = true;

                    // ç”Ÿæˆä¸»é¡Œå’Œè…³æœ¬
                    generateScriptWithTopic(mode, template, duration, applySettingsBtn);
                });
            }

            // ç”Ÿæˆä¸»é¡Œå’Œè…³æœ¬å‡½æ•¸
            async function generateScriptWithTopic(mode, template, duration, button) {
                try {
                    // å…ˆç”Ÿæˆä¸»é¡Œ
                    const topicResponse = await fetch(`${API_BASE}/chat`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        body: JSON.stringify({
                            user_id: JSON.parse(localStorage.getItem('user') || '{}').id || 'web',
                            agent_type: 'script',
                            messages: [{
                                role: 'user',
                                content: `è«‹ç‚ºæˆ‘ç”Ÿæˆä¸€å€‹é©åˆ${mode}æ¨¡å¼ã€${template}æ¨¡æ¿ã€${duration}ç§’æ™‚é•·çš„çŸ­å½±éŸ³è…³æœ¬ä¸»é¡Œã€‚è«‹ç›´æ¥å›è¦†ä¸»é¡Œï¼Œä¸è¦å…¶ä»–èªªæ˜ã€‚`
                            }]
                        })
                    });

                    if (!topicResponse.ok) {
                        throw new Error('ç”Ÿæˆä¸»é¡Œå¤±æ•—');
                    }

                    const topicData = await topicResponse.json();
                    const generatedTopic = topicData.assistant_message || topicData.response || 'çŸ­å½±éŸ³è…³æœ¬ä¸»é¡Œ';

                    // å°‡ç”Ÿæˆçš„ä¸»é¡Œå¡«å…¥å³å´è¼¸å…¥æ¡†
                    const topicInput = document.getElementById('script-topic-input');
                    if (topicInput) {
                        topicInput.value = generatedTopic;
                    }

                    // é¡¯ç¤ºçµæœå€åŸŸ
                    const scriptResult = document.getElementById('script-result');
                    const scriptContent = document.getElementById('script-content');
                    if (scriptResult) scriptResult.classList.remove('hidden');
                    if (scriptContent) scriptContent.innerHTML = '<p class="text-gray-500 dark:text-gray-400">æ­£åœ¨ç”Ÿæˆè…³æœ¬...</p>';

                    // ç”Ÿæˆè…³æœ¬
                    const scriptResponse = await fetch(`${API_BASE}/chat`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        body: JSON.stringify({
                            user_id: JSON.parse(localStorage.getItem('user') || '{}').id || 'web',
                            agent_type: 'script',
                            messages: [{
                                role: 'user',
                                content: `è«‹ç‚ºæˆ‘ç”Ÿæˆä¸€å€‹è…³æœ¬ã€‚ä¸»é¡Œï¼š${generatedTopic}ï¼Œæ¨¡å¼ï¼š${mode}ï¼Œæ¨¡æ¿ï¼š${template}ï¼Œæ™‚é•·ï¼š${duration}ç§’`
                            }]
                        })
                    });

                    if (!scriptResponse.ok) {
                        throw new Error('ç”Ÿæˆè…³æœ¬å¤±æ•—');
                    }

                    const scriptData = await scriptResponse.json();
                    if (scriptContent) {
                        scriptContent.innerHTML = marked.parse(scriptData.assistant_message || scriptData.response || 'ç”Ÿæˆå¤±æ•—');
                    }
                    
                    showToast('è…³æœ¬ç”ŸæˆæˆåŠŸï¼', 'success');
                } catch (error) {
                    console.error('Error generating script with topic:', error);
                    const scriptContent = document.getElementById('script-content');
                    if (scriptContent) {
                        scriptContent.innerHTML = `<p class="text-red-500">ç”Ÿæˆå¤±æ•—: ${error.message}</p>`;
                    }
                    showToast(`ç”Ÿæˆå¤±æ•—: ${error.message}`, 'error');
                } finally {
                    // é‚„åŸæŒ‰éˆ•ç‹€æ…‹
                    const loadingText = button.querySelector('.apply-loading');
                    const applyText = button.querySelector('.apply-text');
                    if (loadingText) loadingText.classList.add('hidden');
                    if (applyText) applyText.classList.remove('hidden');
                    button.disabled = false;
                }
            }

            // ç”Ÿæˆè…³æœ¬å‡½æ•¸
            async function generateScript(topic, mode, template, duration, button, contentElement) {
                try {
                    // ä½¿ç”¨ /chat ç«¯é»ï¼Œå› ç‚º /agent/content/generate å¯èƒ½ä¸å­˜åœ¨æˆ–éœ€è¦ä¸åŒçš„åƒæ•¸
                    const response = await fetch(`${API_BASE}/chat`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        body: JSON.stringify({
                            user_id: JSON.parse(localStorage.getItem('user') || '{}').id || 'web',
                            agent_type: 'script',
                            messages: [{
                                role: 'user',
                                content: `è«‹ç‚ºæˆ‘ç”Ÿæˆä¸€å€‹è…³æœ¬ã€‚ä¸»é¡Œï¼š${topic}ï¼Œæ¨¡å¼ï¼š${mode}ï¼Œæ¨¡æ¿ï¼š${template}ï¼Œæ™‚é•·ï¼š${duration}ç§’`
                            }]
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.detail || 'ç”Ÿæˆè…³æœ¬å¤±æ•—');
                    }

                    const data = await response.json();
                    contentElement.innerHTML = marked.parse(data.assistant_message || data.response || 'ç”Ÿæˆå¤±æ•—');
                    showToast('è…³æœ¬ç”ŸæˆæˆåŠŸï¼', 'success');
                } catch (error) {
                    console.error('Error generating script:', error);
                    contentElement.innerHTML = `<p class="text-red-500">ç”Ÿæˆè…³æœ¬å¤±æ•—: ${error.message}</p>`;
                    showToast(`ç”Ÿæˆè…³æœ¬å¤±æ•—: ${error.message}`, 'error');
                } finally {
                    // é‚„åŸæŒ‰éˆ•ç‹€æ…‹
                    const loadingText = button.querySelector('.loading-text');
                    const submitText = button.querySelector('.submit-text');
                    if (loadingText) loadingText.classList.add('hidden');
                    if (submitText) submitText.classList.remove('hidden');
                    button.disabled = false;
                }
            }

            // åˆå§‹åŒ–æ™‚æ›´æ–°é¸æ“‡ç‹€æ…‹
            updateModeSelection();
            updateTemplateSelection();
            updateDurationSelection();

            // éµç›¤å°èˆª
            initKeyboardNavigation();

            // åˆ‡æ›é¢æ¿äº‹ä»¶
            const tabChat = document.getElementById('tab-script-chat');
            const tabOne = document.getElementById('tab-script-oneclick');
            const panelChat = document.getElementById('script-chat-panel');
            const panelOne = document.getElementById('script-oneclick-panel');
            const resultPanel = document.getElementById('script-result');
            // æ¨™é¡Œå’Œæè¿°å…ƒç´ å·²ç§»é™¤ï¼Œä¸å†éœ€è¦æ›´æ–°
            
            if (tabChat && tabOne && panelChat && panelOne){
                // æä¾›å…¨åŸŸåˆ‡æ›å‡½å¼ï¼ˆonclick å¾Œæ´ï¼‰
                window.switchScriptTab = (mode)=>{
                    console.log('switchScriptTab called with mode:', mode);
                    if (mode === 'one') {
                        console.log('Switching to one-click mode');
                        tabOne.click();
                    } else {
                        console.log('Switching to chat mode');
                        tabChat.click();
                    }
                };
                tabChat.addEventListener('click', ()=>{
                    console.log('åˆ‡æ›åˆ° AI å°è©±æ¨¡å¼ï¼ˆè…³æœ¬ï¼‰');
                    tabChat.classList.add('bg-primary','text-white');
                    tabOne.classList.remove('bg-primary','text-white');
                    tabOne.classList.add('border','border-gray-300','dark:border-gray-600');
                    tabChat.classList.remove('border');
                    // æ¨™é¡Œå’Œæè¿°å·²ç§»é™¤ï¼Œä¸éœ€è¦æ›´æ–°
                    // éš±è—ä¸€éµç”Ÿæˆé¢æ¿
                    panelOne.classList.add('hidden');
                    // é¡¯ç¤ºèŠå¤©å°è©±æ¡†
                    panelChat.classList.remove('hidden');
                    // ç„¡è—è‰²æç¤ºå€å¡Šï¼ˆèˆ‡å…¶ä»–é ä¸€è‡´ï¼‰
                    if (resultPanel) resultPanel.classList.add('hidden');
                });
                
                tabOne.addEventListener('click', ()=>{
                    console.log('åˆ‡æ›åˆ°ä¸€éµç”Ÿæˆæ¨¡å¼ï¼ˆè…³æœ¬ï¼‰');
                    tabOne.classList.add('bg-primary','text-white');
                    tabChat.classList.remove('bg-primary','text-white');
                    tabChat.classList.add('border','border-gray-300','dark:border-gray-600');
                    tabOne.classList.remove('border');
                    // æ¨™é¡Œå’Œæè¿°å·²ç§»é™¤ï¼Œä¸éœ€è¦æ›´æ–°
                    // é¡¯ç¤ºä¸€éµç”Ÿæˆé¢æ¿
                    panelOne.classList.remove('hidden');
                    // éš±è—èŠå¤©å°è©±æ¡†
                    panelChat.classList.add('hidden');
                    // é¡¯ç¤ºçµæœé¢æ¿ï¼ˆä¸€éµç”Ÿæˆæ¨¡å¼ä¸‹é¡¯ç¤ºçµæœï¼‰
                    if (resultPanel) resultPanel.classList.remove('hidden');
                });
                
                // ä¿éšœé»æ“Šäº‹ä»¶ï¼ˆäº‹ä»¶å§”æ´¾å‚™æ´ï¼‰
                const scriptTabs = document.getElementById('script-tabs');
                scriptTabs?.addEventListener('click', (evt)=>{
                    const btn = evt.target?.closest('button');
                    if (!btn) return;
                    if (btn.id === 'tab-script-oneclick') {
                        tabOne?.click();
                    } else if (btn.id === 'tab-script-chat') {
                        tabChat?.click();
                    }
                });
                
                // é è¨­ï¼šAI å°è©± â†’ éš±è—ä¸€éµç”Ÿæˆé¢æ¿
                console.log('åˆå§‹åŒ–ï¼šè¨­å®šç‚º AI å°è©±æ¨¡å¼ï¼ˆè…³æœ¬ï¼‰');
                panelOne.classList.add('hidden');
                if (resultPanel) resultPanel.classList.add('hidden');
            }

        }

        function updateModeSelection() {
            document.querySelectorAll('input[name="script_mode"]').forEach(radio => {
                const label = radio.closest('label');
                if (label) {
                    if (radio.checked) {
                        label.classList.add('border-primary', 'bg-primary', 'text-white');
                        label.classList.remove('border-gray-300', 'dark:border-gray-600', 'hover:bg-gray-50', 'dark:hover:bg-gray-700', 'hover:text-gray-900', 'dark:hover:text-gray-100');
                    } else {
                        label.classList.remove('border-primary', 'bg-primary', 'text-white');
                        label.classList.add('border-gray-300', 'dark:border-gray-600', 'hover:bg-gray-50', 'dark:hover:bg-gray-700', 'hover:text-gray-900', 'dark:hover:text-gray-100');
                    }
                }
            });
        }

        function updateTemplateSelection() {
            document.querySelectorAll('input[name="script_template"]').forEach(radio => {
                const label = radio.closest('label');
                if (label) {
                    if (radio.checked) {
                        label.classList.add('border-primary', 'bg-primary', 'text-white');
                        label.classList.remove('border-gray-300', 'dark:border-gray-600', 'hover:bg-gray-50', 'dark:hover:bg-gray-700', 'hover:text-gray-900', 'dark:hover:text-gray-100');
                    } else {
                        label.classList.remove('border-primary', 'bg-primary', 'text-white');
                        label.classList.add('border-gray-300', 'dark:border-gray-600', 'hover:bg-gray-50', 'dark:hover:bg-gray-700', 'hover:text-gray-900', 'dark:hover:text-gray-100');
                    }
                }
            });
        }

        function updateDurationSelection() {
            document.querySelectorAll('input[name="script_duration"]').forEach(radio => {
                const label = radio.closest('label');
                if (label) {
                    if (radio.checked) {
                        label.classList.add('border-primary', 'bg-primary', 'text-white');
                        label.classList.remove('border-gray-300', 'dark:border-gray-600', 'hover:bg-gray-50', 'dark:hover:bg-gray-700', 'hover:text-gray-900', 'dark:hover:text-gray-100');
                    } else {
                        label.classList.remove('border-primary', 'bg-primary', 'text-white');
                        label.classList.add('border-gray-300', 'dark:border-gray-600', 'hover:bg-gray-50', 'dark:hover:bg-gray-700', 'hover:text-gray-900', 'dark:hover:text-gray-100');
                    }
                }
            });
        }

        function generateScriptPreview(mode, template, duration) {
            const modeText = mode === 'guided' ? 'å¼•å°æ¨¡å¼' : 'è‡ªç”±æ¨¡å¼';
            const templateText = `æ¨¡æ¿ ${template}`;
            const durationText = `${duration} ç§’`;

            document.getElementById('script-mode').textContent = modeText;
            document.getElementById('script-template').textContent = templateText;
            document.getElementById('script-duration').textContent = durationText;

            // ç”Ÿæˆå‡è…³æœ¬å…§å®¹
            document.getElementById('script-loading').classList.remove('hidden');
            const scriptContent = generateScriptContent(template, duration);
            document.getElementById('script-content').textContent = scriptContent;

            document.getElementById('script-empty').classList.add('hidden');
            document.getElementById('script-result').classList.remove('hidden');
            
            showToast('è…³æœ¬ç”Ÿæˆå®Œæˆï¼è«‹æŸ¥çœ‹ä¸‹æ–¹çµæœ', 'success');
            
            // æ»¾å‹•åˆ°çµæœå€åŸŸ
            setTimeout(() => {
                document.getElementById('script-result').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 500);
            document.getElementById('script-loading').classList.add('hidden');
        }

        function generateScriptContent(template, duration) {
            const templates = {
                A: {
                    title: 'ä¸‰æ®µå¼è…³æœ¬',
                    content: `é–‹é ­ï¼ˆ0-${Math.floor(duration * 0.2)}ç§’ï¼‰ï¼š
å¤§å®¶å¥½ï¼Œä»Šå¤©è¦åˆ†äº«ä¸€å€‹é‡è¦ä¸»é¡Œ...

ä¸»é«”ï¼ˆ${Math.floor(duration * 0.2)}-${Math.floor(duration * 0.8)}ç§’ï¼‰ï¼š
é¦–å…ˆï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹...å…¶æ¬¡...æœ€å¾Œ...

çµå°¾ï¼ˆ${Math.floor(duration * 0.8)}-${duration}ç§’ï¼‰ï¼š
ç¸½çµä¸€ä¸‹ï¼Œè¨˜ä½é€™ä¸‰å€‹é‡é»...`
                },
                B: {
                    title: 'å•é¡Œè§£æ±ºè…³æœ¬',
                    content: `å•é¡Œï¼ˆ0-${Math.floor(duration * 0.3)}ç§’ï¼‰ï¼š
ä½ æ˜¯å¦é‡åˆ°é€™æ¨£çš„å›°æ“¾...

åˆ†æï¼ˆ${Math.floor(duration * 0.3)}-${Math.floor(duration * 0.7)}ç§’ï¼‰ï¼š
é€™å€‹å•é¡Œçš„æ ¹æœ¬åŸå› æ˜¯...

è§£æ±ºï¼ˆ${Math.floor(duration * 0.7)}-${duration}ç§’ï¼‰ï¼š
è§£æ±ºæ–¹æ¡ˆå¾ˆç°¡å–®ï¼Œåªéœ€è¦...`
                },
                C: {
                    title: 'Before-After è…³æœ¬',
                    content: `Beforeï¼ˆ0-${Math.floor(duration * 0.4)}ç§’ï¼‰ï¼š
ä»¥å‰çš„æˆ‘ç¸½æ˜¯...

Afterï¼ˆ${Math.floor(duration * 0.4)}-${Math.floor(duration * 0.8)}ç§’ï¼‰ï¼š
ç¾åœ¨çš„æˆ‘å­¸æœƒäº†...

è½‰è®Šï¼ˆ${Math.floor(duration * 0.8)}-${duration}ç§’ï¼‰ï¼š
é—œéµå°±åœ¨æ–¼...`
                },
                D: {
                    title: 'æ•™å­¸è…³æœ¬',
                    content: `ä»‹ç´¹ï¼ˆ0-${Math.floor(duration * 0.2)}ç§’ï¼‰ï¼š
ä»Šå¤©æ•™å¤§å®¶ä¸€å€‹å¯¦ç”¨æŠ€å·§...

æ­¥é©Ÿä¸€ï¼ˆ${Math.floor(duration * 0.2)}-${Math.floor(duration * 0.4)}ç§’ï¼‰ï¼š
ç¬¬ä¸€æ­¥...

æ­¥é©ŸäºŒï¼ˆ${Math.floor(duration * 0.4)}-${Math.floor(duration * 0.6)}ç§’ï¼‰ï¼š
ç¬¬äºŒæ­¥...

æ­¥é©Ÿä¸‰ï¼ˆ${Math.floor(duration * 0.6)}-${Math.floor(duration * 0.8)}ç§’ï¼‰ï¼š
ç¬¬ä¸‰æ­¥...

ç¸½çµï¼ˆ${Math.floor(duration * 0.8)}-${duration}ç§’ï¼‰ï¼š
è¨˜ä½é€™ä¸‰å€‹æ­¥é©Ÿ...`
                },
                E: {
                    title: 'æ•…äº‹è…³æœ¬',
                    content: `é–‹å ´ï¼ˆ0-${Math.floor(duration * 0.2)}ç§’ï¼‰ï¼š
è®“æˆ‘åˆ†äº«ä¸€å€‹çœŸå¯¦æ•…äº‹...

æ•…äº‹ï¼ˆ${Math.floor(duration * 0.2)}-${Math.floor(duration * 0.7)}ç§’ï¼‰ï¼š
æœ‰ä¸€å¤©...ç•¶æ™‚æˆ‘...çµæœ...

å•Ÿç™¼ï¼ˆ${Math.floor(duration * 0.7)}-${duration}ç§’ï¼‰ï¼š
é€™å€‹æ•…äº‹å‘Šè¨´æˆ‘å€‘...`
                },
                F: {
                    title: 'çˆ†é»é€£ç™¼è…³æœ¬',
                    content: `çˆ†é»ä¸€ï¼ˆ0-${Math.floor(duration * 0.25)}ç§’ï¼‰ï¼š
ä½ çŸ¥é“å—ï¼Ÿé©šäººäº‹å¯¦...

çˆ†é»äºŒï¼ˆ${Math.floor(duration * 0.25)}-${Math.floor(duration * 0.5)}ç§’ï¼‰ï¼š
æ›´é©šäººçš„æ˜¯...

çˆ†é»ä¸‰ï¼ˆ${Math.floor(duration * 0.5)}-${Math.floor(duration * 0.75)}ç§’ï¼‰ï¼š
æœ€é—œéµçš„æ˜¯...

è¡Œå‹•ï¼ˆ${Math.floor(duration * 0.75)}-${duration}ç§’ï¼‰ï¼š
ç¾åœ¨å°±é–‹å§‹...`
                }
            };

            return templates[template].content;
        }

        // éµç›¤å°èˆªåŠŸèƒ½
        function initKeyboardNavigation() {
            // ç‚ºæ‰€æœ‰å¯é¸å…ƒç´ æ·»åŠ  tabindex
            document.querySelectorAll('input[type="radio"], button, a').forEach(el => {
                if (!el.hasAttribute('tabindex')) {
                    el.setAttribute('tabindex', '0');
                }
            });

            // è™•ç†éµç›¤äº‹ä»¶
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    const activeElement = document.activeElement;
                    if (activeElement && activeElement.tagName === 'LABEL') {
                        e.preventDefault();
                        const radio = activeElement.querySelector('input[type="radio"]');
                        if (radio) {
                            radio.checked = true;
                            radio.dispatchEvent(new Event('change'));
                        }
                    }
                }
            });
        }

        // è³‡æ–™å„²å­˜èˆ‡è¼‰å…¥
        function saveFormData() {
            const forms = ['positioning-form', 'ideation-form'];
            forms.forEach(formId => {
                const form = document.getElementById(formId);
                if (form) {
                    const formData = new FormData(form);
                    const data = {};
                    for (let [key, value] of formData.entries()) {
                        data[key] = value;
                    }
                    sessionStorage.setItem(formId, JSON.stringify(data));
                }
            });
        }

        function loadStoredData() {
            const forms = ['positioning-form', 'ideation-form'];
            forms.forEach(formId => {
                const stored = sessionStorage.getItem(formId);
                if (stored) {
                    try {
                        const data = JSON.parse(stored);
                        const form = document.getElementById(formId);
                        if (form) {
                            Object.keys(data).forEach(key => {
                                const input = form.querySelector(`[name="${key}"]`);
                                if (input) {
                                    if (input.type === 'radio') {
                                        if (input.value === data[key]) {
                                            input.checked = true;
                                        }
                                    } else {
                                        input.value = data[key];
                                    }
                                }
                            });
                            
                            // æ›´æ–°è¦–è¦ºç‹€æ…‹
                            if (formId === 'positioning-form') {
                                updateToneSelection();
                            }
                        }
                    } catch (e) {
                        console.warn('ç„¡æ³•è¼‰å…¥å„²å­˜çš„è¡¨å–®è³‡æ–™:', e);
                    }
                }
            });
        }

        // å®šæœŸå„²å­˜è¡¨å–®è³‡æ–™
        setInterval(saveFormData, 2000);

        // é é¢åˆ‡æ›æ™‚å„²å­˜è³‡æ–™
        document.addEventListener('click', function(e) {
            if (e.target.matches('a[href^="#!"]') || e.target.closest('a[href^="#!"]')) {
                setTimeout(saveFormData, 100);
            }
        });
    </script>

    <script>
    // å¾Œç«¯ä¸²æ¥äº‹ä»¶ç›£è½ç¯„ä¾‹ï¼š
    
    // ç›£è½å®šä½åˆ†æäº‹ä»¶
    window.addEventListener('analyzePositioning', function(event) {
        const { industry, audience, pains, tone, competitors } = event.detail;
        
        // ç™¼é€ API è«‹æ±‚
        fetch('/api/analyze-positioning', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ industry, audience, pains, tone, competitors })
        })
        .then(response => response.json())
        .then(data => {
            // æ›´æ–° UI é¡¯ç¤ºçµæœ
            const cards = document.getElementById('positioning-cards');
            if (cards) {
                cards.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-2">
                        <div class="font-semibold text-gray-900 dark:text-white mb-1">å“ç‰Œå®šä½</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400 whitespace-pre-line">${data.summary}</div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-2">
                        <div class="font-semibold text-gray-900 dark:text-white mb-1">èªæ°£å®ˆå‰‡</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400 whitespace-pre-line">${data.guidelines}</div>
                    </div>
                `;
            }
            document.getElementById('positioning-result').classList.remove('hidden');
        })
        .catch(error => {
            console.error('å®šä½åˆ†æå¤±æ•—:', error);
            showToast('åˆ†æå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
        });
    });

    // ç›£è½é¸é¡Œç”Ÿæˆäº‹ä»¶
    window.addEventListener('generateIdeas', function(event) {
        const { topic, count, dedupe } = event.detail;
        
        fetch('/api/generate-ideas', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ topic, count, dedupe })
        })
        .then(response => response.json())
        .then(data => {
            // æ›´æ–°é¸é¡Œå¡ç‰‡
            updateIdeationCards(data.ideas);
        })
        .catch(error => {
            console.error('é¸é¡Œç”Ÿæˆå¤±æ•—:', error);
            showToast('ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
        });
    });

    // ç›£è½è…³æœ¬è¨­å®šå¥—ç”¨äº‹ä»¶
    window.addEventListener('applySettings', function(event) {
        const { mode, template, duration } = event.detail;
        
        fetch('/api/generate-script', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ mode, template, duration })
        })
        .then(response => response.json())
        .then(data => {
            // æ›´æ–°è…³æœ¬é è¦½
            document.getElementById('script-content').textContent = data.script;
        })
        .catch(error => {
            console.error('è…³æœ¬ç”Ÿæˆå¤±æ•—:', error);
            showToast('ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
        });
    });

    // è¨‚é–±æ–¹æ¡ˆåŠŸèƒ½
    let subscriptionPlans = [];

    // åˆå§‹åŒ–è¨‚é–±æ–¹æ¡ˆ
    async function initSubscriptionPlans() {
        try {
            const response = await fetch(`${API_BASE}/api/plans`);
            const data = await response.json();
            subscriptionPlans = data.plans || [];
            renderSubscriptionPlans();
        } catch (error) {
            console.error('è¼‰å…¥è¨‚é–±æ–¹æ¡ˆå¤±æ•—:', error);
            // å¦‚æœAPIå¤±æ•—ï¼Œé¡¯ç¤ºé è¨­æ–¹æ¡ˆ
            subscriptionPlans = [
                { id: 1, name: 'åŸºç¤æ–¹æ¡ˆ', description: 'é©åˆå€‹äººå‰µä½œè€…', price: 99, credits: 100, duration_days: 30 },
                { id: 2, name: 'å°ˆæ¥­æ–¹æ¡ˆ', description: 'é©åˆå°å‹åœ˜éšŠ', price: 299, credits: 500, duration_days: 30 },
                { id: 3, name: 'ä¼æ¥­æ–¹æ¡ˆ', description: 'é©åˆå¤§å‹ä¼æ¥­', price: 999, credits: 2000, duration_days: 30 }
            ];
            renderSubscriptionPlans();
        }
    }

    // æ¸²æŸ“è¨‚é–±æ–¹æ¡ˆ
    function renderSubscriptionPlans() {
        const container = document.getElementById('subscription-plans');
        if (!container) return;

        // é»æ•¸åŒ…æ–¹æ¡ˆ
        const pointPacks = [
            { id: 1, name: 'å°é¡åŒ…', description: 'é©åˆè¼•åº¦ä½¿ç”¨è€…', price: 399, credits: 300, duration_days: 180, popular: false },
            { id: 2, name: 'æ¨™æº–åŒ…', description: 'é©åˆä¸€èˆ¬å‰µä½œè€…', price: 1099, credits: 1000, duration_days: 180, popular: true },
            { id: 3, name: 'å¤§é¡åŒ…', description: 'é©åˆé‡åº¦ä½¿ç”¨è€…', price: 3399, credits: 3000, duration_days: 180, popular: false }
        ];

        container.innerHTML = pointPacks.map(pack => `
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 hover:shadow-xl transition-all duration-300 ${pack.popular ? 'ring-2 ring-primary transform scale-105' : ''} relative">
                ${pack.popular ? '<div class="absolute -top-4 left-1/2 transform -translate-x-1/2"><span class="bg-primary text-white px-4 py-1 rounded-full text-sm font-semibold">ğŸ”¥ æ¨è–¦</span></div>' : ''}
                <div class="text-center">
                    <div class="text-4xl mb-4">${pack.name === 'å°é¡åŒ…' ? 'ğŸ’' : pack.name === 'æ¨™æº–åŒ…' ? 'ğŸ’ğŸ’' : 'ğŸ’ğŸ’ğŸ’'}</div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">${pack.name}</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">${pack.description}</p>
                    <div class="text-4xl font-bold text-primary mb-2">NT$ ${pack.price.toLocaleString()}</div>
                    <div class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">${pack.credits.toLocaleString()} é»æ•¸</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400 mb-6">æœ‰æ•ˆæœŸ ${pack.duration_days} å¤©</div>
                    <button onclick="selectPointPack(${pack.id})" class="w-full bg-gradient-to-r from-primary to-primary-hover text-white py-3 px-6 rounded-xl hover:from-primary-hover hover:to-primary transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transform hover:-translate-y-1">
                        ç«‹å³è³¼è²·
                    </button>
                </div>
            </div>
        `).join('');

        // è¨‚é–±æ–¹æ¡ˆ
        const subscriptionPlans = [
            { id: 1, name: 'åŸºç¤æ–¹æ¡ˆ', description: 'é©åˆå€‹äººå‰µä½œè€…', monthly_points: 100, batch_limit: 10, roles_limit: 1, price: 299 },
            { id: 2, name: 'å°ˆæ¥­æ–¹æ¡ˆ', description: 'é©åˆå°å‹åœ˜éšŠ', monthly_points: 500, batch_limit: 50, roles_limit: 3, price: 999 },
            { id: 3, name: 'ä¼æ¥­æ–¹æ¡ˆ', description: 'é©åˆå¤§å‹ä¼æ¥­', monthly_points: 2000, batch_limit: 200, roles_limit: 10, price: 2999 }
        ];

        const advancedContainer = document.getElementById('subscription-plans-advanced');
        if (advancedContainer) {
            advancedContainer.innerHTML = subscriptionPlans.map(plan => `
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 hover:shadow-xl transition-all duration-300 ${plan.name === 'å°ˆæ¥­æ–¹æ¡ˆ' ? 'ring-2 ring-primary transform scale-105' : ''} relative">
                    ${plan.name === 'å°ˆæ¥­æ–¹æ¡ˆ' ? '<div class="absolute -top-4 left-1/2 transform -translate-x-1/2"><span class="bg-primary text-white px-4 py-1 rounded-full text-sm font-semibold">â­ ç†±é–€</span></div>' : ''}
                    <div class="text-center">
                        <div class="text-4xl mb-4">${plan.name === 'åŸºç¤æ–¹æ¡ˆ' ? 'ğŸš€' : plan.name === 'å°ˆæ¥­æ–¹æ¡ˆ' ? 'ğŸš€ğŸš€' : 'ğŸš€ğŸš€ğŸš€'}</div>
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">${plan.name}</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">${plan.description}</p>
                        <div class="text-4xl font-bold text-primary mb-2">NT$ ${plan.price.toLocaleString()}</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400 mb-6">æ¯æœˆ</div>
                        <ul class="text-left space-y-2 mb-6">
                            <li class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                </svg>
                                æ¯æœˆ ${plan.monthly_points} é»æ•¸
                            </li>
                            <li class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                </svg>
                                æ‰¹æ¬¡ä¸Šé™ ${plan.batch_limit} æ¬¡
                            </li>
                            <li class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                </svg>
                                è§’è‰²ä¸Šé™ ${plan.roles_limit} å€‹
                            </li>
                        </ul>
                        <button onclick="selectSubscriptionPlan(${plan.id})" class="w-full bg-gradient-to-r from-primary to-primary-hover text-white py-3 px-6 rounded-xl hover:from-primary-hover hover:to-primary transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transform hover:-translate-y-1">
                            é¸æ“‡æ–¹æ¡ˆ
                        </button>
                    </div>
                </div>
            `).join('');
        }
    }

    // é¡¯ç¤ºè³¼è²·å½ˆçª—
    function showPurchaseModal() {
        const modal = document.getElementById('purchase-modal');
        if (modal) {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.classList.add('modal-open');
        }
    }

    // é—œé–‰è³¼è²·å½ˆçª—
    function closePurchaseModal() {
        const modal = document.getElementById('purchase-modal');
        if (modal) {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.classList.remove('modal-open');
        }
    }

    // é¸æ“‡æ–¹æ¡ˆ
    function selectPlan(planId) {
        const plan = subscriptionPlans.find(p => p.id === planId);
        if (!plan) return;

        const user = JSON.parse(localStorage.getItem('user') || '{}');
        if (!user.id) {
            showToast('è«‹å…ˆç™»å…¥', 'error');
            closePurchaseModal();
            return;
        }

        // ç¢ºèªè³¼è²·
        if (confirm(`ç¢ºå®šè¦è³¼è²·ã€Œ${plan.name}ã€å—ï¼Ÿ\nåƒ¹æ ¼ï¼šNT$ ${plan.price}\né»æ•¸ï¼š${plan.credits} é»`)) {
            purchasePlan(planId);
        }
    }

    // è³¼è²·æ–¹æ¡ˆ
    async function purchasePlan(planId) {
        try {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const response = await fetch(`${API_BASE}/api/purchase`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'include',
                body: JSON.stringify({
                    user_id: user.id,
                    plan_id: planId,
                    payment_method: 'manual'
                })
            });

            const data = await response.json();
            if (data.ok) {
                showToast(`è³¼è²·æˆåŠŸï¼å·²ç²å¾— ${data.credits_added} é»æ•¸`, 'success');
                closePurchaseModal();
                // æ›´æ–°ç”¨æˆ¶é»æ•¸é¡¯ç¤º
                updateUserCredits(data.new_balance);
            } else {
                showToast('è³¼è²·å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
            }
        } catch (error) {
            console.error('è³¼è²·å¤±æ•—:', error);
            showToast('è³¼è²·å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
        }
    }

    // æ›´æ–°ç”¨æˆ¶é»æ•¸é¡¯ç¤º
    function updateUserCredits(balance) {
        const creditsElement = document.querySelector('#user-credits');
        if (creditsElement) {
            creditsElement.textContent = balance;
        }
    }

    // é¸æ“‡é»æ•¸åŒ…
    function selectPointPack(packId) {
        const packs = [
            { id: 1, name: 'å°é¡åŒ…', price: 399, credits: 300 },
            { id: 2, name: 'æ¨™æº–åŒ…', price: 1099, credits: 1000 },
            { id: 3, name: 'å¤§é¡åŒ…', price: 3399, credits: 3000 }
        ];
        
        const pack = packs.find(p => p.id === packId);
        if (!pack) return;
        
        if (confirm(`ç¢ºå®šè¦è³¼è²·ã€Œ${pack.name}ã€å—ï¼Ÿ\nåƒ¹æ ¼ï¼šNT$ ${pack.price.toLocaleString()}\né»æ•¸ï¼š${pack.credits.toLocaleString()} é»`)) {
            // é€™è£¡å¯ä»¥èª¿ç”¨è³¼è²·API
            showToast(`æ­£åœ¨è™•ç†ã€Œ${pack.name}ã€è³¼è²·...`, 'info');
            // å¯¦éš›è³¼è²·é‚è¼¯æœƒç”±é»æ•¸ç³»çµ±è™•ç†
        }
    }
    
    // é¸æ“‡è¨‚é–±æ–¹æ¡ˆ
    function selectSubscriptionPlan(planId) {
        const plans = [
            { id: 1, name: 'åŸºç¤æ–¹æ¡ˆ', price: 299 },
            { id: 2, name: 'å°ˆæ¥­æ–¹æ¡ˆ', price: 999 },
            { id: 3, name: 'ä¼æ¥­æ–¹æ¡ˆ', price: 2999 }
        ];
        
        const plan = plans.find(p => p.id === planId);
        if (!plan) return;
        
        if (confirm(`ç¢ºå®šè¦é¸æ“‡ã€Œ${plan.name}ã€å—ï¼Ÿ\nåƒ¹æ ¼ï¼šNT$ ${plan.price.toLocaleString()}/æœˆ`)) {
            showToast(`æ­£åœ¨è™•ç†ã€Œ${plan.name}ã€è¨‚é–±...`, 'info');
            // é€™è£¡å¯ä»¥è·³è½‰åˆ°è¨‚é–±ä»˜æ¬¾é é¢
        }
    }
    
    // é¡¯ç¤ºè³¼è²·å½ˆçª—ï¼ˆå…¨åŸŸå‡½æ•¸ï¼‰
    function showPurchaseModal() {
        if (window.aiPoints && window.aiPoints.showModal) {
            window.aiPoints.showModal();
        } else {
            showToast('é»æ•¸ç³»çµ±è¼‰å…¥ä¸­ï¼Œè«‹ç¨å¾Œå†è©¦', 'info');
        }
    }
    
    // åˆå§‹åŒ–è¨‚é–±æ–¹æ¡ˆ
    initSubscriptionPlans();
    
    // ç¢ºä¿é é¢è¼‰å…¥å¾ŒåŸ·è¡Œ
    document.addEventListener('DOMContentLoaded', function() {
        initSubscriptionPlans();
    });
    </script>
</body>
</html>
