<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>AIçŸ­å½±éŸ³é¡§å•ï½œAIJobæ™ºèƒ½</title>
  <style>
    :root{
      --primary:#2563eb; --primary-600:#1d4ed8;
      --bg:#ffffff; --muted:#f5f7fb; --border:#e6e8ef;
      --text:#0f172a; --text-muted:#64748b;
      --ok:#16a34a; --err:#dc2626; --shadow:0 6px 18px rgba(2,12,27,0.08);
      --radius:14px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0; font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans TC, Helvetica Neue, Arial;
      background:var(--bg); color:var(--text); line-height:1.6; font-size:16px;
      -webkit-text-size-adjust:100%;
      touch-action:manipulation;
    }
    a{ color:var(--primary); text-decoration:none; }
    .container{ max-width:1200px; margin:0 auto; padding:16px; }

    .topbar{ position:sticky; top:0; z-index:50; background:rgba(255,255,255,0.9); backdrop-filter:saturate(180%) blur(8px); border-bottom:1px solid var(--border); }
    .topbar-inner{ display:flex; flex-direction:column; align-items:center; gap:10px; padding:12px 16px; }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:800; font-size:22px; }
    .brand .logo{ width:20px; height:20px; border-radius:4px; object-fit:cover; box-shadow:0 0 0 3px rgba(37,99,235,0.15); }
    .tabs{ display:flex; gap:8px; flex-wrap:wrap; }
    .tab{ padding:8px 12px; border:1px solid var(--border); border-radius:999px; background:#fff; color:var(--text); cursor:pointer; transition:all .15s; font-weight:600; font-size:14px; }
    .tab.active{ background:var(--primary); border-color:var(--primary); color:#fff; box-shadow:var(--shadow); }

    .hero{ display:grid; grid-template-columns:1fr; gap:16px; padding:20px 16px; }
    .hero-title{ font-size:28px; font-weight:800; letter-spacing:.2px; text-align:left; }
    .hero-sub{ color:var(--text-muted); margin-top:4px; }

    .grid-cards{ display:grid; grid-template-columns:1fr; gap:16px; margin-top:20px; }
    .card{ background:linear-gradient(180deg,#fff,#f9fbff); border:1px solid var(--border); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow); display:flex; flex-direction:column; gap:12px; min-height:160px; }
    .card h3{ margin:0; font-size:20px; }
    .card p{ margin:0; color:var(--text-muted); }
    .card .actions{ margin-top:auto; display:flex; gap:10px; }

    .layout{ display:grid; grid-template-columns:7fr 5fr; gap:16px; padding:16px; }
    .panel{ background:#fff; border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; }
    .panel-head{ padding:12px 14px; border-bottom:1px solid var(--border); display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; }
    .panel-title{ font-weight:800; display:flex; align-items:center; gap:8px; }

    .settings{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .settings .field{ display:flex; align-items:center; gap:6px; background:var(--muted); border:1px solid var(--border); border-radius:10px; padding:6px 8px; }
    .settings input[type="text"], .settings select, .settings input[type="number"]{ border:none; background:transparent; outline:none; padding:4px; min-width:90px; font-size:16px; }
    .settings .check{ display:flex; align-items:center; gap:6px; }
    .settings.collapsed{ display:none; }
    .toggle-settings{ margin-left:auto; border:1px solid var(--border); background:#fff; padding:6px 10px; border-radius:10px; cursor:pointer; font-weight:700; font-size:13px; display:inline-flex; align-items:center; gap:6px; }
    .toggle-settings:hover{ box-shadow:var(--shadow); }
    .chev{ display:inline-block; transition:transform .2s ease; }
    .toggle-settings[aria-expanded="false"] .chev{ transform:rotate(-90deg); }

    .chat-wrap{ display:flex; flex-direction:column; height:62vh; }
    .chat-scroll{ flex:1; overflow:auto; padding:14px; display:flex; flex-direction:column; gap:10px; background:var(--muted); }
    .msg{ max-width:80%; padding:10px 12px; border-radius:14px; border:1px solid var(--border); background:#fff; box-shadow:var(--shadow); }
    .msg.user{ margin-left:auto; background:#eef4ff; border-color:#dbe6ff; }
    .msg .meta{ font-size:12px; color:var(--text-muted); margin-bottom:4px; }
    .inputbar{ display:flex; gap:8px; padding:10px; border-top:1px solid var(--border); background:#fff; }
    textarea{ flex:1; resize:none; border:1px solid var(--border); border-radius:12px; padding:10px 12px; min-height:46px; max-height:160px; font-size:16px; line-height:1.5; }

    .right-wrap{ display:flex; flex-direction:column; height:62vh; }
    .right-scroll{ flex:1; overflow:auto; padding:14px; display:flex; flex-direction:column; gap:10px; background:var(--muted); }
    .toolbar{ display:flex; gap:8px; padding:10px; border-top:1px solid var(--border); background:#fff; flex-wrap:wrap; }

    .segment-card{ background:#fff; border:1px solid var(--border); border-radius:12px; padding:12px; box-shadow:var(--shadow); }
    .segment-head{ display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:6px; }
    .seg-title{ font-weight:700; }
    .seg-meta{ color:var(--text-muted); font-size:13px; }
    .seg-actions{ display:flex; gap:6px; }

    .copy-card{ background:#fff; border:1px solid var(--border); border-radius:12px; padding:12px; box-shadow:var(--shadow); }
    .copy-card h4{ margin:4px 0 8px; }
    .muted{ color:var(--text-muted); font-size:14px; }

    .chips{ display:flex; gap:8px; flex-wrap:wrap; padding:10px 14px; border-top:1px solid var(--border); background:#fff; }
    .chip{ padding:6px 10px; border:1px solid var(--border); border-radius:999px; background:#fff; cursor:pointer; font-size:13px; }
    .chip:hover{ border-color:var(--primary); color:var(--primary); }

    .btn{ padding:10px 14px; border-radius:12px; border:1px solid var(--border); background:#fff; cursor:pointer; font-weight:700; font-size:15px; display:inline-flex; align-items:center; gap:6px; transition:all .15s; min-height:42px; }
    .btn:hover{ transform:translateY(-1px); box-shadow:var(--shadow); }
    .btn.primary{ background:var(--primary); border-color:var(--primary); color:#fff; }
    .btn.primary:disabled{ opacity:.6; cursor:not-allowed; }
    .btn.ghost{ background:transparent; }
    .btn.small{ padding:8px 10px; font-size:14px; min-height:38px; }

    .toast{ position:fixed; left:50%; transform:translateX(-50%); bottom:20px; background:#111827; color:#fff; padding:10px 14px; border-radius:10px; font-size:14px; box-shadow:var(--shadow); opacity:0; pointer-events:none; transition:opacity .25s; z-index:100; }
    .toast.show{ opacity:1; }

    .site-footer{ border-top:1px solid var(--border); margin-top:24px; background:#fff; }
    .copyright{ color:var(--text-muted); font-size:14px; padding:6px 0 14px 0; text-align:center; }

    @media (min-width:880px){ .grid-cards{ grid-template-columns:repeat(2,1fr); } }
    @media (min-width:1200px){ .hero-title{ font-size:32px; } }
    @media (max-width:1199px){ .layout{ grid-template-columns:1fr; } }
    @media (max-width:767px){
      .chat-wrap,.right-wrap{ height:auto; max-height:64vh; }
      .toolbar{ display:none; }
      .settings{ gap:6px; }
      .btn{ min-height:44px; }
      .btn.small{ min-height:40px; }
    }

    /* æ–°å¢ï¼šæ¨¡å¼åˆ‡æ›èˆ‡æ¨¡æ¿é¢æ¿ */
    .mode-wrap{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    .segctl{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .segctl .group{ display:flex; gap:6px; background:var(--muted); border:1px solid var(--border); border-radius:12px; padding:6px; }
    .segctl .group label{ padding:6px 10px; border-radius:999px; cursor:pointer; }
    .segctl .group input{ display:none; }
    .segctl .group input:checked + span{ background:#fff; border:1px solid var(--primary); color:var(--primary); box-shadow:var(--shadow); }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner container">
      <div class="brand">
        <img class="logo" alt="AIJob logo" src="https://static.wixstatic.com/media/9705bb_4edf6b22c58f4275bc9bae42891acb49~mv2.png"/>
        AIçŸ­å½±éŸ³é¡§å•ï½œAIJobæ™ºèƒ½
      </div>
      <div class="tabs">
        <button class="tab active" data-page="home">é¦–é </button>
        <button class="tab" data-page="script">è…³æœ¬æ¨¡å¼</button>
        <button class="tab" data-page="copy">æ–‡æ¡ˆæ¨¡å¼</button>
        <button class="tab" data-page="guide">èªªæ˜/æŒ‡å—</button>
      </div>
    </div>
  </div>

  <!-- é¦–é  -->
  <main id="page-home" class="container">
    <section class="hero">
      <div>
        <div class="hero-title">é¸æ“‡ä½ çš„ä»»å‹™</div>
        <div class="hero-sub">è¼¸å…¥ä¸»é¡Œâ†’AI æ¨ç†è¡Œæ¥­çˆ†æ¬¾è¦ç´ â†’èˆ‡ä½ å°è©±å…±å‰µã€‚ä»‹é¢ç°¡ç´„ã€è¡Œå‹•å‹å–„ã€‚</div>
      </div>
      <div class="grid-cards">
        <article class="card">
          <h3>èˆ‡ AI è¨è«–ã€Œè…³æœ¬ã€</h3>
          <p>æ™‚é–“è»¸ï¼ˆç§’æ•¸ï¼‰ï¼‹å°è©ï¼‹ç•«é¢æ„Ÿï¼‹é¡ä½ cameraï¼‹CTAã€‚æ”¯æ´å¡ç‰‡/æ™‚é–“è»¸æª¢è¦–èˆ‡å¾®èª¿ã€‚</p>
          <div class="actions">
            <button class="btn primary" data-go="script">é–‹å§‹è…³æœ¬æ¨¡å¼</button>
            <button class="btn ghost" data-go="guide">çœ‹æ“ä½œèªªæ˜</button>
          </div>
        </article>
        <article class="card">
          <h3>èˆ‡ AI è¨è«–ã€Œæ–‡æ¡ˆã€</h3>
          <p>ä¸»è²¼æ–‡ã€é–‹é ­é‡‘å¥ã€Hashtags èˆ‡ CTAï¼›çµæ§‹æ¸…æ¥šã€èªæ°£å¯é¸ã€‚</p>
          <div class="actions">
            <button class="btn primary" data-go="copy">é–‹å§‹æ–‡æ¡ˆæ¨¡å¼</button>
            <button class="btn ghost" data-go="guide">çœ‹æ“ä½œèªªæ˜</button>
          </div>
        </article>
      </div>

      <!-- å®¢è£½åŒ–æ™ºèƒ½é«” CTA -->
      <article class="card" style="margin-top:8px;">
        <h3>æƒ³è¦å®¢è£½åŒ–æ‚¨çš„çŸ­å½±éŸ³ AI æ™ºèƒ½é«”å—ï¼Ÿ</h3>
        <p class="muted">éœ€è¦å°ˆå±¬åŠŸèƒ½ã€å“ç‰Œèªæ°£ã€æ•´åˆå¾Œç«¯æˆ–æµç¨‹è‡ªå‹•åŒ–ï¼Ÿæˆ‘å€‘å¯å”åŠ©å¾è¦åŠƒåˆ°ä¸Šç·šã€‚</p>
        <div class="actions">
          <a class="btn primary" target="_blank" href="https://AIJobschool.short.gy/E49kA8">èˆ‡æˆ‘å€‘è¯ç¹«ï¼ˆLINE å®˜æ–¹ï¼‰</a>
        </div>
      </article>
    </section>
  </main>

  <!-- è…³æœ¬é  -->
  <section id="page-script" class="container" style="display:none">
    <div class="layout">
      <div class="panel">
        <div class="panel-head">
          <div class="panel-title">èŠå¤©å”ä½œï¼ˆè…³æœ¬ï¼‰</div>
          <div class="mode-wrap">
            <!-- æ¨¡å¼åˆ‡æ› -->
            <div class="segctl">
              <div class="group" id="modeGroup">
                <label><input type="radio" name="scriptMode" value="guide" checked><span>âœï¸ å¼•å°æ¨¡å¼</span></label>
                <label><input type="radio" name="scriptMode" value="free"><span>ğŸ’¬ è‡ªç”±æ¨¡å¼</span></label>
              </div>
            </div>
            <button class="toggle-settings" id="toggleSettingsScript" aria-expanded="false"><span class="chev">â–¾</span> âš™ï¸ è¨­å®š</button>
          </div>
        </div>

        <!-- å¼•å°æ¨¡å¼ï¼šæ¨¡æ¿èˆ‡æ™‚é•·ï¼ˆåƒ… guide é¡¯ç¤ºï¼‰ -->
        <div class="panel-head" id="guideBar" style="border-top:0; border-bottom:1px solid var(--border);">
          <div class="segctl">
            <div class="group" id="tplGroup" aria-label="æ¨¡æ¿çµæ§‹">
              <label><input type="radio" name="tpl" value="A" checked><span>A ä¸‰æ®µå¼</span></label>
              <label><input type="radio" name="tpl" value="B"><span>B å•é¡Œè§£æ±º</span></label>
              <label><input type="radio" name="tpl" value="C"><span>C Before-After</span></label>
              <label><input type="radio" name="tpl" value="D"><span>D æ•™å­¸</span></label>
              <label><input type="radio" name="tpl" value="E"><span>E æ•˜äº‹</span></label>
              <label><input type="radio" name="tpl" value="F"><span>F çˆ†é»é€£ç™¼</span></label>
            </div>
            <div class="group" id="durGroup" aria-label="æ™‚é•·">
              <label><input type="radio" name="dur" value="30" checked><span>30 ç§’</span></label>
              <label><input type="radio" name="dur" value="60"><span>60 ç§’</span></label>
            </div>
            <button class="btn small" id="btnStartGuide">å¥—ç”¨è¨­å®šä¸¦é–‹å§‹</button>
          </div>
        </div>

        <!-- éš±è—çš„åå¥½è¨­å®šï¼ˆä¿ç•™åŸæ¨£ï¼‰ -->
        <div class="panel-head" id="settingsScriptWrap" style="border-top:0; border-bottom:1px solid var(--border);">
          <div class="settings collapsed" id="settingsScript">
            <div class="field"><span class="muted">user_id</span><input id="userId" type="text" /></div>
            <div class="field"><span class="muted">tone</span>
              <select id="toneSel"><option value="neutral">neutral</option><option>friendly</option><option>energetic</option><option>professional</option></select>
            </div>
            <div class="field"><span class="muted">lang</span>
              <select id="langSel"><option value="zh-TW">zh-TW</option><option value="zh-CN">zh-CN</option><option value="en">en</option></select>
            </div>
            <div class="field"><span class="muted">style</span>
              <select id="styleSel"><option value="concise">concise</option><option value="storytelling">storytelling</option><option value="educational">educational</option></select>
            </div>
            <div class="field"><span class="muted">max_len</span><input id="lenSel" type="number" min="200" max="2000" step="50" value="800" /></div>
            <label class="check"><input type="checkbox" id="rememberChk" /> è¨˜ä½</label>
            <button class="btn small" id="btn-save-prefs">æ›´æ–°åå¥½</button>
          </div>
        </div>

        <div class="chat-wrap">
          <div id="chatScript" class="chat-scroll"></div>

          <!-- å¿«é€Ÿæ¨¡æ¿/å¿«é€Ÿå•é¡Œ -->
          <div class="chips" id="chipsScript">
            <!-- å…§å®¹ç”± JS æ ¹æ“šæ¨¡å¼åˆ‡æ› -->
          </div>

          <div class="inputbar">
            <textarea id="inputScript" placeholder="è¼¸å…¥ä¸»é¡Œ/ç›®æ¨™/å—çœ¾/å¹³å°/æ™‚é•·/èªæ°£â€¦ï¼ˆæŒ‰éˆ•é€å‡ºï¼›Shift+Enter æ›è¡Œï¼‰"></textarea>
            <button class="btn primary" id="sendScript">é€å‡º</button>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-head">
          <div class="panel-title">è…³æœ¬åˆ†æ®µ / æ™‚é–“è»¸</div>
          <div class="settings" style="gap:8px">
            <button class="btn small" id="copyAllScript">è¤‡è£½å…¨éƒ¨</button>
            <button class="btn small" id="clearScript">æ¸…ç©º</button>
          </div>
        </div>
        <div class="right-wrap">
          <div id="segmentsWrap" class="right-scroll"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- æ–‡æ¡ˆé ï¼ˆåŸæ¨£ä¿ç•™ï¼‰ -->
  <section id="page-copy" class="container" style="display:none">
    <!-- â€¦â€¦ï¼ˆæ­¤è™•ä¿æŒä½ ä¸Šå‚³ç‰ˆæœ¬çš„æ–‡æ¡ˆå€å¡Šä¸è®Šï¼‰â€¦â€¦ -->
    <!-- ç‚ºç¯€çœç¯‡å¹…ï¼Œæ­¤æ®µç•¥ï¼›è‹¥éœ€è¦æˆ‘å¯ä»¥å†è²¼å®Œæ•´ç›¸åŒå…§å®¹ -->
  </section>

  <!-- èªªæ˜/æŒ‡å—ï¼ˆæ–°ç‰ˆï¼‰ -->
  <section id="page-guide" class="container" style="display:none; padding-top:16px">
    <article class="card" style="margin-bottom:12px">
      <h3>âœï¸ èªªæ˜ï¼æŒ‡å—ï¼ˆæ–°ç‰ˆï¼‰</h3>
      <h4 style="margin:6px 0 8px">ğŸ§  å…©ç¨®æ¨¡å¼çš„ç”¨é€”</h4>
      <p>æ–°æ‰‹æ²’æƒ³æ³•ï¼Ÿâ†’ **å¼•å°æ¨¡å¼** å…ˆé¸ã€Œçµæ§‹ï¼‹æ™‚é•·ã€ï¼ŒAI æœƒä¸€æ­¥æ­¥å•ç­”ä¸¦ç”¨çŸ¥è­˜åº«çµ¦å»ºè­°ï¼Œæœ€å¾Œç”Ÿæˆè…³æœ¬ã€‚<br/>
         å·²æœ‰æƒ³æ³•ï¼Ÿâ†’ **è‡ªç”±æ¨¡å¼** ç›´æ¥èŠéœ€æ±‚ï¼ŒAI æœƒè‡ªç”±è¨è«–èˆ‡å›é¥‹ï¼Œæœ€å¾Œç”Ÿæˆè…³æœ¬ã€‚</p>
    </article>
    <!-- å…¶é¤˜å…§å®¹åŒåŸæª” -->
  </section>

  <footer class="site-footer">
    <div class="container">
      <div class="copyright">Â© 2025 AIJobSchool ç‰ˆæ¬Šæ‰€æœ‰</div>
    </div>
  </footer>

  <div id="toast" class="toast">å·²è¤‡è£½</div>

  <script>
  const API_BASE = 'https://aijobvideobackend.zeabur.app';
  const DEFAULT_USER_ID = `web-${Math.random().toString(36).slice(2,8)}`;

  // å…¨åŸŸç‹€æ…‹
  const state = { 
    userId: DEFAULT_USER_ID,
    scriptMode: 'guide',                 // guide | free
    templateType: 'A',                   // å¼•å°æ¨¡å¼ä½¿ç”¨
    duration: 30,                        // 30 | 60ï¼Œå¼•å°æ¨¡å¼ä½¿ç”¨
    sessionIdScript: `web-${Math.random().toString(36).slice(2,8)}`,
    messagesScript: [],
    lastAssistantScript: '',
    segments: []
  };

  // ç°¡ä¾¿å·¥å…·
  function fmtTS(d=new Date()){ const p=n=>String(n).padStart(2,'0'); return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())}`; }
  function escapeHTML(s){ return (s||'').replace(/[&<>"]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c])); }
  function showToast(m){ const t=document.getElementById('toast'); t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1500); }
  function copyText(s,msg='å·²è¤‡è£½å›‰ï¼'){ navigator.clipboard.writeText(s).then(()=>showToast(msg)); }
  function appendMsg(el, role, content){
    const div=document.createElement('div');
    div.className='msg ' + (role==='user'?'user':'');
    div.innerHTML=`<div class="meta">${role} Â· ${fmtTS()}</div><div>${escapeHTML(content)}</div>`;
    el.appendChild(div); el.scrollTop=el.scrollHeight;
  }

  // åˆ†é åˆ‡æ›
  const pages = ['home','script','copy','guide'];
  document.querySelectorAll('.tab').forEach(b=>b.onclick=()=>goPage(b.dataset.page));
  document.querySelectorAll('[data-go]').forEach(b=>b.onclick=()=>goPage(b.dataset.go));
  function goPage(name){
    pages.forEach(p=>{
      const elPage = document.getElementById(`page-${p}`);
      if(elPage) elPage.style.display = (p===name)?'block':'none';
      const tab = document.querySelector(`.tab[data-page="${p}"]`);
      if(tab) tab.classList.toggle('active', p===name);
    });
    if(name==='script' && state.messagesScript.length===0){
      showScriptWelcome();
      startQaFirstQuestion(); // å…ˆé€²å…¥å¼•å°çš„ç¬¬ä¸€é¡Œ
      renderChips();          // åˆå§‹åŒ– chips
    }
  }

  // è…³æœ¬æ¨¡å¼ï¼šæ­¡è¿èªªæ˜
  function showScriptWelcome(){
    const chat=document.getElementById('chatScript');
    const msg = 'ğŸ‘‹ æ­¡è¿ä½¿ç”¨è…³æœ¬æ¨¡å¼ï¼\nâ€” æ–°æ‰‹æ²’æƒ³æ³• â†’ è«‹ç”¨ã€å¼•å°æ¨¡å¼ã€‘ï¼Œå…ˆé¸çµæ§‹ï¼‹æ™‚é•·ï¼Œæˆ‘æœƒä¸€æ­¥æ­¥å•ç­”ä¸¦çµ¦å»ºè­°ã€‚\nâ€” å·²æœ‰æƒ³æ³• â†’ åˆ‡åˆ°ã€è‡ªç”±æ¨¡å¼ã€‘ç›´æ¥èŠï¼Œä½ èªªæƒ³åšä»€éº¼ï¼Œæˆ‘ä¾†è£œé½Šè…³æœ¬èˆ‡ç•«é¢å»ºè­°ã€‚';
    appendMsg(chat,'assistant',msg);
    state.messagesScript.push({ role:'assistant', content:msg });
    state.lastAssistantScript = msg;
  }

  // å¿«é€Ÿæ¨¡æ¿ / å¿«é€Ÿå•é¡Œï¼ˆä¾æ¨¡å¼æ›´æ›ï¼‰
  function renderChips(){
    const wrap=document.getElementById('chipsScript');
    wrap.innerHTML='';
    if(state.scriptMode==='guide'){
      const hint = document.createElement('span'); hint.className='muted'; hint.textContent='æ¨¡æ¿ï¼†æ™‚é•·å·²åœ¨ä¸Šæ–¹é¸æ“‡ â†’ ç›´æ¥å›ç­”å•é¡Œæˆ–è¼¸å…¥ä¸»é¡Œé–‹å§‹ç”Ÿæˆ';
      wrap.appendChild(hint);
    }else{
      const hint = document.createElement('span'); hint.className='muted'; hint.textContent='å¿«é€Ÿæå•ï¼š';
      wrap.appendChild(hint);
      [
        'å¹«æˆ‘æŠŠé€™å€‹æƒ³æ³•æ‹†æˆ 60 ç§’è…³æœ¬ï¼ŒHook è¦å¾ˆå¼·ï¼š',
        'é€™å€‹ä¸»é¡Œé©åˆå“ªä¸€ç¨®çµæ§‹ï¼ˆA~Fï¼‰ï¼Œç›´æ¥çµ¦ç¬¬ä¸€ç‰ˆï¼š',
        'è«‹ç”¨ 6 æ®µ 60 ç§’ï¼Œå°ç™½å£èªï¼‹ç•«é¢å…·é«”ï¼Œæœ€å¾Œçµ¦ CTAï¼š'
      ].forEach(q=>{
        const b=document.createElement('button'); b.className='chip'; b.textContent=q;
        b.onclick=()=>{ const t=document.getElementById('inputScript'); t.value=q; t.focus(); };
        wrap.appendChild(b);
      });
    }
  }

  // å¼•å°æ¨¡å¼ï¼šQ/A API
  async function apiChatQA(message){
    const r = await fetch(`${API_BASE}/chat_qa`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ session_id: state.sessionIdScript, message })
    });
    if(!r.ok) throw new Error(`HTTP ${r.status}`);
    return await r.json();
  }

  // å–å¾—ç¬¬ä¸€é¡Œ
  async function startQaFirstQuestion(){
    const resp=await apiChatQA('');
    if(resp.assistant_message){
      appendMsg(document.getElementById('chatScript'),'assistant',resp.assistant_message);
      state.messagesScript.push({ role:'assistant', content:resp.assistant_message });
      state.lastAssistantScript = resp.assistant_message;
    }
  }

  // å¼•å°æ¨¡å¼ï¼šæŠŠä¸Šæ–¹çš„æ¨¡æ¿/æ™‚é•·ç›´æ¥å…ˆå›ç­” Q1/Q2ï¼ˆçœå…©æ­¥ï¼‰
  document.getElementById('btnStartGuide').onclick = async ()=>{
    if(state.scriptMode!=='guide') return;
    const tpl = document.querySelector('input[name="tpl"]:checked').value;
    const dur = document.querySelector('input[name="dur"]:checked').value;
    // ç›´æ¥å›ç­” Q1ï¼ˆçµæ§‹ï¼‰
    appendMsg(chatScript,'user',tpl);
    let r = await apiChatQA(tpl);
    if(r.assistant_message){ appendMsg(chatScript,'assistant',r.assistant_message); state.lastAssistantScript=r.assistant_message; }
    // å›ç­” Q2ï¼ˆæ™‚é•·ï¼‰
    appendMsg(chatScript,'user',dur);
    r = await apiChatQA(dur);
    if(r.assistant_message){ appendMsg(chatScript,'assistant',r.assistant_message); state.lastAssistantScript=r.assistant_message; }
  };

  // æ¨¡å¼åˆ‡æ›
  document.getElementById('modeGroup').addEventListener('change', e=>{
    if(e.target.name!=='scriptMode') return;
    state.scriptMode = e.target.value;       // guide | free
    document.getElementById('guideBar').style.display = (state.scriptMode==='guide')?'block':'none';
    renderChips();
  });

  // é€å‡ºï¼ˆä¾æ¨¡å¼åˆ‡æ›å¾Œç«¯ï¼‰
  const chatScript = document.getElementById('chatScript');
  document.getElementById('sendScript').onclick = async ()=>{
    const textarea=document.getElementById('inputScript');
    const text=(textarea.value||'').trim();
    if(!text){ showToast('è«‹å…ˆè¼¸å…¥å…§å®¹'); return; }
    appendMsg(chatScript,'user',text);
    textarea.value='';

    if(state.scriptMode==='guide'){
      // å¼•å°ï¼šä¸Ÿåˆ° chat_qaï¼ˆé€é¡Œï¼‰
      try{
        const resp = await apiChatQA(text);
        if(resp.assistant_message && !resp.segments){
          appendMsg(chatScript,'assistant',resp.assistant_message);
          state.lastAssistantScript = resp.assistant_message;
        }
        if(resp.segments){
          state.segments = resp.segments; renderSegments();
          appendMsg(chatScript,'assistant',resp.assistant_message || 'âœ… å·²å®Œæˆç”¢å‡º');
        }
      }catch(e){ appendMsg(chatScript,'assistant',`âŒ éŒ¯èª¤ï¼š${e.message}`); }
      return;
    }

    // è‡ªç”±ï¼šä¸Ÿåˆ° chat_generate + é«˜è‡ªç”±åº¦ +ï¼ˆå¯å¸¶é¸æ“‡ä½†ä¸å¼·åˆ¶ï¼‰
    try{
      const payload = {
        user_id: state.userId,
        session_id: state.sessionIdScript,
        mode: 'script',
        dialogue_mode: 'free',
        template_type: state.templateType || null,
        duration: state.duration || null,
        knowledge_hint: '',                 // å¦‚éœ€æŒ‡å®šé ˜åŸŸå¯å¡«
        messages: [{ role:'user', content:text }],
        previous_segments: state.segments || []
      };
      const r = await fetch(`${API_BASE}/chat_generate`,{
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      const j = await r.json();
      if(!r.ok) throw new Error(j?.assistant_message||j?.error||`HTTP ${r.status}`);
      if(j.assistant_message) appendMsg(chatScript,'assistant',j.assistant_message);
      if(j.segments){ state.segments = j.segments; renderSegments(); }
    }catch(e){ appendMsg(chatScript,'assistant',`âŒ éŒ¯èª¤ï¼š${e.message}`); }
  };

  // ç‰‡æ®µæ¸²æŸ“
  const segmentsWrap = document.getElementById('segmentsWrap');
  function segmentToText(s){ 
    return `(${s.start_sec}sâ€“${s.end_sec}s) [${s.type||'-'}] camera:${s.camera||'-'}\nå°è©:${s.dialog||''}\nç•«é¢:${s.visual||''}\nCTA:${s.cta||''}`;
  }
  function renderSegments(){
    segmentsWrap.innerHTML='';
    if(!state.segments?.length){ 
      const empty=document.createElement('div'); 
      empty.className='segment-card muted'; 
      empty.textContent='å°šç„¡ç‰‡æ®µã€‚è«‹è¼¸å…¥æ›´å…·é«”çš„ç§’æ•¸/å ´æ™¯/ç›®æ¨™ã€‚'; 
      segmentsWrap.appendChild(empty); 
      return; 
    }
    state.segments.forEach((s,i)=>{
      if(s.start_sec==null||s.end_sec==null){ s.start_sec=i*6; s.end_sec=i*6+6; }
      const card=document.createElement('div'); card.className='segment-card';
      card.innerHTML=`
        <div class="segment-head">
          <div class="seg-title">#${i+1} ${s.type||'segment'} <span class="seg-meta">${s.start_sec}sâ€“${s.end_sec}s Â· é¡ä½ ${s.camera||'-'}</span></div>
          <div class="seg-actions">
            <button class="btn small" data-act="copy" data-idx="${i}">è¤‡è£½</button>
            <button class="btn small" data-act="tweak" data-idx="${i}">å¾®èª¿</button>
            <button class="btn small" data-act="del" data-idx="${i}">åˆªé™¤</button>
          </div>
        </div>
        <div class="muted">å°ç™½</div><div>${escapeHTML(s.dialog||'')}</div>
        <div class="muted" style="margin-top:6px">ç•«é¢æ„Ÿ</div><div>${escapeHTML(s.visual||'')}</div>
        <div class="muted" style="margin-top:6px">CTA</div><div>${escapeHTML(s.cta||'')}</div>`;
      segmentsWrap.appendChild(card);
    });
  }
  segmentsWrap.onclick = e=>{
    const b=e.target.closest('button'); if(!b) return;
    const idx=+b.dataset.idx, seg=state.segments[idx];
    if(b.dataset.act==='copy') copyText(segmentToText(seg));
    if(b.dataset.act==='del'){ state.segments.splice(idx,1); renderSegments(); }
    if(b.dataset.act==='tweak'){
      const nd=prompt('å¾®èª¿å°ç™½ï¼ˆç•™ç©ºç•¥éï¼‰',seg.dialog||''); if(nd!=null && nd!=='') seg.dialog=nd;
      const nv=prompt('å¾®èª¿ç•«é¢ï¼ˆç•™ç©ºç•¥éï¼‰',seg.visual||''); if(nv!=null && nv!=='') seg.visual=nv;
      const nc=prompt('å¾®èª¿ CTAï¼ˆç•™ç©ºç•¥éï¼‰',seg.cta||''); if(nc!=null && nc!=='') seg.cta=nc;
      renderSegments();
    }
  };

  // è¤‡è£½/æ¸…ç©º
  document.getElementById('copyAllScript').onclick=()=>{ 
    if(!state.segments?.length) return showToast('ç„¡å¯è¤‡è£½å…§å®¹'); 
    copyText(state.segments.map(s=>segmentToText(s)).join('\n\n'),'å·²è¤‡è£½å›‰ï¼');
  };
  document.getElementById('clearScript').onclick =()=>{ state.segments=[]; renderSegments(); };

  // å±•é–‹/æ”¶åˆè¨­å®š
  document.getElementById('toggleSettingsScript').onclick=()=>{
    const box=document.getElementById('settingsScript'); const t=document.getElementById('toggleSettingsScript');
    const open = box.classList.contains('collapsed');
    box.classList.toggle('collapsed', !open);
    t.setAttribute('aria-expanded', open?'true':'false');
  };

  // åŒæ­¥ user_id åˆ°éš±è—è¨­å®š
  document.getElementById('userId').value  = state.userId;
  document.getElementById('userId').onchange  = e=>{ state.userId = e.target.value || DEFAULT_USER_ID; };

  // æ¨¡æ¿/æ™‚é•·é¸å– â†’ å­˜åˆ° stateï¼ˆä¾›è‡ªç”±æ¨¡å¼ä¹Ÿå¯å¸¶ï¼‰
  document.getElementById('tplGroup').addEventListener('change', e=>{
    if(e.target.name==='tpl') state.templateType = e.target.value;
  });
  document.getElementById('durGroup').addEventListener('change', e=>{
    if(e.target.name==='dur') state.duration = parseInt(e.target.value,10);
  });

  // åˆå§‹åŒ–
  goPage('home');
  </script>
</body>
</html>
