<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AIJob短影音營銷智能</title>
  <style>
    :root{
      --bg:#f5f7fa;
      --panel:#ffffff;
      --panel-2:#f0f2f5;
      --text:#222;
      --muted:#666;
      --primary:#0055ff;
      --primary-2:#4a8cff;
      --accent:#7b3fff;
      --ok:#00a96e;
      --warn:#ff9f00;
      --danger:#ff3366;
      --border:rgba(0,0,0,.08);
      --card-shadow:0 4px 16px rgba(0,0,0,.08);
      --radius:14px;
    }

    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      margin:0;
      background:linear-gradient(180deg,#f9fbff 0%, #eef2f8 100%);
      color:var(--text);
      display:flex;
      justify-content:center;
      min-height:100vh;
    }

    .container{
      width:100%;
      max-width:1200px;
      padding:16px;
    }

    h1{
      font-size:22px;
      font-weight:600;
      margin-bottom:12px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(300px,1fr));
      gap:18px;
    }

    .panel{
      background:var(--panel);
      border-radius:var(--radius);
      box-shadow:var(--card-shadow);
      padding:16px;
    }

    textarea{
      width:100%;
      min-height:100px;
      border-radius:8px;
      padding:10px;
      border:1px solid var(--border);
      resize:vertical;
      font-size:14px;
    }

    .row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:8px;
    }

    .btn{
      cursor:pointer;
      border:none;
      border-radius:8px;
      padding:10px 16px;
      font-size:14px;
      font-weight:500;
      transition:background .2s;
      flex:1 1 auto;
      min-width:140px;
      text-align:center;
    }

    .btn.primary{background:var(--primary);color:#fff;}
    .btn.primary:hover{background:var(--primary-2);}
    .btn.secondary{background:var(--ok);color:#fff;}
    .btn.secondary:hover{background:#00c07a;}
    .btn.danger{background:var(--danger);color:#fff;}
    .btn.danger:hover{background:#ff557a;}

    pre{
      background:var(--panel-2);
      padding:8px;
      border-radius:8px;
      font-size:12px;
      white-space:pre-wrap;
      word-break:break-all;
      overflow-wrap:break-word;
    }

    .segment-card{
      background:var(--panel-2);
      border-radius:10px;
      padding:12px;
      margin-bottom:12px;
      box-shadow:0 2px 8px rgba(0,0,0,.05);
    }

    .segment-type{
      font-weight:600;
      margin-bottom:6px;
    }

    .kv{
      display:grid;
      grid-template-columns:100px 1fr;
      gap:8px;
    }

    .kv strong{font-weight:600;}
    @media (max-width:560px){
      .kv{grid-template-columns:1fr;}
      .kv strong{margin-top:8px;}
    }

    .timeline-card{
      background:var(--panel-2);
      border-radius:10px;
      padding:10px;
      margin-top:8px;
    }

    .empty-state{
      text-align:center;
      padding:30px 10px;
      color:var(--muted);
      font-size:14px;
    }

    @media (max-width:600px){
      h1{font-size:18px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>AIJob短影音營銷智能</h1>
    <div class="grid">
      <!-- 左側：輸入與控制 -->
      <div class="panel">
        <h3>輸入與控制</h3>
        <textarea id="userInput" placeholder="請輸入影片主題，例如：針對上班族，30 秒 Reels，主題是加班健身，風格幽默"></textarea>
        <div class="row">
          <button class="btn primary" id="sendBtn">送出 /generate_script</button>
          <button class="btn secondary" id="nextBtn">生成下一段</button>
          <button class="btn danger" id="clearBtn">清空（不影響伺服端）</button>
        </div>
        <pre id="jsonPreview">Request: {"user_input":"...","previous_segments":[...]} 
Response: {"segments":[{type,camera,dialog,visual}],"error":null}</pre>
        <div id="timeline">
          <div class="empty-state">尚未加入任何段落，請從右邊「加入時間軸」</div>
        </div>
      </div>

      <!-- 右側：AI 生成的段落 -->
      <div class="panel">
        <h3>AI 生成的分段腳本</h3>
        <div id="segmentsContainer">
          <div class="empty-state">目前沒有可顯示的 segments。</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "/generate_script"; // ❗ 保留原 API
    let previousSegments = [];

    function renderTimeline(){
      const container = document.getElementById('timeline');
      container.innerHTML = '';
      if(previousSegments.length===0){
        container.innerHTML = '<div class="empty-state">尚未加入任何段落，請從右邊「加入時間軸」</div>';
        return;
      }
      previousSegments.forEach((seg,idx)=>{
        const el = document.createElement('div');
        el.className = 'timeline-card';
        el.innerHTML = `<strong>#${idx+1}｜${seg.type}</strong><div class="kv"><strong>Camera</strong><div>${seg.camera}</div></div><div class="kv"><strong>Dialog</strong><div>${seg.dialog}</div></div><div class="kv"><strong>Visual</strong><div>${seg.visual}</div></div>`;
        container.appendChild(el);
      });
    }

    function renderSegments(segments){
      const container = document.getElementById('segmentsContainer');
      container.innerHTML = '';
      if(!segments || segments.length===0){
        container.innerHTML = '<div class="empty-state">目前沒有可顯示的 segments。</div>';
        return;
      }
      segments.forEach((seg)=>{
        const card = document.createElement('div');
        card.className = 'segment-card';
        card.innerHTML = `
          <div class="segment-type">${seg.type}</div>
          <div class="kv"><strong>Camera</strong><div>${seg.camera}</div></div>
          <div class="kv"><strong>Dialog</strong><div>${seg.dialog}</div></div>
          <div class="kv"><strong>Visual</strong><div>${seg.visual}</div></div>
          <div class="row" style="margin-top:8px;">
            <button class="btn primary">加入時間軸</button>
            <button class="btn secondary">微調後加入</button>
          </div>
        `;
        card.querySelector('.btn.primary').onclick = ()=>{
          previousSegments.push(seg);
          renderTimeline();
        };
        container.appendChild(card);
      });
    }

    async function callAPI(input){
      const payload = {user_input:input, previous_segments:previousSegments};
      document.getElementById('jsonPreview').textContent = `Request: ${JSON.stringify(payload,null,2)}`;
      const res = await fetch(API_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(payload)
      });
      const data = await res.json();
      renderSegments(data.segments);
    }

    document.getElementById('sendBtn').onclick = ()=>{
      const input = document.getElementById('userInput').value.trim();
      if(input) callAPI(input);
    };
    document.getElementById('nextBtn').onclick = ()=>{
      callAPI("(繼續生成下一段)");
    };
    document.getElementById('clearBtn').onclick = ()=>{
      previousSegments = [];
      renderTimeline();
    };

    renderTimeline();
  </script>
</body>
</html>
